/*! For license information please see 725.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[725],{725:(t,n,e)=>{e.r(n),e.d(n,{default:()=>ot});function o(){var t,n,e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",i=e.toStringTag||"@@toStringTag";function c(e,o,r,i){var c=o&&o.prototype instanceof l?o:l,d=Object.create(c.prototype);return a(d,"_invoke",function(e,o,a){var r,i,c,l=0,d=a||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(n,e){return r=n,i=0,c=t,p.n=e,s}};function m(e,o){for(i=e,c=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],m=p.p,f=r[2];e>3?(a=f===o)&&(c=r[(i=r[4])?5:(i=3,3)],r[4]=r[5]=t):r[0]<=m&&((a=e<2&&m<r[1])?(i=0,p.v=o,p.n=r[1]):m<f&&(a=e<3||r[0]>o||o>f)&&(r[4]=e,r[5]=o,p.n=f,i=0))}if(a||e>1)return s;throw u=!0,o}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),i=d,c=f;(n=i<2?t:c)||!u;){r||(i?i<3?(i>1&&(p.n=-1),m(i,c)):p.n=c:p.v=c);try{if(l=2,r){if(i||(a="next"),n=r[a]){if(!(n=n.call(r,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=r.return)&&n.call(r),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);r=t}else if((n=(u=p.n<0)?c:e.call(o,p))!==s)break}catch(n){r=t,i=1,c=n}finally{l=1}}return{value:n,done:u}}}(e,r,i),!0),d}var s={};function l(){}function d(){}function u(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(a(n={},r,function(){return this}),n),m=u.prototype=l.prototype=Object.create(p);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,a(t,i,"GeneratorFunction")),t.prototype=Object.create(m),t}return d.prototype=u,a(m,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,i,"GeneratorFunction"),a(m),a(m,i,"Generator"),a(m,r,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:f}})()}function a(t,n,e,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}a=function(t,n,e,o){if(n)r?r(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e;else{var i=function(n,e){a(t,n,function(t){return this._invoke(n,e,t)})};i("next",0),i("throw",1),i("return",2)}},a(t,n,e,o)}function r(t,n,e,o,a,r,i){try{var c=t[r](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(o,a)}function i(t){return function(){var n=this,e=arguments;return new Promise(function(o,a){var i=t.apply(n,e);function c(t){r(i,o,a,c,s,"next",t)}function s(t){r(i,o,a,c,s,"throw",t)}c(void 0)})}}const c={name:"ModalCliente",props:{v_sede:{default:null},lst_departamentos_base:{type:Array,default:[]},lst_provincias_base:{type:Array,default:[]},lst_distritos_base:{type:Array,default:[]}},data:function(){return{loading:!1,tipoDocumentos:[],tipoClientes:[],lstProvinciasFiltrado:[],lstDistritosFiltrado:[],tipo_documento:"",tipo_cliente_id:"",departamento:{id:0,nombre:"",zona:""},provincia:{id:0,nombre:""},distrito:{id:0,nombre:""},formCliente:{tipo_documento:"",tipo_cliente_id:"",departamento:0,provincia:0,distrito:0,zona:"",nombre:"",documento:"",direccion:"Direccion Trujillo",telefono_movil:"999999999",correo_electronico:"",telefono_fijo:"",codigo_verificacion:"",activo:"SIN VERIFICAR"},entidad:"Entidad",dataDNI:{apellido_materno:"",apellido_paterno:"",codigo_verificacion:0,departamento:"",direccion:"0",direccion_completa:"",distrito:"",nombre_completo:"",nombres:"",numero:"",provincia:"",ubigeo:[],ubigeo_reniec:"",ubigeo_sunat:"",buscado:!1},dataRUC:{anexos:[],condicion:"",departamento:"",direccion:"",direccion_completa:"",distrito:"",es_agente_de_retencion:null,estado:"",nombre_o_razon_social:"",provincia:"",ruc:"",ubigeo:[],ubigeo_sunat:"",buscado:!1},loadingProvincias:!1,loadingDistritos:!1,clienteNuevo:{id:null,tabladetalles_id:null,tipo_documento:null,documento:null,nombre:null},maxlength:8}},watch:{tipoDocumentos:function(t){this.tipo_documento=t.length>0?t[0].simbolo:""},tipoClientes:function(t){this.tipo_cliente_id=t.length>0?t[0].id:""},departamento:{handler:function(t){console.log("WATCH DEPART"),this.provincia=null,this.distrito=null,this.lstProvinciasFiltrado=[],this.lstDistritosFiltrado=[],this.formCliente.zona=t?t.zona:"",this.formCliente.departamento=t?t.id:0;var n=t.id;n&&(this.setLstProvinciasFiltradas(n),this.provincia=this.lstProvinciasFiltrado[0],this.formCliente.departamento=t.id,this.formCliente.provincia=this.provincia.id)},deep:!0},provincia:function(t){console.log("WATCH PROVINCIA");var n=t.id;this.distrito=null,this.lstDistritosFiltrado=[],n&&(this.setLstDistritosFiltrados(n),this.distrito=this.lstDistritosFiltrado[0],this.formCliente.distrito=this.distrito.id)},tipo_documento:function(t){this.formCliente.documento="",this.formCliente.tipo_documento=t,t?(this.formCliente.activo="SIN VERIFICAR",this.entidad="DNI"==t?"Reniec":"RUC"==t?"Sunat":"Entidad","DNI"==t&&(this.maxlength=8),this.maxlength="RUC"==t?11:20):this.entidad="Entidad"},tipo_cliente_id:function(t){this.formCliente.tipo_cliente_id=t},loadingProvincias:function(t){var n=this;if(this.dataDNI.buscado&&t){var e=this.dataDNI.ubigeo.length>0?this.dataDNI.ubigeo[1]:0;this.Provincias.forEach(function(t){Number(t.id)==Number(e)&&(n.provincia=t)})}if(this.dataRUC.buscado&&t){var o=this.dataRUC.ubigeo.length>0?this.dataRUC.ubigeo[1]:0;this.Provincias.forEach(function(t){Number(t.id)==Number(o)&&(n.provincia=t)})}},loadingDistritos:function(t){var n=this;if(this.dataDNI.buscado&&t){var e=this.dataDNI.ubigeo.length>0?this.dataDNI.ubigeo[2]:0;this.Distritos.forEach(function(t){Number(t.id)==Number(e)&&(n.distrito=t)})}if(this.dataRUC.buscado&&t){var o=this.dataRUC.ubigeo.length>0?this.dataRUC.ubigeo[2]:0;this.Distritos.forEach(function(t){Number(t.id)==Number(o)&&(n.distrito=t)})}this.loadingProvincias=!1,this.loadingDistritos=!1,this.dataDNI.buscado=!1,this.dataRUC.buscado=!1},dataDNI:function(t){var n=this;if(t.buscado){this.formCliente.codigo_verificacion="-"==this.dataDNI.codigo_verificacion||null===this.dataDNI.codigo_verificacion?"":this.dataDNI.codigo_verificacion,this.formCliente.nombre=this.dataDNI.nombres+" "+this.dataDNI.apellido_paterno+" "+this.dataDNI.apellido_materno,this.formCliente.direccion=this.dataDNI.direccion_completa,this.formCliente.activo="ACTIVO";var e=t.ubigeo[0],o=t.ubigeo[1],a=t.ubigeo[2];e&&o&&a&&(this.departamento=this.lst_departamentos_base.find(function(t){return t.id==e}),this.$nextTick(function(){n.provincia=n.lst_provincias_base.find(function(t){return t.id==o}),n.$nextTick(function(){n.distrito=n.lst_distritos_base.find(function(t){return t.id==a})})}))}},dataRUC:function(t){var n=this;if(t.buscado){t.ubigeo.length>0&&t.ubigeo[0];this.formCliente.codigo_verificacion="",this.formCliente.nombre=this.dataRUC.nombre_o_razon_social,this.formCliente.direccion=this.dataRUC.direccion,this.formCliente.activo="ACTIVO";var e=t.ubigeo[0],o=t.ubigeo[1],a=t.ubigeo[2];e&&o&&a&&(this.departamento=this.lst_departamentos_base.find(function(t){return t.id==e}),this.$nextTick(function(){n.provincia=n.lst_provincias_base.find(function(t){return t.id==o}),n.$nextTick(function(){n.distrito=n.lst_distritos_base.find(function(t){return t.id==a})})}))}}},created:function(){this.loadUbigeoSede(),this.getTipoDocumento(),this.getTipoCliente()},methods:{loadUbigeoSede:function(){var t=this,n=String(this.v_sede.departamento_id).padStart(2,"0"),e=String(this.v_sede.provincia_id).padStart(4,"0"),o=String(this.v_sede.distrito_id).padStart(6,"0"),a=this.v_sede.departamento_nombre,r=this.v_sede.provincia_nombre,i=this.v_sede.distrito_nombre;this.departamento={id:n,nombre:a,zona:"NORTE"},this.provincia={id:e,nombre:r},this.$nextTick(function(){t.distrito={id:o,nombre:i}})},setLstProvinciasFiltradas:function(t){t=String(t).padStart(2,"0"),this.lstProvinciasFiltrado=this.lst_provincias_base.filter(function(n){return n.departamento_id==t})},setLstDistritosFiltrados:function(t){t=String(t).padStart(4,"0"),this.lstDistritosFiltrado=this.lst_distritos_base.filter(function(n){return n.provincia_id==t})},Guardar:function(){var t=this;return i(o().m(function n(){var e,a;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,t.clearErrores(),document.querySelector("#btn-guardar-cliente").disabled=!0,document.querySelector("#btn-guardar-cliente").innerHTML='<i class="fa fa-save fa-spin"></i> Guardando...',t.loading=!0,n.n=1,t.axios.post(route("ventas.cliente.storeFast"),t.formCliente);case 1:if(!(e=n.v).data.success){n.n=2;break}return t.clienteNuevo=e.data.cliente,t.$emit("newCliente",t.clienteNuevo),t.Cerrar(),toastr.success(e.data.message,"OPERACIÓN COMPLETADA"),$("#modal_cliente").modal("hide"),n.a(2);case 2:toastr.error(e.data.message,"ERROR EN EL SERVIDOR");case 3:n.n=6;break;case 4:if(n.p=4,!("errors"in(a=n.v).response.data)){n.n=5;break}return t.pintarErrores(a.response.data.errors),n.a(2);case 5:toastr.error(a,"ERROR EN LA PETICIÓN CREAR CLIENTE");case 6:return n.p=6,t.loading=!1,document.querySelector("#btn-guardar-cliente").disabled=!1,document.querySelector("#btn-guardar-cliente").innerHTML='<i class="fa fa-save"></i> Guardar',n.f(6);case 7:return n.a(2)}},n,null,[[0,4,6,7]])}))()},pintarErrores:function(t){for(var n in t)if(t.hasOwnProperty(n)){var e=t[n][0];document.querySelector(".error_mdl_client_".concat(n)).textContent=e}},clearErrores:function(){document.querySelectorAll('[class^="error_mdl_client_"]').forEach(function(t){t.textContent=""})},getTipoDocumento:function(){var t=this;return i(o().m(function n(){var e,a;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,t.axios.get(route("consulta.ajax.getTipoDocumentos"));case 1:e=n.v,a=e.data,t.tipoDocumentos=a,n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,null,[[0,2]])}))()},getTipoCliente:function(){var t=this;return i(o().m(function n(){var e,a;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,t.axios.get(route("consulta.ajax.tipoClientes"));case 1:e=n.v,a=e.data,t.tipoClientes=a,n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,null,[[0,2]])}))()},consultarDocumento:function(){var t=this;return i(o().m(function n(){var e,a,r;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,t.loading=!0,n.n=1,t.axios.post(route("ventas.cliente.getDocumento"),{tipo_documento:t.tipo_documento,documento:t.formCliente.documento,id:null});case 1:e=n.v,a=e.data,a.existe?(t.loading=!1,toastr.error("El "+t.tipo_documento+" ingresado ya se encuentra registrado para un cliente","Registrado")):"DNI"===t.tipo_documento?8===t.formCliente.documento.length?t.consultarAPI():(t.loading=!1,toastr.error("El DNI debe de contar con 8 dígitos","Error")):"RUC"===t.tipo_documento&&(11===t.formCliente.documento.length?t.consultarAPI():(t.loading=!1,toastr.error("El RUC debe de contar con 11 dígitos","Error"))),n.n=3;break;case 2:n.p=2,r=n.v,alert("Error en consultarDocumento"+r);case 3:return n.a(2)}},n,null,[[0,2]])}))()},consultarAPI:function(){var t=this;return i(o().m(function n(){var e,a,r,i,c,s;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,e=t.tipo_documento,a=t.formCliente.documento,r="DNI"==e?route("getApidni",{dni:a}):route("getApiruc",{ruc:a}),n.n=1,t.axios.get(r);case 1:(i=n.v).data.success?(c=i.data,"DNI"==e&&t.CamposDNI(c),"RUC"==e&&t.CamposRUC(c)):(document.querySelector("#documento").focus(),t.loading=!1,toastr.error(i.data.message,"ERROR AL CONSULTAR "+e)),n.n=3;break;case 2:n.p=2,s=n.v,t.loading=!1,alert("Error en consultarAPI"+s);case 3:return n.a(2)}},n,null,[[0,2]])}))()},CamposDNI:function(t){var n=t.success,e=t.data;n&&(this.dataDNI=e,this.dataDNI.buscado=!0,this.loading=!1)},CamposRUC:function(t){var n=t.success,e=t.data;n&&(this.dataRUC=e,this.dataRUC.buscado=!0,this.loading=!1)},Cerrar:function(){this.loadUbigeoSede(),this.formCliente={tipo_documento:"DNI",tipo_cliente_id:121,departamento:this.v_sede.departamento_id,provincia:this.v_sede.provincia_id,distrito:this.v_sede.distrito_id,zona:"",nombre:"",documento:"",direccion:"Direccion Trujillo",telefono_movil:"999999999",correo_electronico:"",telefono_fijo:"",codigo_verificacion:"",activo:"SIN VERIFICAR"},this.tipo_documento="DNI",this.tipo_cliente_id=121}}};var s=e(5072),l=e.n(s),d=e(4369),u={insert:"head",singleton:!1};l()(d.A,u);d.A.locals;var p=e(4486);const m=(0,p.A)(c,function(){var t=this,n=t._self._c;return n("div",{staticClass:"modal inmodal fade",attrs:{tabindex:"-1",id:"modal_cliente",role:"dialog","aria-hidden":"true"}},[n("div",{staticClass:"modal-dialog modal-lg"},[n("div",{staticClass:"modal-content animated bounceInRight"},[n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(n){return n.preventDefault(),t.Cerrar.apply(null,arguments)}}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),t._v(" "),n("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),n("i",{staticClass:"fa fa-user-plus modal-icon"}),t._v(" "),n("h4",{staticClass:"modal-title"},[t._v("NUEVO CLIENTE")]),t._v(" "),n("small",{staticClass:"font-bold"},[t._v("Registrar")])]),t._v(" "),n("div",{staticClass:"modal-body content_cliente",class:{sk__loading:t.loading}},[n("form",{staticClass:"formulario",attrs:{id:"frmCliente"},on:{submit:function(n){return n.preventDefault(),t.Guardar.apply(null,arguments)}}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-6 col-md-12 col-sm-12 col-xs-12"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group mb-0"},[n("label",{staticClass:"required",staticStyle:{"font-weight":"bold"},attrs:{for:"tipo_documento"}},[t._v("Tipo de documento")]),t._v(" "),n("v-select",{attrs:{options:t.tipoDocumentos,reduce:function(t){return t.simbolo},label:"simbolo"},model:{value:t.tipo_documento,callback:function(n){t.tipo_documento=n},expression:"tipo_documento"}})],1),t._v(" "),n("span",{staticClass:"error_mdl_client_tipo_documento",staticStyle:{color:"red"}})]),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"documento"}},[t._v("Nro. Documento")]),t._v(" "),n("div",{staticClass:"input-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.documento,expression:"formCliente.documento"}],staticClass:"form-control",attrs:{type:"text",id:"documento",name:"documento",maxlength:t.maxlength,required:"",disabled:"RUC"!==t.tipo_documento&&"DNI"!==t.tipo_documento&&"CARNET EXT."!==t.tipo_documento&&"PASAPORTE"!==t.tipo_documento&&"P. NAC."!==t.tipo_documento},domProps:{value:t.formCliente.documento},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"documento",n.target.value)}}}),t._v(" "),n("span",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary",staticStyle:{color:"white"},attrs:{type:"button",disabled:"RUC"!=t.tipo_documento&&"DNI"!=t.tipo_documento},on:{click:function(n){return n.preventDefault(),t.consultarDocumento.apply(null,arguments)}}},[n("i",{staticClass:"fa fa-search"}),t._v(" "),n("span",{attrs:{id:"entidad"}},[t._v(t._s(t.entidad))])])])]),t._v(" "),n("span",{staticClass:"error_mdl_client_documento",staticStyle:{color:"red"}})])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group mb-0"},[n("label",{staticClass:"required",attrs:{for:"tipo_cliente"}},[t._v("Tipo Cliente")]),t._v(" "),n("v-select",{attrs:{options:t.tipoClientes,reduce:function(t){return t.id},label:"descripcion"},model:{value:t.tipo_cliente_id,callback:function(n){t.tipo_cliente_id=n},expression:"tipo_cliente_id"}})],1),t._v(" "),n("span",{staticClass:"error_mdl_client_tipo_cliente_id",staticStyle:{color:"red"}})]),t._v(" "),n("input",{attrs:{type:"hidden",id:"codigo_verificacion",name:"codigo_verificacion"}}),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"activo"}},[t._v("Estado")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.activo,expression:"formCliente.activo"}],staticClass:"form-control text-center",attrs:{type:"text",id:"activo",name:"activo",readonly:""},domProps:{value:t.formCliente.activo},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"activo",n.target.value)}}})])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{id:"lblNombre",for:"nombre"}},[t._v("Nombre")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.nombre,expression:"formCliente.nombre"}],staticClass:"form-control",attrs:{type:"text",id:"nombre",name:"nombre",maxlength:"191",required:""},domProps:{value:t.formCliente.nombre},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"nombre",n.target.value)}}})])]),t._v(" "),n("div",{staticClass:"col-12"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"direccion"}},[t._v("Dirección Fiscal")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.direccion,expression:"formCliente.direccion"}],staticClass:"form-control",attrs:{type:"text",id:"direccion",name:"direccion",maxlength:"191",onkeyup:"return mayus(this)",required:""},domProps:{value:t.formCliente.direccion},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"direccion",n.target.value)}}})])])])]),t._v(" "),n("div",{staticClass:"col-lg-6 col-md-12 col-sm-12 col-xs-12"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"departamento"}},[t._v("Departamento")]),t._v(" "),n("v-select",{attrs:{options:t.lst_departamentos_base,reduce:function(t){return t},label:"nombre"},model:{value:t.departamento,callback:function(n){t.departamento=n},expression:"departamento"}})],1)]),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"provincia"}},[t._v("Provincia")]),t._v(" "),n("v-select",{attrs:{options:t.lstProvinciasFiltrado,reduce:function(t){return t},label:"nombre"},model:{value:t.provincia,callback:function(n){t.provincia=n},expression:"provincia"}})],1)])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"distrito"}},[t._v("Distrito")]),t._v(" "),n("v-select",{attrs:{options:t.lstDistritosFiltrado,reduce:function(t){return t},label:"nombre"},model:{value:t.distrito,callback:function(n){t.distrito=n},expression:"distrito"}})],1)]),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",attrs:{for:"zona"}},[t._v("Zona")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.zona,expression:"formCliente.zona"}],staticClass:"text-center form-control",attrs:{type:"text",id:"zona",name:"zona",readonly:""},domProps:{value:t.formCliente.zona},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"zona",n.target.value)}}})])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group mb-0"},[n("label",{staticClass:"required",attrs:{for:"telefono_movil"}},[t._v("Teléfono móvil")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.telefono_movil,expression:"formCliente.telefono_movil"}],staticClass:"form-control",attrs:{type:"text",id:"telefono_movil",name:"telefono_movil",onkeypress:"return isNroPhone(event)",maxlength:"9",required:""},domProps:{value:t.formCliente.telefono_movil},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"telefono_movil",n.target.value)}}})]),t._v(" "),n("span",{staticClass:"error_mdl_client_telefono_movil",staticStyle:{color:"red"}})]),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"telefono_fijo"}},[t._v("Teléfono fijo")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.telefono_fijo,expression:"formCliente.telefono_fijo"}],staticClass:"form-control",attrs:{type:"text",id:"telefono_fijo",name:"telefono_fijo",onkeypress:"return isNroPhone(event)",maxlength:"9"},domProps:{value:t.formCliente.telefono_fijo},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"telefono_fijo",n.target.value)}}})]),t._v(" "),n("span",{staticClass:"error_mdl_client_telefono_fijo",staticStyle:{color:"red"}})]),t._v(" "),n("div",{staticClass:"col-12"},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"correo_electronico"}},[t._v("Correo electrónico")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCliente.correo_electronico,expression:"formCliente.correo_electronico"}],staticClass:"form-control",attrs:{type:"text",id:"correo_electronico",name:"correo_electronico"},domProps:{value:t.formCliente.correo_electronico},on:{input:function(n){n.target.composing||t.$set(t.formCliente,"correo_electronico",n.target.value)}}})]),t._v(" "),n("span",{staticClass:"error_mdl_client_correo",staticStyle:{color:"red"}})])])])])]),t._v(" "),n("div",{staticClass:"sk-spinner sk-spinner-wave",class:{"hide-cliente":!t.loading}},[n("div",{staticClass:"sk-rect1"}),t._v(" "),n("div",{staticClass:"sk-rect2"}),t._v(" "),n("div",{staticClass:"sk-rect3"}),t._v(" "),n("div",{staticClass:"sk-rect4"}),t._v(" "),n("div",{staticClass:"sk-rect5"})])]),t._v(" "),n("div",{staticClass:"modal-footer"},[t._m(0),t._v(" "),n("div",{staticClass:"col-md-6 text-right"},[t._m(1),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(n){return n.preventDefault(),t.Cerrar.apply(null,arguments)}}},[n("i",{staticClass:"fa fa-times"}),t._v(" Cancelar")])])])])])])},[function(){var t=this,n=t._self._c;return n("div",{staticClass:"col-md-6 text-left"},[n("i",{staticClass:"fa fa-exclamation-circle leyenda-required"}),t._v(" "),n("small",{staticClass:"leyenda-required"},[t._v("Los\n                        campos\n                        marcados con asterisco (*) son obligatorios.")])])},function(){var t=this._self._c;return t("button",{staticClass:"btn btn-primary btn-sm",staticStyle:{color:"white"},attrs:{id:"btn-guardar-cliente",type:"submit",form:"frmCliente"}},[t("i",{staticClass:"fa fa-save"}),this._v(" Guardar")])}],!1,null,null,null).exports;var f=e(8441);function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function _(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,h(o.key),o)}}function A(t,n,e){return n&&_(t.prototype,n),e&&_(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t){var n=function(t,n){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,n||"default");if("object"!=v(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==v(n)?n:n+""}var b=A(function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.base64_logo="",this.celular="",this.codigo_precio_menor="",this.condicion="",this.correo="",this.created_at="",this.direccion_fiscal="",this.direccion_llegada="",this.dni_representante="",this.estado="",this.estado_dni_representante="",this.estado_fe="",this.estado_precio_menor="",this.estado_ruc="",this.facebook=null,this.id=1,this.instagram=null,this.nombre_logo="",this.nombre_representante="",this.num_asiento="",this.num_partida="",this.razon_social="",this.razon_social_abreviada="",this.ruc=20481753091,this.ruta_logo="",this.telefono="",this.ubigeo="",this.updated_at="",this.web=null});const C={name:"ModalCodigoPrecioMenor",props:{estadoPrecioMenor:{type:String,required:!0,default:""}},data:function(){return{codigoPrecioMenor:""}},methods:{AgregarCodigo:function(){if("1"==this.estadoPrecioMenor)if(""!=this.codigoPrecioMenor){var t={condicion:"MODAL",codigoPrecio:this.codigoPrecioMenor};this.$emit("addCodigoPrecioMenor",t),this.codigoPrecioMenor=""}else toastr.error("Ingresa el codigo autorizado")}}};const g=(0,p.A)(C,function(){var t=this,n=t._self._c;return n("div",{staticClass:"modal inmodal",attrs:{id:"modal-codigo-precio",role:"dialog","aria-hidden":"true"}},[n("div",{staticClass:"modal-dialog modal-xs"},[n("div",{staticClass:"modal-content animated bounceInRight"},[t._m(0),t._v(" "),n("div",{staticClass:"modal-body"},[n("form",{attrs:{id:"frmCodigo"},on:{submit:function(n){return n.preventDefault(),t.AgregarCodigo.apply(null,arguments)}}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},["1"==t.estadoPrecioMenor?n("div",{staticClass:"form-group"},[n("label",{staticClass:"required"},[t._v("Código para vender a menor precio")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.codigoPrecioMenor,expression:"codigoPrecioMenor"}],staticClass:"form-control",attrs:{type:"password",id:"codigo_precio_menor",placeholder:"Código",autocomplete:"off",required:""},domProps:{value:t.codigoPrecioMenor},on:{input:function(n){n.target.composing||(t.codigoPrecioMenor=n.target.value)}}})]):t._e()])])])]),t._v(" "),t._m(1)])])])},[function(){var t=this,n=t._self._c;return n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),t._v(" "),n("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),n("i",{staticClass:"fa fa-cogs modal-icon"}),t._v(" "),n("h4",{staticClass:"modal-title"},[t._v("CODIGO")]),t._v(" "),n("small",{staticClass:"font-bold"},[t._v("Ingresar")])])},function(){var t=this,n=t._self._c;return n("div",{staticClass:"modal-footer"},[n("div",{staticClass:"col-md-6 text-left"},[n("i",{staticClass:"fa fa-exclamation-circle leyenda-required"}),t._v(" "),n("small",{staticClass:"leyenda-required"},[t._v("Los\n                        campos\n                        marcados con asterisco (*) son obligatorios.")])]),t._v(" "),n("div",{staticClass:"col-md-6 text-right"},[n("button",{staticClass:"btn btn-primary btn-sm",staticStyle:{color:"white"},attrs:{type:"submit",form:"frmCodigo"}},[n("i",{staticClass:"fa fa-save"}),t._v(" Guardar")]),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button","data-dismiss":"modal"}},[n("i",{staticClass:"fa fa-times"}),t._v(" Cancelar")])])])}],!1,null,null,null).exports;var E=e(2505);e.n(E)().create({baseURL:location.origin,headers:{"Content-type":"application/json"}});function y(){var t,n,e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function r(e,o,a,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return x(l,"_invoke",function(e,o,a){var r,c,s,l=0,d=a||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(n,e){return r=n,c=0,s=t,p.n=e,i}};function m(e,o){for(c=e,s=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],m=p.p,f=r[2];e>3?(a=f===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=m&&((a=e<2&&m<r[1])?(c=0,p.v=o,p.n=r[1]):m<f&&(a=e<3||r[0]>o||o>f)&&(r[4]=e,r[5]=o,p.n=f,c=0))}if(a||e>1)return i;throw u=!0,o}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(n=c<2?t:s)||!u;){r||(c?c<3?(c>1&&(p.n=-1),m(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(a="next"),n=r[a]){if(!(n=n.call(r,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=r.return)&&n.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);r=t}else if((n=(u=p.n<0)?s:e.call(o,p))!==i)break}catch(n){r=t,c=1,s=n}finally{l=1}}return{value:n,done:u}}}(e,a,r),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var d=[][o]?n(n([][o]())):(x(n={},o,function(){return this}),n),u=l.prototype=c.prototype=Object.create(d);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,x(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,x(u,"constructor",l),x(l,"constructor",s),s.displayName="GeneratorFunction",x(l,a,"GeneratorFunction"),x(u),x(u,a,"Generator"),x(u,o,function(){return this}),x(u,"toString",function(){return"[object Generator]"}),(y=function(){return{w:r,m:p}})()}function x(t,n,e,o){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}x=function(t,n,e,o){if(n)a?a(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e;else{var r=function(n,e){x(t,n,function(t){return this._invoke(n,e,t)})};r("next",0),r("throw",1),r("return",2)}},x(t,n,e,o)}function S(t,n,e,o,a,r,i){try{var c=t[r](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(o,a)}const O={name:"ModalEditaDetalle",props:{item:{type:Object,required:!0,default:null},detalles:{type:Array,required:!0,default:[]}},data:function(){return{formEdit:{cantidad:0,cantidadMax:0,precio:0,precioMinimo:0,unidadMedida:"",id:0,producto:"",estado_precio_menor:"",codigo_precio_menor:"",igv:0},producto:"",cantidad:"",precio:"",unidadMedida:"",cantidadMax:"",codigoPrecioMenor:"",tablaDetalles:[]}},watch:{detalles:function(t){this.tablaDetalles=t},item:{handler:function(t){t&&(this.formEdit=t)},deep:!0},formEdit:{handler:function(t){this.cantidad=t.cantidad,this.precio=t.precio,this.unidadMedida=t.unidadMedida,this.cantidadMax=t.cantidadMax,this.producto=t.producto},deep:!0},cantidad:function(t){var n=isNaN(Number(t))?0:Number(t),e=this.cantidadMax;n>e&&(toastr.error("La cantidad ingresada supera al stock del producto Max("+e+").","Error"),this.cantidad=e)}},methods:{AddDetalle:function(){var t,n=arguments,e=this;return(t=y().m(function t(){var o,a,r,i,c,s;return y().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o=n.length>0&&void 0!==n[0]?n[0]:"VISTA",t.p=1,a=!0,r=isNaN(Number(e.cantidad))?0:Number(e.cantidad),i=isNaN(Number(e.precio))?0:Number(e.precio),0!=r){t.n=2;break}throw"Ingrese cantidad del Producto..";case 2:if(0!=i){t.n=3;break}throw"Ingrese el precio del producto superior a 0.0.";case 3:if(i<e.formEdit.precioMinimo&&("1"==e.formEdit.estado_precio_menor?e.codigoPrecioMenor!=e.formEdit.codigo_precio_menor?("MODAL"==o?toastr.error("El codigo para poder vender a un precio menor a lo establecido es incorrecto.","Error"):(e.codigoPrecioMenor="",$("#modal-codigo-precio-editar").modal({backdrop:"static",keyboard:!1})),a=!1):($("#modal-codigo-precio-editar").modal("hide"),$("body").addClass("modal-open")):(toastr.error("No puedes vender a un precio menor a lo establecido.","Error"),a=!1)),!a){t.n=6;break}if(!(r>0&&e.formEdit.cantidad>0&&e.formEdit.id>0)){t.n=5;break}return t.n=4,e.axios.post(route("ventas.documento.update.lote"),{lote_id:e.formEdit.id,cantidad_res:r,cantidad_sum:e.formEdit.cantidad});case 4:c=t.v,c.data.success?e.ActualizarTabla():toastr.warning("Ocurrió un error porfavor recargar la pagina."),t.n=6;break;case 5:toastr.error("Cerrar ventana y volver a editar producto.","Error");case 6:t.n=8;break;case 7:t.p=7,s=t.v,toastr.error(s,"Error");case 8:return t.a(2)}},t,null,[[1,7]])}),function(){var n=this,e=arguments;return new Promise(function(o,a){var r=t.apply(n,e);function i(t){S(r,o,a,i,c,"next",t)}function c(t){S(r,o,a,i,c,"throw",t)}i(void 0)})})()},limpiar:function(){},AddCodigo:function(){this.AddDetalle("MODAL")},ActualizarTabla:function(){var t,n,e,o,a,r=this,i=convertFloat(this.precio),c=convertFloat(this.formEdit.igv),s=convertFloat(c/100),l=convertFloat(this.cantidad);t=(n=i)/(1+s),a=(o=n-(e=0*n))*l,this.tablaDetalles.forEach(function(c){var s;Number(c.producto_id)==Number(r.formEdit.id)&&(c.producto_id=r.formEdit.id,c.unidad=r.formEdit.unidadMedida,c.producto=r.formEdit.producto,c.precio_unitario=n,c.valor_unitario=t,c.valor_venta=(s=Number(a).toFixed(2),Number(s)),c.cantidad=l,c.precio_inicial=i,c.dinero=e,c.descuento=0,c.precio_nuevo=o,c.precio_minimo=r.formEdit.precioMinimo)}),$("#modal_editar_detalle").modal("hide"),this.$emit("update:detalles",this.tablaDetalles)},cerrarModal:function(t){switch(t){case"EDITAR":$("#modal_editar_detalle").modal("hide");break;case"CODIGO":$("#modal-codigo-precio-editar").modal("hide"),$("body").addClass("modal-open")}}}};const R=(0,p.A)(O,function(){var t=this,n=t._self._c;return n("div",[n("div",{staticClass:"modal inmodal",attrs:{id:"modal_editar_detalle",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[n("div",{staticClass:"modal-dialog"},[n("div",{staticClass:"modal-content animated bounceInRight"},[n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.cerrarModal("EDITAR")}}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),t._v(" "),n("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),n("i",{staticClass:"fa fa-cogs modal-icon"}),t._v(" "),n("h4",{staticClass:"modal-title"},[t._v("Detalle del documento de venta")]),t._v(" "),n("small",{staticClass:"font-bold"},[t._v("Editar detalle")])]),t._v(" "),n("div",{staticClass:"modal-body"},[n("form",{attrs:{id:"edit_detalle_venta"},on:{submit:function(n){return n.preventDefault(),t.AddDetalle.apply(null,arguments)}}},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"col-form-label required"},[t._v("Producto-lote:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.producto,expression:"producto"}],staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:t.producto},on:{input:function(n){n.target.composing||(t.producto=n.target.value)}}})]),t._v(" "),n("div",{staticClass:"form-group"},[n("label",{},[t._v("Unidad de Medida")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.unidadMedida,expression:"unidadMedida"}],staticClass:"form-control",attrs:{type:"text",id:"medida_editar",disabled:""},domProps:{value:t.unidadMedida},on:{input:function(n){n.target.composing||(t.unidadMedida=n.target.value)}}})]),t._v(" "),n("div",{staticClass:"form-group row"},[n("div",{staticClass:"col-lg-6 col-xs-12"},[n("label",{staticClass:"required"},[t._v("Cantidad")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.cantidad,expression:"cantidad"}],staticClass:"form-control",attrs:{type:"text",max:t.cantidadMax,min:"1",required:""},domProps:{value:t.cantidad},on:{input:function(n){n.target.composing||(t.cantidad=n.target.value)}}})]),t._v(" "),n("div",{staticClass:"col-lg-6 col-xs-12"},[n("label",{staticClass:"required"},[t._v("Precio")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.precio,expression:"precio"}],staticClass:"form-control",attrs:{type:"text",maxlength:"15",required:""},domProps:{value:t.precio},on:{input:function(n){n.target.composing||(t.precio=n.target.value)}}})])])])]),t._v(" "),n("div",{staticClass:"modal-footer"},[t._m(0),t._v(" "),n("div",{staticClass:"col-md-6 text-right"},[t._m(1),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.cerrarModal("EDITAR")}}},[n("i",{staticClass:"fa fa-times"}),t._v(" Cancelar")])])])])])]),t._v(" "),n("div",{staticClass:"modal inmodal",attrs:{id:"modal-codigo-precio-editar",role:"dialog","aria-hidden":"true"}},[n("div",{staticClass:"modal-dialog modal-xs"},[n("div",{staticClass:"modal-content animated bounceInRight"},[n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.cerrarModal("CODIGO")}}},[n("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),t._v(" "),n("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),n("i",{staticClass:"fa fa-cogs modal-icon"}),t._v(" "),n("h4",{staticClass:"modal-title"},[t._v("CODIGO")]),t._v(" "),n("small",{staticClass:"font-bold"},[t._v("Ingresar")])]),t._v(" "),n("div",{staticClass:"modal-body"},[n("form",{attrs:{id:"frmCodigoEditar"},on:{submit:function(n){return n.preventDefault(),t.AddCodigo.apply(null,arguments)}}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},["1"==t.formEdit.estado_precio_menor?n("div",{staticClass:"form-group"},[n("label",{staticClass:"required"},[t._v("Código para vender a menor precio")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.codigoPrecioMenor,expression:"codigoPrecioMenor"}],staticClass:"form-control",attrs:{type:"password",placeholder:"Código",autocomplete:"off",required:""},domProps:{value:t.codigoPrecioMenor},on:{input:function(n){n.target.composing||(t.codigoPrecioMenor=n.target.value)}}})]):t._e()])])])]),t._v(" "),n("div",{staticClass:"modal-footer"},[t._m(2),t._v(" "),n("div",{staticClass:"col-md-6 text-right"},[t._m(3),t._v(" "),n("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.cerrarModal("CODIGO")}}},[n("i",{staticClass:"fa fa-times"}),t._v(" Cancelar")])])])])])])])},[function(){var t=this,n=t._self._c;return n("div",{staticClass:"col-md-6 text-left"},[n("i",{staticClass:"fa fa-exclamation-circle leyenda-required"}),t._v(" "),n("small",{staticClass:"leyenda-required"},[t._v("Los\n                            campos marcados con asterisco ("),n("label",{staticClass:"required"}),t._v(") son\n                            obligatorios.")])])},function(){var t=this._self._c;return t("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"submit",id:"btn_editar_detalle",form:"edit_detalle_venta"}},[t("i",{staticClass:"fa fa-save"}),this._v(" Guardar")])},function(){var t=this,n=t._self._c;return n("div",{staticClass:"col-md-6 text-left"},[n("i",{staticClass:"fa fa-exclamation-circle leyenda-required"}),t._v(" "),n("small",{staticClass:"leyenda-required"},[t._v("Los campos\n                            marcados con asterisco (*) son obligatorios.")])])},function(){var t=this._self._c;return t("button",{staticClass:"btn btn-primary btn-sm",staticStyle:{color:"white"},attrs:{type:"submit",form:"frmCodigoEditar"}},[t("i",{staticClass:"fa fa-save"}),this._v(" Guardar")])}],!1,null,null,null).exports;function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}var I;function N(t,n,e){return(n=function(t){var n=function(t,n){if("object"!=D(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,n||"default");if("object"!=D(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==D(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function T(){var t,n,e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function r(e,o,a,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return P(l,"_invoke",function(e,o,a){var r,c,s,l=0,d=a||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(n,e){return r=n,c=0,s=t,p.n=e,i}};function m(e,o){for(c=e,s=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],m=p.p,f=r[2];e>3?(a=f===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=m&&((a=e<2&&m<r[1])?(c=0,p.v=o,p.n=r[1]):m<f&&(a=e<3||r[0]>o||o>f)&&(r[4]=e,r[5]=o,p.n=f,c=0))}if(a||e>1)return i;throw u=!0,o}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(n=c<2?t:s)||!u;){r||(c?c<3?(c>1&&(p.n=-1),m(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(a="next"),n=r[a]){if(!(n=n.call(r,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=r.return)&&n.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);r=t}else if((n=(u=p.n<0)?s:e.call(o,p))!==i)break}catch(n){r=t,c=1,s=n}finally{l=1}}return{value:n,done:u}}}(e,a,r),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var d=[][o]?n(n([][o]())):(P(n={},o,function(){return this}),n),u=l.prototype=c.prototype=Object.create(d);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,P(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,P(u,"constructor",l),P(l,"constructor",s),s.displayName="GeneratorFunction",P(l,a,"GeneratorFunction"),P(u),P(u,a,"Generator"),P(u,o,function(){return this}),P(u,"toString",function(){return"[object Generator]"}),(T=function(){return{w:r,m:p}})()}function P(t,n,e,o){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}P=function(t,n,e,o){if(n)a?a(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e;else{var r=function(n,e){P(t,n,function(t){return this._invoke(n,e,t)})};r("next",0),r("throw",1),r("return",2)}},P(t,n,e,o)}function w(t,n,e,o,a,r,i){try{var c=t[r](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(o,a)}function L(t){return function(){var n=this,e=arguments;return new Promise(function(o,a){var r=t.apply(n,e);function i(t){w(r,o,a,i,c,"next",t)}function c(t){w(r,o,a,i,c,"throw",t)}i(void 0)})}}const k={name:"TablaProductos",components:{ModalEnvioVue:f.A,ModalCodigoPrecioMenorVue:g,ModalEditaDetalleVue:R},props:["fullaccessTable","btnDisabled","parametros","productoTabla","TotalesObj","idcotizacion","modelos","categorias","marcas","tallas","cliente","almacenSeleccionado","lst_departamentos_base","lst_provincias_base","lst_distritos_base"],data:function(){return{monto_embalaje:0,monto_envio:0,monto_descuento:0,porcentaje_descuento_global:0,descuentos:[],flujo:[],monto_subtotal:0,monto_igv:0,monto_total:0,monto_total_pagar:0,carrito:[],deshabilitarBtnAgregar:!0,productosPorModelo:{},modeloSeleccionado:null,categoriaSeleccionada:null,marcaSeleccionada:null,productoSeleccionado:null,precioVentaSeleccionado:null,buscarCodigoBarra:null,productos:[],preciosVenta:[],asegurarCierre:5,formDetalles:{producto_id:"",producto_unidad:"",cantidad:"",precio:"",producto_lote:"",igv:18,igv_int:"",monto_sub_total:0,monto_total_igv:0,monto_total:0},searchInput:"",dataEmpresa:new b,codigo_precio_menor:"",estadoPrecioMenor:"",tablaDetalles:[],itemLote:{cantidad:0,cantidadMax:0,precio:0,precioMinimo:0,unidadMedida:"",id:0,producto:"",estado_precio_menor:"",codigo_precio_menor:"",igv:0},Igv:18,modalLote:!1,loadingProductos:!1,paginaActual:1,perPage:10,buscando:!1}},watch:{monto_envio:{handler:function(t){var n=t;if(!/^\d*\.?\d*$/.test(n))return n=(n=(n=n.replace(/^0+/,"0")).replace(/[^\d.]/g,"")).replace(/(\..*)\./g,"$1"),void(this.monto_envio=n);this.calcularMontos();var e=this.monto_embalaje.length>0?this.monto_embalaje:0,o=this.monto_envio.length>0?this.monto_envio:0,a={monto_sub_total:parseFloat(this.monto_subtotal),monto_total_igv:parseFloat(this.monto_igv),monto_total:parseFloat(this.monto_total),monto_embalaje:parseFloat(e),monto_envio:parseFloat(o),monto_total_pagar:parseFloat(this.monto_total_pagar)};this.$emit("addProductoDetalle",{detalles:this.carrito,totales:a})},deep:!0},monto_embalaje:{handler:function(t){var n=t;if(!/^\d*\.?\d*$/.test(n))return n=(n=(n=n.replace(/^0+/,"0")).replace(/[^\d.]/g,"")).replace(/(\..*)\./g,"$1"),void(this.monto_embalaje=n);this.calcularMontos();var e=this.monto_embalaje.length>0?this.monto_embalaje:0,o=this.monto_envio.length>0?this.monto_envio:0,a={monto_sub_total:parseFloat(this.monto_subtotal),monto_total_igv:parseFloat(this.monto_igv),monto_total:parseFloat(this.monto_total),monto_embalaje:parseFloat(e),monto_envio:parseFloat(o),monto_total_pagar:parseFloat(this.monto_total_pagar)};this.$emit("addProductoDetalle",{detalles:this.carrito,totales:a})},deep:!0},carrito:{handler:function(t){console.log("WATCH CARRITO"),this.carrito.length>0&&(this.asegurarCierre=1);var n={monto_sub_total:parseFloat(this.monto_subtotal),monto_total_igv:parseFloat(this.monto_igv),monto_total:parseFloat(this.monto_total),monto_embalaje:parseFloat(this.monto_embalaje),monto_envio:parseFloat(this.monto_envio),monto_total_pagar:parseFloat(this.monto_total_pagar),monto_descuento:parseFloat(this.monto_descuento)};this.$emit("addProductoDetalle",{detalles:this.carrito,totales:n})},deep:!0},buscarCodigoBarra:{handler:function(t){var n=this;if(!this.almacenSeleccionado)return toastr.clear(),toastr.error("DEBES SELECCIONAR UN ALMACÉN!!!"),this.$nextTick(function(){n.$parent.$refs.selectAlmacen.$el.querySelector("input").focus()}),void this.$parent.ocultarAnimacionVenta();8===t.trim().length&&this.getProductoBarCode(t)},deep:!0},modeloSeleccionado:{handler:function(t){console.log("modeloSeleccionado cambió:",t),this.getProductos()},deep:!0},categoriaSeleccionada:{handler:function(t){console.log("categoriaSeleccionada cambió:",t),this.getProductos()},deep:!0},marcaSeleccionada:{handler:function(t){console.log("marcaSeleccionada cambió:",t),this.getProductos()},deep:!0},productoSeleccionado:{handler:function(t){var n=t.producto_id;console.log("producto seleccionado"),n&&this.getColoresTallas()},deep:!0},codigoPrecioMenor:{handler:function(t){this.estadoPrecioMenor=t.estado_precio_menor},deep:!0},searchInput:function(t){var n,e=this;this.paramsLotes.search=t,clearTimeout(n),n=setTimeout(function(){e.$nextTick(e.ObtenerLotes),clearTimeout(n)},1e3)},formDetalles:{handler:function(t){var n=isNaN(Number(t.cantidad))?0:Number(t.cantidad),e=Number(this.productoJson.cantidad_logica);n>e&&(toastr.error("La cantidad ingresa supera el stock del producto. MAX("+e+")"),t.cantidad=e)},deep:!0}},created:function(){},methods:(I={buscarProducto:function(t){var n=this;return L(T().m(function e(){var o,a,r;return T().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("OLA"),n.almacenSeleccionado){e.n=1;break}return toastr.clear(),toastr.error("DEBES SELECCIONAR UN ALMACÉN!!!"),e.a(2);case 1:if(!(t.length>2)){e.n=5;break}return n.loadingProductos=!0,n.buscando=!0,e.p=2,toastr.clear(),o=route("ventas.documento.getProductosVenta"),e.n=3,axios.get(o,{params:{search:t,page:n.paginaActual,perPage:n.perPage,almacen_id:n.almacenSeleccionado}});case 3:a=e.v,console.log(a),a.data.success?(n.productos=a.data.data.data,n.loadingProductos=!1,n.buscando=!1):(console.log(a.data.message),toastr.error(a.data.message,"ERROR EN EL SERVIDOR")),e.n=5;break;case 4:e.p=4,r=e.v,console.error("Error al buscar productos:",r),n.loadingProductos=!1,n.buscando=!1;case 5:return e.a(2)}},e,null,[[2,4]])}))()},openModal:function(t){this.$parent.openModal(t)},closeModal:function(){this.$parent.closeModal(producto)}},N(N(N(N(N(N(N(N(N(N(I,"closeModal",function(){this.modalVisible=!1,this.selectedProducto=null}),"addDataEnvio",function(t){this.$emit("addDataEnvio",t)}),"NuevoCliente",function(){$("#modal_cliente").modal("show")}),"setDataEnvio",function(){$("#modal_envio").modal("show")}),"validarDescuento",function(t,n,e){var o=e.target.value;if(0!==o.trim().length){if(/^[0-9]+(\.[0-9]{0,2})?$/.test(o)){var a=parseFloat(e.target.value);a>100&&(e.target.value=100,a=e.target.value),this.calcularDescuento(t,n,a)}else e.target.value=o.slice(0,-1)}else this.calcularDescuento(t,n,0)}),"calcularDescuento",function(t,n,e){var o=this.carrito.findIndex(function(e){return e.producto_id==t&&e.color_id==n}),a=this.carrito[o];a.porcentaje_descuento=e,a.monto_descuento=0===e?0:a.subtotal*(e/100),a.precio_venta_nuevo=0===e?0:(a.precio_venta*(1-e/100)).toFixed(2),a.subtotal_nuevo=0===e?0:(a.subtotal*(1-e/100)).toFixed(2),this.carrito[o]=a,this.calcularMontos(),console.log(this.carrito)}),"eliminarCarrito",function(){var t=this;return L(T().m(function n(){return T().w(function(n){for(;;)switch(n.p=n.n){case 0:if(0===t.carrito.length){n.n=7;break}return t.$parent.mostrarAnimacionVenta(),n.p=1,n.n=2,t.axios.post(route("ventas.documento.devolver.cantidades"),{carrito:JSON.stringify(t.carrito)});case 2:return t.carrito=[],t.monto_subtotal=0,t.monto_igv=0,t.monto_total=0,n.n=3,t.getColoresTallas();case 3:t.$parent.ocultarAnimacionVenta(),toastr.success("Detalle eliminado","Completado"),n.n=5;break;case 4:n.p=4,n.v,toastr.error("Ocurrio un error al eliminar el detalle","Error");case 5:return n.p=5,t.$parent.ocultarAnimacionVenta(),n.f(5);case 6:n.n=8;break;case 7:toastr.warning("El detalle no tiene productos","Advertencia");case 8:return n.a(2)}},n,null,[[1,4,5,6]])}))()}),"calcularMontos",function(){var t,n,e,o=0,a=0;this.carrito.forEach(function(t){0===t.porcentaje_descuento?o+=t.subtotal:o+=parseFloat(t.subtotal_nuevo),a+=parseFloat(t.monto_descuento)});var r=this.monto_embalaje.length>0?parseFloat(this.monto_embalaje):0,i=this.monto_envio.length>0?parseFloat(this.monto_envio):0;n=(e=o+parseFloat(r)+parseFloat(i))-(t=e/1.18),this.monto_total_pagar=e,this.monto_igv=n,this.monto_total=t,this.monto_subtotal=o,this.monto_descuento=a}),"getStockLogico",function(t){return L(T().m(function n(){var e,o,a,r,i,c,s,l;return T().w(function(n){for(;;)switch(n.p=n.n){case 0:return e=t.getAttribute("data-almacen-id"),o=t.getAttribute("data-producto-id"),a=t.getAttribute("data-color-id"),r=t.getAttribute("data-talla-id"),n.p=1,i="/get-stocklogico/".concat(e,"/").concat(o,"/").concat(a,"/").concat(r),n.n=2,axios.get(i);case 2:if("success"!=(c=n.v).data.message){n.n=3;break}return s=c.data.data[0].stock_logico,n.a(2,s);case 3:n.n=5;break;case 4:return n.p=4,l=n.v,toastr.error("El producto no cuenta con registros en esa talla","Error"),event.target.value="",console.error("Error al obtener stock logico:",l),n.a(2,null);case 5:return n.a(2)}},n,null,[[1,4]])}))()}),"printTallaDetalle",function(t,n){var e=n.tallas.find(function(n){return t==n.talla_id});return e?e.cantidad:""}),N(N(N(N(N(N(N(N(N(N(I,"calcularSubTotal",function(){var t=this;this.carrito.forEach(function(n,e){var o=n.precio_venta,a=0;n.tallas.forEach(function(t){a+=o*t.cantidad}),t.carrito[e].subtotal=a})}),"reordenarCarrito",function(){this.carrito.sort(function(t,n){return t.producto_id===n.producto_id?t.color_id-n.color_id:t.producto_id-n.producto_id})}),"validarCantidadCarrito",function(t){var n=this;return L(T().m(function e(){var o,a;return T().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n.getStockLogico(t);case 1:return o=e.v,a=t.value,e.a(2,o>=a)}},e)}))()}),"clearInputsCantidad",function(){document.querySelectorAll(".inputCantidad").forEach(function(t){t.value=""})}),"agregarProducto",function(){var t=this;return L(T().m(function n(){var e,o,a;return T().w(function(n){for(;;)switch(n.p=n.n){case 0:if(toastr.clear(),t.precioVentaSeleccionado){n.n=1;break}return toastr.error("DEBE SELECCIONAR UN PRECIO DE VENTA!!!"),n.a(2);case 1:if(t.almacenSeleccionado){n.n=2;break}return toastr.clear(),toastr.error("DEBES SELECCIONAR UN ALMACÉN!!!"),t.$nextTick(function(){t.$parent.$refs.selectAlmacen.$el.querySelector("input").focus()}),t.$parent.ocultarAnimacionVenta(),n.a(2);case 2:if(t.$parent.mostrarAnimacionVenta(),(e=t.getInputProductos()).validacion){n.n=3;break}return t.$parent.ocultarAnimacionVenta(),n.a(2);case 3:return n.p=3,n.n=4,t.actualizarStockLogicoVentas(t.almacenSeleccionado,e.lstInputProducts);case 4:if((o=n.v).data.success){n.n=5;break}return toastr.error(o.data.message,"ERROR EN EL SERVIDOR"),t.$parent.ocultarAnimacionVenta(),n.a(2);case 5:t.asegurarCierre=1,toastr.success(o.data.message,"OPERACIÓN COMPLETADA"),t.agregarCarrito(e.lstInputProducts),t.clearInputsCantidad(),t.getColoresTallas(),t.reordenarCarrito(),t.calcularSubTotal(),t.calcularMontos(),t.carrito.forEach(function(n){t.calcularDescuento(n.producto_id,n.color_id,n.porcentaje_descuento)}),console.log("CARRITO",t.carrito),n.n=7;break;case 6:n.p=6,a=n.v,toastr.error(a,"ERROR AL AGREGAR PRODUCTO!!!");case 7:t.$parent.ocultarAnimacionVenta(),console.log(t.asegurarCierre),console.log(t.carrito);case 8:return n.a(2)}},n,null,[[3,6]])}))()}),"validarStockVentas",function(t,n){return L(T().m(function e(){var o;return T().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,axios.post(route("ventas.documento.validarStockVentas"),{almacenId:t,lstInputProducts:JSON.stringify(n)});case 1:return o=e.v,e.a(2,o)}},e)}))()}),"actualizarStockLogicoVentas",function(t,n){return L(T().m(function e(){var o;return T().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,axios.post(route("ventas.documento.actualizarStockAdd"),{almacenId:t,lstInputProducts:JSON.stringify(n)});case 1:return o=e.v,e.a(2,o)}},e)}))()}),"agregarCarrito",function(t){var n=this;t.forEach(function(t){var e=n.carrito.findIndex(function(n){return n.producto_id==t.producto_id&&n.color_id==t.color_id});if(console.log("existe carrito",e),-1==e){var o={almacen_id:t.almacen_id,producto_id:t.producto_id,color_id:t.color_id,producto_nombre:t.producto_nombre,color_nombre:t.color_nombre,precio_venta:t.precio_venta,monto_descuento:0,porcentaje_descuento:0,precio_venta_nuevo:0,subtotal_nuevo:0,tallas:[{talla_id:t.talla_id,talla_nombre:t.talla_nombre,cantidad:t.cantidad}]};n.carrito.push(o)}else{var a=n.carrito[e];if(a.precio_venta=t.precio_venta,-1===a.tallas.findIndex(function(n){return n.talla_id==t.talla_id})){var r={talla_id:t.talla_id,talla_nombre:t.talla_nombre,cantidad:t.cantidad};console.log("".concat(a.producto_nombre," - ").concat(a.color_nombre)),n.carrito[e].tallas.push(r),console.log(n.carrito)}}})}),"getInputProductos",function(){for(var t=this,n=document.querySelectorAll(".inputCantidad"),e=[],o=!0,a=function(){var a=n[r];if(a.value){var i=t.formarProducto(a),c=t.carrito.findIndex(function(t){return t.producto_id==i.producto_id&&t.color_id==i.color_id});if(-1!==c){var s=t.carrito[c].tallas.findIndex(function(t){return t.talla_id==i.talla_id});if(-1!==s)return toastr.error("YA FUE AGREGADO!! ".concat(t.carrito[c].producto_nombre,"-").concat(t.carrito[c].color_nombre,"-").concat(t.carrito[c].tallas[s].talla_nombre)),o=!1,1}e.push(i)}},r=0;r<n.length&&!a();r++);return{validacion:o,lstInputProducts:e}}),"actualizarStockLogico",function(t,n,e){var o=this;return L(T().m(function a(){return T().w(function(a){for(;;)switch(a.p=a.n){case 0:return o.asegurarCierre="eliminar"==n?0:1,a.p=1,a.n=2,o.axios.post(route("ventas.documento.cantidad"),{producto_id:t.producto_id,color_id:t.color_id,talla_id:t.talla_id,cantidad:t.cantidad,condicion:o.asegurarCierre,modo:n,cantidadAnterior:e,tallas:t.tallas});case 2:a.n=4;break;case 3:a.p=3,a.v;case 4:return a.a(2)}},a,null,[[1,3]])}))()}),N(N(N(N(N(N(N(N(N(N(I,"formarProducto",function(t){var n=t.getAttribute("data-almacen-id"),e=t.getAttribute("data-producto-id"),o=t.getAttribute("data-producto-nombre"),a=t.getAttribute("data-color-id"),r=t.getAttribute("data-color-nombre"),i=t.getAttribute("data-talla-id"),c=t.getAttribute("data-talla-nombre"),s=this.precioVentaSeleccionado;return{almacen_id:n,producto_id:e,producto_nombre:o,color_id:a,color_nombre:r,talla_id:i,talla_nombre:c,cantidad:t.value?t.value:0,precio_venta:s,monto_descuento:0,porcentaje_descuento:0,precio_venta_nuevo:0,subtotal_nuevo:0}}),"validarContenidoInput",function(t){t.target.value=t.target.value.replace(/^0+|[^0-9]/g,""),this.validarCantidadInstantanea(t)}),"validarCantidadInstantanea",function(t){var n=this;return L(T().m(function e(){var o,a,r;return T().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=t.target.value,e.p=1,""===o){e.n=3;break}return e.n=2,n.getStockLogico(t.target);case 2:(a=e.v)<o?(t.target.classList.add("inputCantidadIncorrecto"),t.target.classList.remove("inputCantidadValido"),t.target.focus(),n.deshabilitarBtnAgregar=!0,toastr.error("Cantidad solicitada: ".concat(o,", debe ser menor o igual\n                            al stock lógico: ").concat(a),"Error")):(t.target.classList.add("inputCantidadValido"),t.target.classList.remove("inputCantidadIncorrecto"),n.deshabilitarBtnAgregar=!1),e.n=4;break;case 3:n.deshabilitarBtnAgregar=!1,t.target.classList.remove("inputCantidadIncorrecto"),t.target.classList.remove("inputCantidadValido");case 4:e.n=6;break;case 5:e.p=5,r=e.v,toastr.error("El producto no cuenta con registros en esa talla","Error"),t.target.value="",console.error("Error al obtener stock logico:",r);case 6:return e.a(2)}},e,null,[[1,5]])}))()}),"getProductos",function(){var t=this;return L(T().m(function n(){var e,o,a,r,i;return T().w(function(n){for(;;)switch(n.p=n.n){case 0:if(toastr.clear(),e=t.modeloSeleccionado,o=t.marcaSeleccionada,a=t.categoriaSeleccionada,!(e||o||a)){n.n=5;break}return n.p=1,n.n=2,axios.get(route("ventas.documento.getProductos"),{params:{modelo_id:e,marca_id:o,categoria_id:a}});case 2:(r=n.v).data.success?(t.productos=r.data.productos,t.productoSeleccionado=null,t.precioVentaSeleccionado=null,toastr.info("PRODUCTOS CARGADOS","OPERACIÓN COMPLETADA")):toastr.error(r.data.message,"ERROR EN EL SERVIDOR"),n.n=4;break;case 3:n.p=3,i=n.v,toastr.error(i,"ERROR EN LA PETICIÓN DE OBTENER PRODUCTOS");case 4:n.n=5;break;case 5:return n.a(2)}},n,null,[[1,3]])}))()}),"getColoresTallas",function(){var t=this;return L(T().m(function n(){var e,o,a,r;return T().w(function(n){for(;;)switch(n.p=n.n){case 0:if(t.$parent.mostrarAnimacionVenta(),e=t.productoSeleccionado.producto_id,o=t.almacenSeleccionado,e){n.n=1;break}return t.$parent.ocultarAnimacionVenta(),n.a(2);case 1:if(t.almacenSeleccionado){n.n=2;break}return toastr.clear(),toastr.error("DEBES SELECCIONAR UN ALMACÉN!!!"),t.$nextTick(function(){t.$parent.$refs.selectAlmacen.$el.querySelector("input").focus()}),t.$parent.ocultarAnimacionVenta(),n.a(2);case 2:if(!e){n.n=7;break}return n.p=3,n.n=4,axios.get(route("ventas.documento.getColoresTallas",{almacen_id:o,producto_id:e}));case 4:(a=n.v).data.success?(t.productosPorModelo=a.data,t.preciosVenta=a.data.precios_venta):toastr.error(a.data.message,"ERROR EN EL SERVIDOR"),n.n=6;break;case 5:n.p=5,r=n.v,toastr.error(r,"ERROR EN LA PETICIÓN OBTENER COLORES Y TALLAS");case 6:return n.p=6,n.f(6);case 7:t.$parent.ocultarAnimacionVenta();case 8:return n.a(2)}},n,null,[[3,5,6,7]])}))()}),"printStockLogico",function(t,n,e){var o=this.productosPorModelo.stocks.find(function(o){return o.producto_id===t&&o.color_id===n&&o.talla_id===e});return o?o.stock_logico:0}),"devolverCantidades",function(){var t=this;return L(T().m(function n(){return T().w(function(n){for(;;)switch(n.n){case 0:if(console.log("ASEGURAR CIERRE",t.asegurarCierre),1!=t.asegurarCierre){n.n=2;break}return console.log("DEVOLVIENDO STOCK"),n.n=1,t.axios.post(route("ventas.documento.devolverCantidades"),{carrito:JSON.stringify(t.carrito)});case 1:t.ChangeAsegurarCierre();case 2:return n.a(2)}},n)}))()}),"ObtenerCodigoPrecioMenor",function(){var t=this;return L(T().m(function n(){var e,o;return T().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,t.axios.get(route("consulta.ajax.getCodigoPrecioMenor"));case 1:e=n.v,o=e.data,t.dataEmpresa=o,n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,null,[[0,2]])}))()}),"AgregarDatos",function(t){this.tablaDetalles.push(t),this.formDetalles.precio="",this.formDetalles.cantidad="",this.formDetalles.producto_id="",this.formDetalles.producto_unidad="",this.formDetalles.producto_lote=""}),"buscarProductoAdded",function(t){return!!this.tablaDetalles.find(function(n){return Number(n.producto_id)==Number(t)})}),N(N(N(N(N(N(I,"TransformarNumber",function(t){return t&&!isNaN(Number(t))?parseFloat(t):t}),"actualizarStockDelete",function(t){return L(T().m(function n(){var e;return T().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,axios.post(route("ventas.documento.actualizarStockDelete"),{almacen_id:t.almacen_id,producto_id:t.producto_id,color_id:t.color_id,tallas:JSON.stringify(t.tallas)});case 1:return e=n.v,n.a(2,e)}},n)}))()}),"EliminarItem",function(t,n){var e=this;return L(T().m(function o(){var a;return T().w(function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,toastr.clear(),e.$parent.mostrarAnimacionVenta(),o.n=1,e.actualizarStockDelete(t);case 1:o.v.data.success||toastr.error(res.data.message,"ERROR EN EL SERVIDOR AL DEVOLVER STOCK LÓGICO!!!"),e.getColoresTallas(),e.carrito.splice(n,1),e.calcularMontos(),e.$parent.ocultarAnimacionVenta(),toastr.info("ITEM ELIMINADO","CANTIDAD DEVUELTA"),o.n=3;break;case 2:o.p=2,a=o.v,toastr.error(a,"ERROR EN LA PETICIÓN ELIMINAR ITEM!!!");case 3:return o.a(2)}},o,null,[[0,2]])}))()}),"ChangeAsegurarCierre",function(){this.asegurarCierre=5,console.log("devuelto",this.asegurarCierre)}),"getProductoBarCode",function(t){var n=this;return L(T().m(function e(){var o,a,r,i,c,s;return T().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,toastr.clear(),n.$parent.mostrarAnimacionVenta(),e.n=1,axios.get(route("ventas.documento.getProductoBarCode",{barcode:t}));case 1:if(!(o=e.v).data.success){e.n=5;break}if(toastr.info("BUSCANDO PRODUCTO"),o.data.producto.cantidad=1,o.data.producto.almacen_id=n.almacenSeleccionado,a=[o.data.producto],-1,i=-1,-1!==(r=n.carrito.findIndex(function(t){return t.producto_id==o.data.producto.producto_id&&t.color_id==o.data.producto.color_id}))&&(i=n.carrito[r].tallas.findIndex(function(t){return t.talla_id==o.data.producto.talla_id})),-1===i){e.n=2;break}return toastr.error("".concat(o.data.producto.producto_nombre,"-").concat(o.data.producto.color_nombre,"-").concat(o.data.producto.talla_nombre),"ERROR, YA EXISTE EN EL DETALLE!!!"),e.a(2);case 2:return e.n=3,n.actualizarStockLogicoVentas(n.almacenSeleccionado,a);case 3:if((c=e.v).data.success){e.n=4;break}return toastr.error(c.data.message,"ERROR EN EL SERVIDOR"),e.a(2);case 4:n.asegurarCierre=1,n.agregarCarrito(a),n.clearInputsCantidad(),n.getColoresTallas(),n.reordenarCarrito(),n.calcularSubTotal(),n.calcularMontos(),n.carrito.forEach(function(t){n.calcularDescuento(t.producto_id,t.color_id,t.porcentaje_descuento)}),toastr.info("AGREGADO AL DETALLE!!!","".concat(o.data.producto.producto_nombre," - ").concat(o.data.producto.color_nombre," - ").concat(o.data.producto.talla_nombre,"\n                                PRECIO: ").concat(o.data.producto.precio_venta),{timeOut:0}),e.n=6;break;case 5:toastr.error(o.data.message,"ERROR EN EL SERVIDOR");case 6:e.n=8;break;case 7:e.p=7,s=e.v,toastr.error(s,"ERROR EN LA PETICIÓN OBTENER PRODUCTO POR CÓDIGO DE BARRA");case 8:return e.p=8,n.$parent.ocultarAnimacionVenta(),e.f(8);case 9:return e.a(2)}},e,null,[[0,7,8,9]])}))()}),"limpiarFormularioDetalle",function(){var t=this;return L(T().m(function n(){return T().w(function(n){for(;;)switch(n.n){case 0:return t.$parent.mostrarAnimacionVenta(),n.n=1,t.devolverCantidades();case 1:t.carrito=[],t.productosPorModelo=[],t.productos=[],t.productoSeleccionado="",t.precioVentaSeleccionado="",t.$parent.ocultarAnimacionVenta();case 2:return n.a(2)}},n)}))()}))};var M=e(1585),V={insert:"head",singleton:!1};l()(M.A,V);M.A.locals;const B=(0,p.A)(k,function(){var t=this,n=t._self._c;return n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-12"},[n("div",{staticClass:"panel panel-primary"},[t._m(0),t._v(" "),t._m(1),t._v(" "),n("div",{staticClass:"panel-body ibox-content"},[0==t.idcotizacion?n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-12 col-md-3 col-sm-12 col-xs-12 mt-3"},[n("label",{staticClass:"required",staticStyle:{"font-weight":"bold"}},[t._v("CATEGORÍA - MARCA - MODELO - PRODUCTO")]),t._v(" "),n("v-select",{attrs:{options:t.productos,label:"producto_completo",placeholder:"Seleccionar",loading:t.loadingProductos},on:{search:t.buscarProducto},model:{value:t.productoSeleccionado,callback:function(n){t.productoSeleccionado=n},expression:"productoSeleccionado"}})],1),t._v(" "),n("div",{staticClass:"col-lg-3 col-md-3 col-sm-12 col-xs-12 mt-3"},[n("label",{staticClass:"required",staticStyle:{"font-weight":"bold"}},[t._v("PRECIO VENTA")]),t._v(" "),n("v-select",{attrs:{options:t.preciosVenta,placeholder:"Seleccionar"},model:{value:t.precioVentaSeleccionado,callback:function(n){t.precioVentaSeleccionado=n},expression:"precioVentaSeleccionado"}})],1),t._v(" "),n("div",{staticClass:"col-12 mt-3"},[n("label",{staticStyle:{"font-weight":"bold"}},[t._v("CÓDIGO BARRA")]),t._v(" "),n("div",{staticClass:"input-group mb-3"},[t._m(2),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.buscarCodigoBarra,expression:"buscarCodigoBarra"}],staticClass:"inputBarCode form-control",attrs:{maxlength:"8",type:"text",placeholder:"Escriba el código de barra","aria-label":"Username","aria-describedby":"basic-addon1"},domProps:{value:t.buscarCodigoBarra},on:{input:function(n){n.target.composing||(t.buscarCodigoBarra=n.target.value)}}})])]),t._v(" "),n("input",{attrs:{type:"hidden",name:"producto_id",id:"producto_id"}}),t._v(" "),n("input",{attrs:{type:"hidden",name:"producto_unidad",id:"producto_unidad"}}),t._v(" "),n("input",{attrs:{type:"hidden",name:"producto_json",id:"producto_json"}})]):t._e(),t._v(" "),n("hr"),t._v(" "),n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-sm table-striped table-bordered table-hover",staticStyle:{"text-transform":"uppercase"},attrs:{id:"table-stocks"}},[n("thead",[n("tr",[n("th",[t._v("PRODUCTO")]),t._v(" "),t._l(t.tallas,function(e){return[n("th",{staticClass:"colorStockLogico"},[t._v("\n                                        "+t._s(e.descripcion)+"\n                                    ")]),t._v(" "),n("th",[t._v("CANT")])]})],2)]),t._v(" "),n("tbody",t._l(t.productosPorModelo.producto_colores,function(e){return n("tr",{key:"".concat(e.producto_id).concat(e.color_id)},[n("td",[t._v(t._s(e.producto_nombre)+" - "+t._s(e.color_nombre))]),t._v(" "),t._l(t.tallas,function(o){return[n("td",{staticClass:"colorStockLogico"},[n("span",[t._v("\n                                            "+t._s(t.printStockLogico(e.producto_id,e.color_id,o.id))+"\n                                        ")])]),t._v(" "),t.printStockLogico(e.producto_id,e.color_id,o.id)>0?n("td",{staticStyle:{width:"5%"}},[n("input",{staticClass:"form-control inputCantidad inputCantidadColor",attrs:{type:"text","data-almacen-id":e.almacen_id,"data-producto-id":e.producto_id,"data-producto-nombre":e.producto_nombre,"data-color-nombre":e.color_nombre,"data-talla-nombre":o.descripcion,"data-color-id":e.color_id,"data-talla-id":o.id,disabled:0===t.printStockLogico(e.producto_id,e.color_id,o.id)},on:{input:function(n){return t.validarContenidoInput(n)}}})]):n("td")]})],2)}),0),t._v(" "),n("tfoot")])]),t._v(" "),n("div",{staticClass:"form-group row mt-1"},[n("div",{staticClass:"col-lg-2 col-xs-12"},[n("button",{staticClass:"btn btn-warning btn-block",attrs:{disabled:t.deshabilitarBtnAgregar,type:"button",id:"btn_agregar_detalle"},on:{click:t.agregarProducto}},[n("i",{staticClass:"fa fa-plus"}),t._v(" AGREGAR\n                        ")])])])])]),t._v(" "),n("div",{staticClass:"panel panel-primary"},[t._m(3),t._v(" "),n("div",{staticClass:"panel-body ibox-content"},[n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-sm table-striped table-bordered table-hover",staticStyle:{"text-transform":"uppercase"}},[n("thead",[n("tr",[t._m(4),t._v(" "),n("th",{staticClass:"text-center"},[t._v("PRODUCTO")]),t._v(" "),t._l(t.tallas,function(e){return[n("th",{staticClass:"text-center"},[t._v(t._s(e.descripcion))])]}),t._v(" "),n("th",{staticClass:"text-center"},[t._v("P. VENTA")]),t._v(" "),n("th",{staticClass:"text-center"},[t._v("SUBTOTAL")]),t._v(" "),n("th",{staticClass:"text-center"},[t._v("DSCTO %")])],2)]),t._v(" "),n("tbody",[t.carrito.length>0?t._l(t.carrito,function(e,o){return n("tr",{key:o},[n("td",{staticClass:"text-center"},[n("div",{staticClass:"btn-group"},[n("button",{staticClass:"btn btn-sm btn-warning btn-edit",staticStyle:{color:"white"},attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.openModal(e)}}},[n("i",{staticClass:"fa fa-edit"})]),t._v(" "),n("button",{staticClass:"btn btn-sm btn-danger btn-delete",staticStyle:{color:"white"},attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.EliminarItem(e,o)}}},[n("i",{staticClass:"fa fa-trash"})])])]),t._v(" "),n("td",{staticClass:"text-center"},[n("div",{staticStyle:{width:"160px"}},[t._v("\n                                            "+t._s(e.producto_nombre)+"-"+t._s(e.color_nombre)+"\n                                        ")])]),t._v(" "),t._l(t.tallas,function(o){return n("td",[n("p",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.printTallaDetalle(o.id,e)))])])}),t._v(" "),n("td",[t._v(t._s(0!=e.porcentaje_descuento?e.precio_venta_nuevo:e.precio_venta))]),t._v(" "),n("td",[t._v(t._s(0!=e.porcentaje_descuento?e.subtotal_nuevo:e.subtotal))]),t._v(" "),n("td",[n("input",{staticClass:"form-control",staticStyle:{width:"100px"},attrs:{type:"text"},domProps:{value:e.porcentaje_descuento},on:{input:function(n){return t.validarDescuento(e.producto_id,e.color_id,n)}}})])],2)}):[n("tr",[n("td",{staticClass:"text-center",attrs:{colspan:t.tallas.length+5}},[n("strong",[t._v("No hay detalles")])])])]],2)])]),t._v(" "),n("div",{staticClass:"col-12 d-flex justify-content-end"},[n("div",{staticClass:"table-responsive"},[n("table",{staticStyle:{margin:"0 0 0 auto"}},[n("tfoot",[n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("SUBTOTAL:")]),t._v(" "),n("td",{staticClass:"subtotal",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[t._v("\n                                            "+t._s("S/. ".concat(Number(t.monto_subtotal).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")))+"\n                                        ")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("EMBALAJE:")]),t._v(" "),n("td",{staticClass:"total",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[n("div",{staticClass:"input-group"},[n("span",{staticClass:"input-group-text",attrs:{id:"basic-addon1"}},[n("svg",{staticStyle:{width:"20px"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"}},[t._v("<!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.>"),n("path",{attrs:{d:"M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2 .3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"}})])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.monto_embalaje,expression:"monto_embalaje"}],staticClass:"form-control",staticStyle:{width:"70px"},attrs:{type:"text","aria-label":"PRECIO DESPACHO","aria-describedby":"basic-addon1"},domProps:{value:t.monto_embalaje},on:{input:function(n){n.target.composing||(t.monto_embalaje=n.target.value)}}})])])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("ENVÍO:")]),t._v(" "),n("td",{staticClass:"total",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[n("div",{staticClass:"input-group"},[n("span",{staticClass:"input-group-text btn btn-light",attrs:{id:"basic-addon1"},on:{click:function(n){return n.preventDefault(),t.setDataEnvio.apply(null,arguments)}}},[n("svg",{staticStyle:{width:"20px"},attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512"}},[t._v("<!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.>"),n("path",{attrs:{d:"M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h16c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"}})])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.monto_envio,expression:"monto_envio"}],staticClass:"form-control",staticStyle:{width:"70px"},attrs:{type:"text","aria-label":"PRECIO ENVÍO","aria-describedby":"basic-addon1"},domProps:{value:t.monto_envio},on:{input:function(n){n.target.composing||(t.monto_envio=n.target.value)}}})])])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("DESCUENTO:")]),t._v(" "),n("td",{staticClass:"total",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[n("span",[t._v(t._s("S/. ".concat(Number(t.monto_descuento).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","))))])])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("MONTO TOTAL:")]),t._v(" "),n("td",{staticClass:"total",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[t._v("\n                                            "+t._s("S/. ".concat(Number(t.monto_total).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")))+"\n                                        ")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("IGV:")]),t._v(" "),n("td",{staticClass:"igv",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[t._v("\n                                            "+t._s("S/. ".concat(Number(t.monto_igv).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")))+"\n                                        ")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:t.tallas.length+4}},[t._v("MONTO TOTAL A PAGAR:")]),t._v(" "),n("td",{staticClass:"total",staticStyle:{"font-weight":"bold","text-align":"end"},attrs:{colspan:"1"}},[t._v("\n                                            "+t._s("S/. ".concat(Number(t.monto_total_pagar).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")))+"\n                                        ")])])])])])])])]),t._v(" "),n("ModalEnvioVue",{attrs:{cliente:t.cliente},on:{addDataEnvio:t.addDataEnvio}})],1)])},[function(){var t=this._self._c;return t("div",{staticClass:"overlay",attrs:{id:"overlay"}},[t("div",{staticClass:"fulfilling-bouncing-circle-spinner"},[t("div",{staticClass:"circle"}),this._v(" "),t("div",{staticClass:"orbit"})])])},function(){var t=this._self._c;return t("div",{staticClass:"panel-heading"},[t("h4",{},[t("b",[this._v("Seleccionar productos")])])])},function(){var t=this._self._c;return t("div",{staticClass:"input-group-prepend"},[t("span",{staticClass:"input-group-text",attrs:{id:"basic-addon1"}},[t("i",{staticClass:"fas fa-barcode"})])])},function(){var t=this._self._c;return t("div",{staticClass:"panel-heading"},[t("h4",{},[t("b",[this._v("Detalle del documento de venta")])])])},function(){var t=this._self._c;return t("th",{staticClass:"text-center"},[t("i",{staticClass:"fa fa-dashboard"})])}],!1,null,null,null).exports;function j(){var t,n,e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function r(e,o,a,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return F(l,"_invoke",function(e,o,a){var r,c,s,l=0,d=a||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(n,e){return r=n,c=0,s=t,p.n=e,i}};function m(e,o){for(c=e,s=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],m=p.p,f=r[2];e>3?(a=f===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=m&&((a=e<2&&m<r[1])?(c=0,p.v=o,p.n=r[1]):m<f&&(a=e<3||r[0]>o||o>f)&&(r[4]=e,r[5]=o,p.n=f,c=0))}if(a||e>1)return i;throw u=!0,o}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(n=c<2?t:s)||!u;){r||(c?c<3?(c>1&&(p.n=-1),m(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(a="next"),n=r[a]){if(!(n=n.call(r,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=r.return)&&n.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);r=t}else if((n=(u=p.n<0)?s:e.call(o,p))!==i)break}catch(n){r=t,c=1,s=n}finally{l=1}}return{value:n,done:u}}}(e,a,r),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var d=[][o]?n(n([][o]())):(F(n={},o,function(){return this}),n),u=l.prototype=c.prototype=Object.create(d);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,F(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,F(u,"constructor",l),F(l,"constructor",s),s.displayName="GeneratorFunction",F(l,a,"GeneratorFunction"),F(u),F(u,a,"Generator"),F(u,o,function(){return this}),F(u,"toString",function(){return"[object Generator]"}),(j=function(){return{w:r,m:p}})()}function F(t,n,e,o){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}F=function(t,n,e,o){if(n)a?a(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e;else{var r=function(n,e){F(t,n,function(t){return this._invoke(n,e,t)})};r("next",0),r("throw",1),r("return",2)}},F(t,n,e,o)}function U(t,n,e,o,a,r,i){try{var c=t[r](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(o,a)}const G={name:"Modal",props:{title:{type:String,default:"Modal Title"},visible:{type:Boolean,default:!1},tallas:{type:Array,default:[]},tallasProducto:{type:Array,default:function(){return[]}},productoEditar:{type:Object,default:function(){return{producto_id:null,color_id:null}}},detalleVenta:{type:Array,default:function(){return[]}}},data:function(){return{cantidadPorTalla:[]}},emits:["close"],methods:{getCantidadForTalla:function(t){var n=this.tallasProducto.find(function(n){return n.talla_id==t});return n?n.cantidad:""},closeModal:function(){this.setCantTallaOriginal(),this.$emit("close")},confirm:function(){var t,n=this;return(t=j().m(function t(){var e,o,a,r,i;return j().w(function(t){for(;;)switch(t.n){case 0:if(console.log("PRODUCTO EDITAR",n.productoEditar),console.log("CANTIDAD POR TALLA",n.cantidadPorTalla),console.log("PRODUCTOS TABLA",n.detalleVenta),n.$parent.mostrarAnimacionVenta(),e=n.$parent.almacenSeleccionado){t.n=1;break}return toastr.clear(),toastr.error("DEBES SELECCIONAR UN ALMACÉN!!!"),n.$nextTick(function(){n.$parent.$refs.selectAlmacen.$el.querySelector("input").focus()}),n.$parent.ocultarAnimacionVenta(),t.a(2);case 1:return o=n.cantidadPorTalla.filter(function(t){return"0"!=t.cantidad&&""!=t.cantidad}),a=n.detalleVenta.findIndex(function(t){return t.producto_id==n.productoEditar.producto_id&&t.color_id==n.productoEditar.color_id}),r=[],n.cantidadPorTalla.forEach(function(t){var e=n.detalleVenta[a].tallas.findIndex(function(n){return n.talla_id==t.talla_id}),o={};o=-1===e?{producto_id:n.productoEditar.producto_id,color_id:n.productoEditar.color_id,talla_id:t.talla_id,cantidad_actual:t.cantidad,cantidad_anterior:0}:{producto_id:n.productoEditar.producto_id,color_id:n.productoEditar.color_id,talla_id:t.talla_id,cantidad_actual:t.cantidad,cantidad_anterior:n.detalleVenta[a].tallas[e].cantidad},r.push(o)}),r=r.filter(function(t){return!("0"==t.cantidad_actual&&"0"==t.cantidad_anterior||""==t.cantidad_actual&&""==t.cantidad_anterior)}),console.log("CANTIDADES EDIT",r),t.n=2,axios.post(route("ventas.documento.actualizarStockEdit"),{almacenId:e,lstProductos:JSON.stringify(r)});case 2:if(!(i=t.v).data.success){t.n=3;break}toastr.success(i.data.message,"OPERACIÓN COMPLETADA"),t.n=4;break;case 3:return toastr.error(i.data.message,"ERROR EN EL SERVIDOR"),n.$parent.ocultarAnimacionVenta(),t.a(2);case 4:0===o.length?-1!==a&&n.detalleVenta.splice(a,1):n.detalleVenta[a].tallas=o,n.$parent.ocultarAnimacionVenta(),n.closeModal();case 5:return t.a(2)}},t)}),function(){var n=this,e=arguments;return new Promise(function(o,a){var r=t.apply(n,e);function i(t){U(r,o,a,i,c,"next",t)}function c(t){U(r,o,a,i,c,"throw",t)}i(void 0)})})()},beforeEnter:function(t){t.style.opacity=0,t.style.transform="scale(0.8)"},enter:function(t,n){t.offsetHeight,t.style.transition="opacity 0.3s ease, transform 0.3s ease",t.style.opacity=1,t.style.transform="scale(1)",n(),this.setCantTallaOriginal(),console.log("talla_Agregar",this.cantidadPorTalla)},setCantTallaOriginal:function(){var t=this;this.cantidadPorTalla=[],this.tallas.forEach(function(n){var e=t.tallasProducto.find(function(t){return t.talla_id==n.id}),o={talla_id:n.id,talla_nombre:n.descripcion,cantidad:e?e.cantidad:0};t.cantidadPorTalla.push(o)})},beforeLeave:function(t){t.style.transition="opacity 0.3s ease, transform 0.3s ease"},leave:function(t,n){t.style.opacity=0,t.style.transform="scale(0.8)",n()}}};var q=e(7996),z={insert:"head",singleton:!1};l()(q.A,z);q.A.locals;function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function J(){var t,n,e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",a=e.toStringTag||"@@toStringTag";function r(e,o,a,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return H(l,"_invoke",function(e,o,a){var r,c,s,l=0,d=a||[],u=!1,p={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(n,e){return r=n,c=0,s=t,p.n=e,i}};function m(e,o){for(c=e,s=o,n=0;!u&&l&&!a&&n<d.length;n++){var a,r=d[n],m=p.p,f=r[2];e>3?(a=f===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=m&&((a=e<2&&m<r[1])?(c=0,p.v=o,p.n=r[1]):m<f&&(a=e<3||r[0]>o||o>f)&&(r[4]=e,r[5]=o,p.n=f,c=0))}if(a||e>1)return i;throw u=!0,o}return function(a,d,f){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,f),c=d,s=f;(n=c<2?t:s)||!u;){r||(c?c<3?(c>1&&(p.n=-1),m(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(a="next"),n=r[a]){if(!(n=n.call(r,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=r.return)&&n.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),c=1);r=t}else if((n=(u=p.n<0)?s:e.call(o,p))!==i)break}catch(n){r=t,c=1,s=n}finally{l=1}}return{value:n,done:u}}}(e,a,r),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var d=[][o]?n(n([][o]())):(H(n={},o,function(){return this}),n),u=l.prototype=c.prototype=Object.create(d);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,H(t,a,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=l,H(u,"constructor",l),H(l,"constructor",s),s.displayName="GeneratorFunction",H(l,a,"GeneratorFunction"),H(u),H(u,a,"Generator"),H(u,o,function(){return this}),H(u,"toString",function(){return"[object Generator]"}),(J=function(){return{w:r,m:p}})()}function H(t,n,e,o){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}H=function(t,n,e,o){if(n)a?a(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e;else{var r=function(n,e){H(t,n,function(t){return this._invoke(n,e,t)})};r("next",0),r("throw",1),r("return",2)}},H(t,n,e,o)}function K(t,n,e,o,a,r,i){try{var c=t[r](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(o,a)}function W(t){return function(){var n=this,e=arguments;return new Promise(function(o,a){var r=t.apply(n,e);function i(t){K(r,o,a,i,c,"next",t)}function c(t){K(r,o,a,i,c,"throw",t)}i(void 0)})}}function X(t,n,e){return(n=function(t){var n=function(t,n){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,n||"default");if("object"!=Y(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==Y(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}const Q={name:"VentaCreate",components:{ModalClienteVue:m,TablaProductos:B,EditarItemVue:(0,p.A)(G,function(){var t=this,n=t._self._c;return n("transition",{attrs:{name:"fade"},on:{"before-enter":t.beforeEnter,enter:t.enter,"before-leave":t.beforeLeave,leave:t.leave}},[t.visible?n("div",{staticClass:"modal-overlay"},[n("div",{staticClass:"modal-container d-flex flex-column"},[n("div",{staticClass:"modal-header"},[n("h3",[t._v(t._s(t.title))]),t._v(" "),n("button",{staticClass:"close-button",on:{click:t.closeModal}},[t._v("×")])]),t._v(" "),n("div",{staticClass:"modal-body"},[n("div",{staticClass:"table-responsive"},[n("table",{staticClass:"table table-striped"},[n("thead",[n("tr",t._l(t.tallas,function(e){return n("th",{key:e.id},[t._v(t._s(e.descripcion))])}),0)]),t._v(" "),n("tbody",[n("tr",t._l(t.cantidadPorTalla,function(e){return n("td",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.cantidad,expression:"cantidad_talla.cantidad"}],staticClass:"form-control",staticStyle:{width:"60px"},attrs:{min:"0",type:"text"},domProps:{value:e.cantidad},on:{input:[function(n){n.target.composing||t.$set(e,"cantidad",n.target.value)},function(t){e.cantidad=/^[0-9]+$/.test(e.cantidad)?parseInt(e.cantidad):0}]}})])}),0)])])])]),t._v(" "),n("div",{staticClass:"modal-footer"},[n("button",{staticClass:"btn btn-primary",on:{click:t.confirm}},[t._v("Guardar")]),t._v(" "),n("button",{staticClass:"btn btn-secondary",on:{click:t.closeModal}},[t._v("Cancelar")])])])]):t._e()])},[],!1,null,"21151dd8",null).exports},props:{ruta:{type:String,required:!0},idcotizacion:{type:Number,default:0},v_sede:{default:null},lst_departamentos_base:{type:Array,default:[]},lst_provincias_base:{type:Array,default:[]},lst_distritos_base:{type:Array,default:[]},lst_almacenes:{type:Array,default:[]},registrador:{type:Object,default:[]}},data:function(){return{productoEditar:{producto_id:null,color_id:null},tallasProductoEdit:[],modalTitle:"",modalVisible:!1,almacenSeleccionado:null,checkDespacho:!1,checkEnvio:!1,initData:{clientes:[],condiciones:[],dolar:0,empresas:[],fecha_hoy:"",fullaccess:!1,vista:"",tipoVentas:[],modelos:[],categorias:[],marcas:[],tallas:[],sede_id:null},formCreate:X(X(X(X(X(X(X({fecha_documento_campo:"",fecha_atencion_campo:"",fecha_vencimiento_campo:"",tipo_venta:"",condicion_id:"",cliente_id:"",tipo_pago_id:null,efectivo:0,importe:0,empresa_id:0,observacion:"",igv:18,igv_check:!0,cotizacion_id:null,productos_tabla:"",envio_sunat:!1},"igv",18),"monto_sub_total",0),"monto_total_igv",0),"monto_total",0),"tipo_cliente_documento",null),"moneda","SOLES"),"data_envio",JSON.stringify({})),tipo_venta:"",condicion_id:"",cliente_id:{cliente:"",documento:"",id:0,nombre:"",tabladetalles_id:0,tipo_documento:""},loading:!0,loadingClienteNew:!1,paramsLotes:{tipo_cliente:"",tipocomprobante:""},FullaccessTable:!1,productos_tabla:[],estadoFechaVenc:!0,disabledBtnProducto:!0}},filters:{truncate:function(t,n){return t.split("").slice(0,n).join("")}},watch:{almacenSeleccionado:{handler:function(t){this.$refs.tablaProductos.limpiarFormularioDetalle()}},productos_tabla:{handler:function(t){this.formCreate.productos_tabla=JSON.stringify(t)},deep:!0},initData:{handler:function(t){var n=this,e=t.tipoVentas,o=t.condiciones,a=t.clientes,r=t.empresas;this.FullaccessTable=t.fullaccess,a.forEach(function(t){t.cliente="".concat(t.tipo_documento,":").concat(t.documento,"-").concat(t.nombre)}),this.loadingClienteNew||(this.cliente_id=a[0],this.formCreate.empresa_id=r.length>0?r[0].id:0,e.forEach(function(t){129==t.id&&(n.tipo_venta=t.id)}),o.forEach(function(t){"CONTADO"==t.descripcion&&(n.condicion_id="".concat(t.id,"-").concat(t.descripcion))}),this.loadingClienteNew=!1)},deep:!0},tipo_venta:function(t){this.formCreate.tipo_venta=t,this.paramsLotes.tipocomprobante=t,129!=t&&(this.formCreate.fecha_documento_campo=this.$fechaActual),t&&this.$nextTick(this.getTipoComprobante)},condicion_id:function(t){this.formCreate.condicion_id=t;var n=t.split("-"),e=n[0],o=n[1],a=0;if("CONTADO"==o)this.estadoFechaVenc=!0,this.formCreate.fecha_vencimiento_campo=this.$fechaActual;else{this.estadoFechaVenc=!1,this.initData.condiciones.forEach(function(t){Number(t.id)==Number(e)&&(a=Number(t.dias)+1)});var r=new Date(this.$fechaActual);r.setDate(r.getDate()+a);var i=(r.getMonth()+1).toString().length>1?r.getMonth()+1:"0"+(r.getMonth()+1),c=r.getDate().toString().length>1?r.getDate():"0"+r.getDate(),s=r.getFullYear()+"-"+i+"-"+c;this.formCreate.fecha_vencimiento_campo=s}},cliente_id:function(t){t?(this.formCreate.cliente_id=t.id,this.paramsLotes.tipo_cliente=t.tabladetalles_id,this.disabledBtnProducto=!1):(this.formCreate.cliente_id=null,this.disabledBtnProducto=!0)}},created:function(){var t=this;console.log("SEDE",this.v_sede),this.lst_almacenes.forEach(function(n){n.sede_id==t.registrador.sede_id&&(t.almacenSeleccionado=n.id)}),window.addEventListener("beforeunload",this.handleBeforeUnload),this.formCreate.fecha_documento_campo=this.$fechaActual,this.formCreate.fecha_atencion_campo=this.$fechaActual,this.formCreate.fecha_vencimiento_campo=this.$fechaActual,this.ObtenerData()},mounted:function(){},beforeDestroy:function(){this.$refs.tablaProductos.devolverCantidades()},methods:{cambiarAlmacen:function(){alert("ola")},handleBeforeUnload:function(t){var n;null===(n=this.$refs.tablaProductos)||void 0===n||n.devolverCantidades()},openModal:function(t){console.log("edit",t.producto_nombre),this.modalVisible=!0,this.modalTitle="EDITAR: ".concat(t.producto_nombre,"-").concat(t.color_nombre),this.tallasProductoEdit=t.tallas,this.productoEditar={producto_id:t.producto_id,color_id:t.color_id}},closeModal:function(){this.modalVisible=!1},addDataEnvio:function(t){this.formCreate.data_envio=t,console.log(this.formCreate)},formatearDetalle:function(t){if(t.length>0){var n=[];return t.forEach(function(t){t.tallas.forEach(function(e){var o={};o.producto_id=t.producto_id,o.color_id=t.color_id,o.talla_id=e.talla_id,o.cantidad=e.cantidad,o.precio_unitario=t.precio_venta,o.porcentaje_descuento=t.porcentaje_descuento,o.precio_unitario_nuevo=t.precio_venta_nuevo,n.push(o)})}),n}return[]},ObtenerData:function(){var t=this;return W(J().m(function n(){var e,o,a;return J().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,t.loading=!0,n.n=1,t.axios.post(route("ventas.documento.getCreate"));case 1:e=n.v,o=e.data,o.success,a=o.initData,t.initData=a,t.loading=!1,n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,null,[[0,2]])}))()},Volver:function(){this.$emit("update:ruta","index")},selectedCliente:function(t){console.log(t)},NuevoCliente:function(){$("#modal_cliente").modal("show")},formAddCliente:function(t){this.loadingClienteNew=!0,this.initData.clientes.push(t),this.cliente_id=t},addProductoDetalle:function(t){var n=t.detalles,e=t.totales;this.productos_tabla=n,this.formCreate=Object.assign(this.formCreate,e),console.log(this.formCreate)},Grabar:function(){var t=this;try{if(toastr.clear(),!this.validarCampos())return;var n=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1});n.fire({title:"Desea generar el documento de venta?",text:"OPERACIÓN NO REVERSIBLE!",icon:"warning",showCancelButton:!0,confirmButtonText:"SÍ!",cancelButtonText:"NO, CANCELAR!",reverseButtons:!0}).then(function(e){e.isConfirmed?t.EnviarVenta():e.dismiss===Swal.DismissReason.cancel&&n.fire({title:"OPERACIÓN CANCELADA",text:"NO SE REALIZARON ACCIONES",icon:"error"})})}catch(t){toastr.error(t,"ERROR EN LA PETICIÓN GENERAR DOCUMENTO DE VENTA")}},EnviarVenta:function(){var t=this;return W(J().m(function n(){var e,o,a;return J().w(function(n){for(;;)switch(n.p=n.n){case 0:return Swal.fire({title:"Registrando venta...",text:"Por favor, espera.",allowOutsideClick:!1,didOpen:function(){Swal.showLoading()}}),n.p=1,t.formCreate.almacenSeleccionado=t.almacenSeleccionado,t.formCreate.sede_id=t.initData.sede_id,n.n=2,t.axios.post(route("ventas.documento.store"),t.formCreate);case 2:(e=n.v).data.success?(t.$refs.tablaProductos.ChangeAsegurarCierre(),toastr.success(e.data.message,"OPERACIÓN COMPLETADA"),o=route("ventas.documento.comprobante",{id:e.data.documento_id,size:80}),window.open(o,"Comprobante SISCOM","location=1, status=1, scrollbars=1,width=900, height=600"),window.location.href=route("ventas.documento.index")):(toastr.error(e.data.message,"ERROR EN EL SERVIDOR"),Swal.close()),n.n=4;break;case 3:n.p=3,a=n.v,toastr.error(a,"ERROR EN LA PETICIÓN REGISTRAR VENTA"),Swal.close();case 4:return n.a(2)}},n,null,[[1,3]])}))()},validarTipo:function(){var t=!0;return"0"==this.formCreate.tipo_cliente_documento&&127==this.formCreate.tipo_venta&&(toastr.error("El tipo de documento del cliente es diferente a RUC.","Error"),t=!1),t},validarCampos:function(){try{var t=!0,n=this.formCreate.moneda,e=(this.formCreate.observacion,this.formCreate.condicion_id),o=this.formCreate.fecha_documento_campo,a=this.formCreate.fecha_atencion_campo,r=this.formCreate.fecha_vencimiento_campo,i=(this.formCreate.empresa_id,this.formCreate.cliente_id),c=this.formCreate.tipo_venta;if(0==this.productos_tabla.length&&(toastr.error("El documento de venta debe tener almenos un producto vendido."),t=!1),null!=n&&""!=n||(t=!1,toastr.error("El campo moneda es requerido.")),null!=e&&""!=e||(t=!1,toastr.error("El campo condicion de pago es requerido.")),null!=o&&""!=o||(t=!1,toastr.error("El campo fecha de documento es requerido.")),null!=a&&""!=a||(t=!1,toastr.error("El campo fecha de atención es requerido.")),null!=r&&""!=r||(t=!1,toastr.error("El campo fecha de vencimiento es requerido.")),this.initData.clientes.length>0){var s=this.initData.clientes.findIndex(function(t){return Number(t.id)==Number(i)});if(null!=s){var l=this.initData.clientes[s];null!=l?(127===convertFloat(c)&&"RUC"!=l.tipo_documento&&(t=!1,toastr.error("El tipo de comprobante seleccionado requiere que el cliente tenga RUC.")),128===convertFloat(c)&&"DNI"!=l.tipo_documento&&(t=!1,toastr.error("El tipo de comprobante seleccionado requiere que el cliente tenga DNI."))):(t=!1,toastr.error("Ocurrió un error porfavor seleccionar nuevamente un cliente."))}else t=!1,toastr.error("Ocurrió un error porfavor seleccionar nuevamente un cliente.")}return t}catch(t){return alert("Validar campo"+t),!1}},getTipoComprobante:function(){var t=this;return W(J().m(function n(){var e,o,a,r,i;return J().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,t.axios.post(route("ventas.vouchersAvaible"),{empresa_id:t.formCreate.empresa_id,tipo_id:t.formCreate.tipo_venta});case 1:e=n.v,o=e.data,a=o.existe,r=o.empresa,i=o.comprobante,a?toastr.success("La empresa "+r+" tiene registrado el comprobante "+i,"Accion Correcta"):toastr.error("La empresa "+r+" no tiene registrado el comprobante "+i,"Error"),n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},n,null,[[0,2]])}))()},VolverAIndex:function(){this.$emit("update:ruta","index")},mostrarAnimacionVenta:function(){document.querySelector(".overlay_venta").style.visibility="visible"},ocultarAnimacionVenta:function(){document.querySelector(".overlay_venta").style.visibility="hidden"}}};var Z=e(9060),tt={insert:"head",singleton:!1};l()(Z.A,tt);Z.A.locals;var nt=e(2947),et={insert:"head",singleton:!1};l()(nt.A,et);nt.A.locals;const ot=(0,p.A)(Q,function(){var t=this,n=t._self._c;return n("div",{},[n("EditarItemVue",{attrs:{visible:t.modalVisible,title:t.modalTitle,tallas:t.initData.tallas,tallasProducto:t.tallasProductoEdit,productoEditar:t.productoEditar,detalleVenta:t.productos_tabla},on:{close:t.closeModal}}),t._v(" "),t._m(0),t._v(" "),n("div",{staticClass:"wrapper wrapper-content animated fadeInRight content-create",class:{sk__loading:t.loading}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-12"},[n("div",{staticClass:"ibox"},[n("div",{staticClass:"ibox-content"},[n("form",{staticClass:"formulario",attrs:{id:"EnviarVenta"},on:{submit:function(n){return n.preventDefault(),t.Grabar.apply(null,arguments)}}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6 b-r"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-6 col-md-6 col-sm-12 col-xs-12 mb-3",attrs:{id:"fecha_documento"}},[n("label",{staticStyle:{"font-weight":"bold"}},[t._v("FECHA DOCUMENTO")]),t._v(" "),n("div",{staticClass:"input-group"},[t._m(1),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCreate.fecha_documento_campo,expression:"formCreate.fecha_documento_campo"}],staticClass:"form-control input-required",attrs:{readonly:"",type:"date",id:"fecha_documento_campo",name:"fecha_documento_campo",autocomplete:"off",required:""},domProps:{value:t.formCreate.fecha_documento_campo},on:{input:function(n){n.target.composing||t.$set(t.formCreate,"fecha_documento_campo",n.target.value)}}}),t._v(" "),t._m(2)])]),t._v(" "),n("div",{staticClass:"col-lg-6 col-md-6 col-sm-12 col-xs-12 mb-3",attrs:{id:"almacen"}},[n("label",{staticStyle:{"font-weight":"bold"}},[t._v("ALMACÉN")]),t._v(" "),n("v-select",{ref:"selectAlmacen",attrs:{options:t.lst_almacenes,reduce:function(t){return t.id},label:"descripcion",placeholder:"Seleccionar"},model:{value:t.almacenSeleccionado,callback:function(n){t.almacenSeleccionado=n},expression:"almacenSeleccionado"}})],1),t._v(" "),n("div",{staticClass:"col-lg-6 col-md-6 col-sm-12 col-xs-12 select-required mb-3"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required",staticStyle:{"font-weight":"bold"}},[t._v("COMPROBANTE\n                                                ")]),t._v(" "),n("v-select",{attrs:{options:t.initData.tipoVentas,reduce:function(t){return t.id},label:"nombre",placeholder:"Seleccionar comprobante..."},model:{value:t.tipo_venta,callback:function(n){t.tipo_venta=n},expression:"tipo_venta"}})],1)]),t._v(" "),t._m(3)])]),t._v(" "),n("div",{staticClass:"col-12 col-md-6"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6 select-required"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required"},[t._v("Condición")]),t._v(" "),n("v-select",{attrs:{options:t.initData.condiciones,reduce:function(t){return"".concat(t.id,"-").concat(t.descripcion)},label:"descripcion",placeholder:"Seleccionar condición..."},scopedSlots:t._u([{key:"option",fn:function(n){return[t._v("\n                                                        "+t._s(n.descripcion)+"\n                                                        "+t._s(n.dias>0?n.dias+"dias":"")+"\n                                                    ")]}}]),model:{value:t.condicion_id,callback:function(n){t.condicion_id=n},expression:"condicion_id"}})],1)]),t._v(" "),n("div",{staticClass:"col-12 col-md-6",attrs:{id:"fecha_vencimiento"}},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required"},[t._v("Fecha de Vencimiento")]),t._v(" "),n("div",{staticClass:"input-group date"},[t._m(4),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.formCreate.fecha_vencimiento_campo,expression:"formCreate.fecha_vencimiento_campo"}],staticClass:"form-control input-required",attrs:{type:"date",id:"fecha_vencimiento_campo",name:"fecha_vencimiento_campo",autocomplete:"off",required:"",disabled:t.estadoFechaVenc},domProps:{value:t.formCreate.fecha_vencimiento_campo},on:{input:function(n){n.target.composing||t.$set(t.formCreate,"fecha_vencimiento_campo",n.target.value)}}}),t._v(" "),t._m(5)])])])]),t._v(" "),n("div",{staticClass:"row align-items-end"},[n("div",{staticClass:"col-12 col-md-8 select-required"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"required"},[t._v("Cliente:\n                                                    "),n("button",{staticClass:"btn btn-outline btn-primary",attrs:{type:"button"},on:{click:function(n){return n.preventDefault(),t.NuevoCliente.apply(null,arguments)}}},[t._v("\n                                                        Registrar\n                                                    ")])]),t._v(" "),n("v-select",{attrs:{options:t.initData.clientes,reduce:function(t){return t},label:"cliente",placeholder:"Buscar clientes..."},scopedSlots:t._u([{key:"option",fn:function(n){return[t._v("\n                                                        "+t._s(n.cliente)+"\n                                                    ")]}}]),model:{value:t.cliente_id,callback:function(n){t.cliente_id=n},expression:"cliente_id"}})],1)])])])])]),t._v(" "),n("hr"),t._v(" "),n("TablaProductos",{ref:"tablaProductos",attrs:{fullaccessTable:t.FullaccessTable,idcotizacion:t.idcotizacion,btnDisabled:t.disabledBtnProducto,parametros:t.paramsLotes,modelos:t.initData.modelos,categorias:t.initData.categorias,marcas:t.initData.marcas,tallas:t.initData.tallas,precio_envio:t.formCreate.precio_envio,precio_despacho:t.formCreate.precio_despacho,cliente:t.cliente_id,almacenSeleccionado:t.almacenSeleccionado},on:{addProductoDetalle:t.addProductoDetalle,addDataEnvio:t.addDataEnvio}}),t._v(" "),n("div",{staticClass:"hr-line-dashed"}),t._v(" "),n("div",{staticClass:"form-group row"},[t._m(6),t._v(" "),n("div",{staticClass:"col-md-6 text-right"},[n("a",{staticClass:"btn btn-w-m btn-default",attrs:{href:"javascript:void(0)",id:"btn_cancelar"},on:{click:function(n){return n.preventDefault(),t.VolverAIndex.apply(null,arguments)}}},[n("i",{staticClass:"fa fa-arrow-left"}),t._v(" Regresar\n                                ")]),t._v(" "),t._m(7)])])],1)])])])]),t._v(" "),n("ModalClienteVue",{attrs:{lst_departamentos_base:this.lst_departamentos_base,lst_provincias_base:this.lst_provincias_base,lst_distritos_base:this.lst_distritos_base,v_sede:this.v_sede},on:{newCliente:t.formAddCliente}})],1)},[function(){var t=this._self._c;return t("div",{staticClass:"overlay_venta"},[t("span",{staticClass:"loader_cotizacion_create"})])},function(){var t=this._self._c;return t("span",{staticClass:"input-group-addon"},[t("i",{staticClass:"fa fa-calendar"})])},function(){var t=this._self._c;return t("span",{staticClass:"invalid-feedback",attrs:{role:"alert"}},[t("strong")])},function(){var t=this,n=t._self._c;return n("div",{staticClass:"col-lg-6 col-md-6 col-sm-12 col-xs-12 select-required mb-3"},[n("div",{staticClass:"form-group"},[n("label",{staticStyle:{"font-weight":"bold"}},[t._v("MONEDA")]),t._v(" "),n("select",{staticClass:"select2_form form-control",attrs:{id:"moneda",name:"moneda",disabled:""}},[n("option",{attrs:{selected:""}},[t._v("SOLES")])])])])},function(){var t=this._self._c;return t("span",{staticClass:"input-group-addon"},[t("i",{staticClass:"fa fa-calendar"})])},function(){var t=this._self._c;return t("span",{staticClass:"invalid-feedback",attrs:{role:"alert"}},[t("strong")])},function(){var t=this,n=t._self._c;return n("div",{staticClass:"col-md-6 text-left",staticStyle:{color:"#fcbc6c"}},[n("small",[t._v("Los campos marcados con asterisco\n                                    ("),n("label",{staticClass:"required"}),t._v(") son obligatorios.")])])},function(){var t=this._self._c;return t("button",{staticClass:"btn btn-w-m btn-primary",attrs:{type:"submit",form:"EnviarVenta",id:"btn_grabar"}},[t("i",{staticClass:"fa fa-save"}),this._v("\n                                    Grabar\n                                ")])}],!1,null,null,null).exports},1585:(t,n,e)=>{e.d(n,{A:()=>c});var o=e(4991),a=e.n(o),r=e(6314),i=e.n(r)()(a());i.push([t.id,".inputCantidadValido{border-color:#3b3fff!important}.inputCantidadIncorrecto{border-color:red!important}.inputCantidadColor{border-color:#303058}.colorStockLogico{background-color:#f3f8ff}.overlay{align-items:center;background-color:rgba(0,0,0,.5);display:none;height:100%;justify-content:center;left:0;position:fixed;top:0;width:100%;z-index:1000}.fulfilling-bouncing-circle-spinner,.fulfilling-bouncing-circle-spinner *{box-sizing:border-box}.fulfilling-bouncing-circle-spinner{animation:fulfilling-bouncing-circle-spinner-animation 4s ease infinite;height:60px;position:relative;width:60px}.fulfilling-bouncing-circle-spinner .orbit{animation:fulfilling-bouncing-circle-spinner-orbit-animation 4s ease infinite;border:1.8px solid #ff1d5e;border-radius:50%;height:60px;left:0;position:absolute;top:0;width:60px}.fulfilling-bouncing-circle-spinner .circle{animation:fulfilling-bouncing-circle-spinner-circle-animation 4s ease infinite;border:6px solid #ff1d5e;border-radius:50%;color:#ff1d5e;display:block;height:60px;position:relative;transform:rotate(0deg) scale(1);width:60px}@keyframes fulfilling-bouncing-circle-spinner-animation{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes fulfilling-bouncing-circle-spinner-orbit-animation{0%{transform:scale(1)}50%{transform:scale(1)}62.5%{transform:scale(.8)}75%{transform:scale(1)}87.5%{transform:scale(.8)}to{transform:scale(1)}}@keyframes fulfilling-bouncing-circle-spinner-circle-animation{0%{border-color:transparent;border-top-color:inherit;transform:scale(1)}16.7%{border-color:transparent;border-right-color:initial;border-top-color:initial}33.4%{border-color:transparent;border-bottom-color:inherit;border-right-color:inherit;border-top-color:inherit}50%{border-color:inherit;transform:scale(1)}62.5%{border-color:inherit;transform:scale(1.4)}75%{border-color:inherit;opacity:1;transform:scale(1)}87.5%{border-color:inherit;transform:scale(1.4)}to{border-color:transparent;border-top-color:inherit;transform:scale(1)}}","",{version:3,sources:["webpack://./resources/js/components/ventas/TablaProductos.vue"],names:[],mappings:"AA88CA,qBACA,8BACA,CACA,yBACA,0BACA,CACA,oBACA,oBACA,CACA,kBACA,wBACA,CAEA,SAUA,kBAAA,CAHA,+BAAA,CANA,YAAA,CAKA,WAAA,CAGA,sBAAA,CALA,MAAA,CAFA,cAAA,CACA,KAAA,CAEA,UAAA,CAGA,YAGA,CAEA,0EACA,qBACA,CAEA,oCAIA,uEAAA,CAHA,WAAA,CAEA,iBAAA,CADA,UAGA,CAEA,2CAQA,6EAAA,CADA,0BAAA,CADA,iBAAA,CALA,WAAA,CAIA,MAAA,CAFA,iBAAA,CACA,KAAA,CAFA,UAOA,CAEA,4CAQA,8EAAA,CADA,wBAAA,CAFA,iBAAA,CAFA,aAAA,CACA,aAAA,CAHA,WAAA,CAKA,iBAAA,CAGA,+BAAA,CAPA,UAQA,CAEA,wDACA,GACA,sBACA,CAEA,GACA,uBACA,CACA,CAEA,8DACA,GACA,kBACA,CACA,IACA,kBACA,CACA,MACA,mBACA,CACA,IACA,kBACA,CACA,MACA,mBACA,CACA,GACA,kBACA,CACA,CAEA,+DACA,GAEA,wBAAA,CACA,wBAAA,CAFA,kBAGA,CACA,MACA,wBAAA,CAEA,0BAAA,CADA,wBAEA,CACA,MACA,wBAAA,CAGA,2BAAA,CADA,0BAAA,CADA,wBAGA,CACA,IACA,oBAAA,CACA,kBACA,CACA,MACA,oBAAA,CACA,oBACA,CACA,IACA,oBAAA,CAEA,SAAA,CADA,kBAEA,CACA,MACA,oBAAA,CACA,oBACA,CACA,GACA,wBAAA,CACA,wBAAA,CACA,kBACA,CACA",sourcesContent:['<style>\n    .inputCantidadValido{\n        border-color:rgb(59, 63, 255) !important;\n    }\n    .inputCantidadIncorrecto{\n        border-color: red !important;\n    }\n    .inputCantidadColor{\n        border-color: rgb(48, 48, 88);\n    }\n    .colorStockLogico{\n        background-color: rgb(243, 248, 255);\n    }\n\n    .overlay {\n        display: none;\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n        z-index: 1000;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .fulfilling-bouncing-circle-spinner, .fulfilling-bouncing-circle-spinner * {\n      box-sizing: border-box;\n    }\n\n    .fulfilling-bouncing-circle-spinner {\n      height: 60px;\n      width: 60px;\n      position: relative;\n      animation: fulfilling-bouncing-circle-spinner-animation infinite 4000ms ease;\n    }\n\n    .fulfilling-bouncing-circle-spinner .orbit {\n      height: 60px;\n      width: 60px;\n      position: absolute;\n      top: 0;\n      left: 0;\n      border-radius: 50%;\n      border: calc(60px * 0.03) solid #ff1d5e;\n      animation: fulfilling-bouncing-circle-spinner-orbit-animation infinite 4000ms ease;\n    }\n\n    .fulfilling-bouncing-circle-spinner .circle {\n      height: 60px;\n      width: 60px;\n      color: #ff1d5e;\n      display: block;\n      border-radius: 50%;\n      position: relative;\n      border: calc(60px * 0.1) solid #ff1d5e;\n      animation: fulfilling-bouncing-circle-spinner-circle-animation infinite 4000ms ease;\n      transform: rotate(0deg) scale(1);\n    }\n\n    @keyframes fulfilling-bouncing-circle-spinner-animation {\n      0% {\n        transform: rotate(0deg);\n      }\n\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n\n    @keyframes fulfilling-bouncing-circle-spinner-orbit-animation {\n      0% {\n        transform: scale(1);\n      }\n      50% {\n        transform: scale(1);\n      }\n      62.5% {\n        transform: scale(0.8);\n      }\n      75% {\n        transform: scale(1);\n      }\n      87.5% {\n        transform: scale(0.8);\n      }\n      100% {\n        transform: scale(1);\n      }\n    }\n\n    @keyframes fulfilling-bouncing-circle-spinner-circle-animation {\n      0% {\n        transform: scale(1);\n        border-color: transparent;\n        border-top-color: inherit;\n      }\n      16.7% {\n        border-color: transparent;\n        border-top-color: initial;\n        border-right-color: initial;\n      }\n      33.4% {\n        border-color: transparent;\n        border-top-color: inherit;\n        border-right-color: inherit;\n        border-bottom-color: inherit;\n      }\n      50% {\n        border-color: inherit;\n        transform: scale(1);\n      }\n      62.5% {\n        border-color: inherit;\n        transform: scale(1.4);\n      }\n      75% {\n        border-color: inherit;\n        transform: scale(1);\n        opacity: 1;\n      }\n      87.5% {\n        border-color: inherit;\n        transform: scale(1.4);\n      }\n      100% {\n        border-color: transparent;\n        border-top-color: inherit;\n        transform: scale(1);\n      }\n    }\n\n</style>\n<template>\n\n\n    <div class="row">\n\n        <div class="col-lg-12">\n\n            \x3c!-- PRIMER PANEL  --\x3e\n            <div class="panel panel-primary">\n                <div id="overlay" class="overlay">\n                    <div class="fulfilling-bouncing-circle-spinner">\n                        <div class="circle"></div>\n                        <div class="orbit"></div>\n                    </div>\n                </div>\n                <div class="panel-heading">\n                    <h4 class=""><b>Seleccionar productos</b></h4>\n                </div>\n                <div class="panel-body ibox-content">\n\n                    <div class="row" v-if="idcotizacion == 0">\n\n                        \x3c!-- <div class="col-12 mb-3 d-flex justify-content-end">\n                            <button class="btn btn-danger" @click="eliminarCarrito"> ELIMINAR TODO </button>\n                        </div> --\x3e\n\n                        \x3c!-- <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12" >\n                            <label class="required" style="font-weight: bold;">CATEGORÍA</label>\n\n                            <v-select\n                                v-model="categoriaSeleccionada"\n                                :options="categorias"\n                                :reduce="categoria => categoria.id"\n                                label="descripcion"\n                                placeholder="Seleccionar"\n                            >\n                            </v-select>\n\n                        </div>\n\n                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12" >\n                            <label class="required" style="font-weight: bold;">MARCA</label>\n                            <v-select\n                                v-model="marcaSeleccionada"\n                                :options="marcas"\n                                :reduce="marca => marca.id"\n                                label="marca"\n                                placeholder="Seleccionar">\n                            </v-select>\n                        </div>\n\n\n                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12" >\n                            <label class="required" style="font-weight: bold;">MODELO</label>\n                            <v-select\n                                v-model="modeloSeleccionado"\n                                :options="modelos"\n                                :reduce="modelo => modelo.id"\n                                label="descripcion"\n                                placeholder="Seleccionar">\n                            </v-select>\n                        </div> --\x3e\n\n                        <div class="col-lg-12 col-md-3 col-sm-12 col-xs-12 mt-3" >\n                            <label class="required" style="font-weight: bold;">CATEGORÍA - MARCA - MODELO - PRODUCTO</label>\n\n                            <v-select\n                                v-model="productoSeleccionado"\n                                :options="productos"\n                                label="producto_completo"\n                                placeholder="Seleccionar"\n                                @search="buscarProducto"\n                                :loading="loadingProductos"\n                                >\n                            </v-select>\n                        </div>\n\n\n                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 mt-3" >\n                            <label class="required" style="font-weight: bold;">PRECIO VENTA</label>\n                            <v-select\n                                v-model="precioVentaSeleccionado"\n                                :options="preciosVenta"\n                                placeholder="Seleccionar">\n                            </v-select>\n                        </div>\n\n                        <div class="col-12 mt-3">\n                            <label style="font-weight: bold;">CÓDIGO BARRA</label>\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                        <span class="input-group-text" id="basic-addon1">\n                                            <i class="fas fa-barcode"></i>\n                                    </span>\n                                </div>\n                                <input v-model="buscarCodigoBarra" class="inputBarCode form-control" maxlength="8" type="text" placeholder="Escriba el código de barra" aria-label="Username" aria-describedby="basic-addon1">\n                            </div>\n                        </div>\n\n                        <input type="hidden" name="producto_id" id="producto_id">\n                        <input type="hidden" name="producto_unidad" id="producto_unidad">\n                        <input type="hidden" name="producto_json" id="producto_json">\n\n                    </div>\n                    <hr>\n                    <div class="table-responsive">\n                        <table class="table table-sm table-striped table-bordered table-hover"\n                            style="text-transform:uppercase" id="table-stocks">\n                            <thead>\n                                <tr>\n                                    <th>PRODUCTO</th>\n                                    <template  v-for="talla in tallas" >\n                                        <th class="colorStockLogico">\n                                            {{ talla.descripcion }}\n                                        </th>\n                                        <th>CANT</th>\n                                    </template>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr v-for="pc in productosPorModelo.producto_colores" :key="`${pc.producto_id}${pc.color_id}`">\n                                    <td>{{ pc.producto_nombre }} - {{ pc.color_nombre }}</td>\n\n                                    <template v-for="t in tallas">\n                                        <td class="colorStockLogico">\n                                            <span>\n                                                {{ printStockLogico(pc.producto_id, pc.color_id, t.id) }}\n                                            </span>\n                                        </td>\n                                        <td style="width: 5%;" v-if="printStockLogico(pc.producto_id, pc.color_id, t.id) > 0">\n                                            <input\n                                            type="text"\n                                            class="form-control inputCantidad inputCantidadColor"\n                                            :data-almacen-id="pc.almacen_id"\n                                            :data-producto-id="pc.producto_id"\n                                            :data-producto-nombre="pc.producto_nombre"\n                                            :data-color-nombre="pc.color_nombre"\n                                            :data-talla-nombre="t.descripcion"\n                                            :data-color-id="pc.color_id"\n                                            :data-talla-id="t.id"\n                                            @input="validarContenidoInput($event)"\n                                            :disabled="printStockLogico(pc.producto_id, pc.color_id, t.id) === 0"\n                                            />\n                                        </td>\n                                        <td v-else>\n\n                                        </td>\n                                    </template>\n                                </tr>\n                            </tbody>\n\n                            <tfoot>\n\n                            </tfoot>\n                        </table>\n                    </div>\n\n                    <div class="form-group row mt-1">\n                        <div class="col-lg-2 col-xs-12">\n                            <button :disabled="deshabilitarBtnAgregar"\n                            type="button" id="btn_agregar_detalle"\n                            @click="agregarProducto"\n                                class="btn btn-warning btn-block">\n                                <i class="fa fa-plus"></i> AGREGAR\n                            </button>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n            \x3c!-- FIN PRIMER PANEL --\x3e\n\n            \x3c!-- SEGUNDO PANEL --\x3e\n            <div class="panel panel-primary">\n                <div class="panel-heading">\n                    <h4 class=""><b>Detalle del documento de venta</b></h4>\n                </div>\n                <div class="panel-body ibox-content">\n                    <div class="table-responsive">\n                        <table class="table table-sm table-striped table-bordered table-hover"\n                            style="text-transform:uppercase">\n                            <thead>\n                                <tr>\n                                    <th class="text-center">\n                                        <i class="fa fa-dashboard"></i>\n                                    </th>\n                                    <th class="text-center">PRODUCTO</th>\n                                    <template v-for="t in tallas">\n                                        <th class="text-center">{{ t.descripcion }}</th>\n                                    </template>\n\n                                    <th class="text-center">P. VENTA</th>\n                                    <th class="text-center">SUBTOTAL</th>\n                                    <th class="text-center">DSCTO %</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <template v-if="carrito.length > 0">\n                                    <tr v-for="(item, index) in carrito" :key="index">\n                                        <td class="text-center">\n                                            <div class=\'btn-group\'>\n                                                <button type="button" class=\'btn btn-sm btn-warning btn-edit\'\n                                                    style=\'color:white\' @click.prevent="openModal(item)">\n                                                    <i class=\'fa fa-edit\'></i>\n                                                </button>\n                                                <button type="button" class=\'btn btn-sm btn-danger btn-delete\'\n                                                    style=\'color:white\' @click.prevent="EliminarItem(item, index)">\n                                                    <i class=\'fa fa-trash\'></i>\n                                                </button>\n                                            </div>\n                                        </td>\n                                        <td class="text-center">\n                                            <div style="width: 160px;">\n                                                {{ item.producto_nombre }}-{{ item.color_nombre }}\n                                            </div>\n                                        </td>\n                                        <td v-for="t in tallas">\n                                            <p style="font-weight: bold;">{{ printTallaDetalle(t.id,item) }}</p>\n                                        </td>\n                                        <td>{{ item.porcentaje_descuento!=0 ? item.precio_venta_nuevo : item.precio_venta }}</td>\n                                        <td>{{ item.porcentaje_descuento !=0 ? item.subtotal_nuevo : item.subtotal }}</td>\n                                        <td>\n                                            <input @input="validarDescuento(item.producto_id,item.color_id,$event)" type="text"\n                                            :value="item.porcentaje_descuento" style="width: 100px;" class="form-control">\n                                        </td>\n                                    </tr>\n                                </template>\n                                <template v-else>\n                                    <tr>\n                                        <td :colspan="tallas.length + 5" class="text-center"><strong>No hay detalles</strong></td>\n                                    </tr>\n                                </template>\n                            </tbody>\n                        </table>\n                    </div>\n\n                        <div class="col-12 d-flex justify-content-end">\n                            <div class="table-responsive">\n                                <table style="margin:0 0 0 auto;">\n                                    <tfoot>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">SUBTOTAL:</td>\n                                            <td class="subtotal" colspan="1" style="font-weight: bold; text-align:end;">\n                                                {{ `S/. ${Number(monto_subtotal).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")}` }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">EMBALAJE:</td>\n                                            <td class="total" colspan="1" style="font-weight: bold; text-align:end;">\n                                                <div class="input-group">\n                                                    <span class="input-group-text" id="basic-addon1">\n                                                        <svg style="width: 20px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.><path d="M425.7 256c-16.9 0-32.8-9-41.4-23.4L320 126l-64.2 106.6c-8.7 14.5-24.6 23.5-41.5 23.5-4.5 0-9-.6-13.3-1.9L64 215v178c0 14.7 10 27.5 24.2 31l216.2 54.1c10.2 2.5 20.9 2.5 31 0L551.8 424c14.2-3.6 24.2-16.4 24.2-31V215l-137 39.1c-4.3 1.3-8.8 1.9-13.3 1.9zm212.6-112.2L586.8 41c-3.1-6.2-9.8-9.8-16.7-8.9L320 64l91.7 152.1c3.8 6.3 11.4 9.3 18.5 7.3l197.9-56.5c9.9-2.9 14.7-13.9 10.2-23.1zM53.2 41L1.7 143.8c-4.6 9.2 .3 20.2 10.1 23l197.9 56.5c7.1 2 14.7-1 18.5-7.3L320 64 69.8 32.1c-6.9-.8-13.5 2.7-16.6 8.9z"/></svg>\n                                                    </span>\n                                                    <input style="width: 70px;" v-model="monto_embalaje" type="text" class="form-control" aria-label="PRECIO DESPACHO" aria-describedby="basic-addon1">\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">ENVÍO:</td>\n                                            <td class="total" colspan="1" style="font-weight: bold; text-align:end;">\n                                                <div class="input-group">\n                                                    <span class="input-group-text btn btn-light" id="basic-addon1"  @click.prevent="setDataEnvio">\n                                                        <svg style="width: 20px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.><path d="M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h16c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"/></svg>\n                                                    </span>\n                                                    <input style="width: 70px;" v-model="monto_envio" type="text" class="form-control" aria-label="PRECIO ENVÍO" aria-describedby="basic-addon1">\n                                                </div>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">DESCUENTO:</td>\n                                            <td class="total" colspan="1" style="font-weight: bold; text-align:end;">\n                                                <span>{{ `S/. ${Number(monto_descuento).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")}` }}</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">MONTO TOTAL:</td>\n                                            <td class="total" colspan="1" style="font-weight: bold; text-align:end;">\n                                                {{ `S/. ${Number(monto_total).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")}` }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">IGV:</td>\n                                            <td class="igv" colspan="1" style="font-weight: bold; text-align:end;">\n                                                {{ `S/. ${Number(monto_igv).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")}` }}\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td :colspan="tallas.length + 4" style="font-weight: bold; text-align:end;">MONTO TOTAL A PAGAR:</td>\n                                            <td class="total" colspan="1" style="font-weight: bold; text-align:end;">\n                                                {{ `S/. ${Number(monto_total_pagar).toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ",")}` }}\n                                            </td>\n                                        </tr>\n                                    </tfoot>\n                                </table>\n                            </div>\n                        </div>\n\n                </div>\n            </div>\n            \x3c!-- FIN SEGUNDO PANEL --\x3e\n\n\n        <ModalEnvioVue :cliente="cliente" @addDataEnvio="addDataEnvio"/>\n\n        </div>\n        \x3c!-- FIN COLUMNA --\x3e\n    </div>\n    \x3c!-- FIN FILA --\x3e\n</template>\n<script>\n\nimport ModalEnvioVue from "./ModalEnvio.vue";\nimport { Empresa } from "../../interfaces/Empresa.js";\nimport ModalCodigoPrecioMenorVue from \'./ModalCodigoPrecioMenor.vue\';\nimport ModalEditaDetalleVue from "./ModalEditDetalle.vue";\n\nexport default {\n    name: "TablaProductos",\n    components: {\n        ModalEnvioVue,\n        ModalCodigoPrecioMenorVue,\n        ModalEditaDetalleVue,\n    },\n    props: [\n    "fullaccessTable",\n    "btnDisabled",\n    "parametros",\n    "productoTabla",\n    "TotalesObj",\n    \'idcotizacion\',\n    \'modelos\',\n    \'categorias\',\n    \'marcas\',\n    \'tallas\',\n    \'cliente\',\n    \'almacenSeleccionado\',\n    \'lst_departamentos_base\',\n    \'lst_provincias_base\',\n    \'lst_distritos_base\'],\n    data() {\n        return {\n            monto_embalaje:0,\n            monto_envio:0,\n            monto_descuento:0,\n            porcentaje_descuento_global:0,\n            descuentos:[],\n            flujo:[],\n            monto_subtotal:0,\n            monto_igv:0,\n            monto_total:0,\n            monto_total_pagar:0,\n            carrito: [],\n            deshabilitarBtnAgregar: true,\n            productosPorModelo: {},\n            modeloSeleccionado:null,\n            categoriaSeleccionada:null,\n            marcaSeleccionada:null,\n            productoSeleccionado:null,\n            precioVentaSeleccionado:null,\n            buscarCodigoBarra:null,\n            productos:[],\n            preciosVenta:[],\n            asegurarCierre: 5,\n            formDetalles: {\n                producto_id: "",\n                producto_unidad: "",\n                cantidad: "",\n                precio: "",\n                producto_lote: "",\n                igv: 18,\n                igv_int: "",\n                monto_sub_total: 0,\n                monto_total_igv: 0,\n                monto_total: 0\n            },\n            searchInput: "",\n            dataEmpresa: new Empresa(),\n            codigo_precio_menor: "",\n            estadoPrecioMenor: "",\n            tablaDetalles: [],\n            itemLote: {\n                cantidad: 0,\n                cantidadMax: 0,\n                precio: 0,\n                precioMinimo: 0,\n                unidadMedida: "",\n                id: 0,\n                producto: "",\n                estado_precio_menor: "",\n                codigo_precio_menor: "",\n                igv: 0\n            },\n            Igv: 18,\n            modalLote: false,\n\n            //======== SELECT PRODUCTOS ========\n            loadingProductos: false,\n            paginaActual: 1,\n            perPage: 10,\n            buscando: false\n        }\n    },\n    watch: {\n\n        monto_envio: {\n            handler(value) {\n                let valor = value;\n\n                if (!/^\\d*\\.?\\d*$/.test(valor)) {\n                    //========= PERMITIR ENTEROS Y DECIMALES ========\n                    valor   = valor.replace(/^0+/, \'0\');\n                    //======= ELIMINAR CARACTERES NO NUMÉRICOS, EXCEPTO EL PUNTO DECIMAL =======\n                    valor   = valor.replace(/[^\\d.]/g, \'\');\n                    //========= PERMITIR SOLO 1 PUNTO DECIMAL =====\n                    valor   = valor.replace(/(\\..*)\\./g, \'$1\');\n                    this.monto_envio = valor;\n                    return;\n                }\n\n                //======== RECALCULAR MONTOS =======\n                this.calcularMontos();\n\n                const monto_embalaje_aux    =   this.monto_embalaje.length>0?this.monto_embalaje:0;\n                const monto_envio_aux       =   this.monto_envio.length>0?this.monto_envio:0;\n                const montos = {\n                    monto_sub_total: parseFloat(this.monto_subtotal),\n                    monto_total_igv: parseFloat(this.monto_igv),\n                    monto_total: parseFloat(this.monto_total),\n                    monto_embalaje: parseFloat(monto_embalaje_aux),\n                    monto_envio: parseFloat(monto_envio_aux),\n                    monto_total_pagar: parseFloat(this.monto_total_pagar)\n                };\n\n                this.$emit(\'addProductoDetalle\', {\n                    detalles:   this.carrito,\n                    totales :   montos\n                });\n            },\n            deep: true\n        },\n        monto_embalaje: {\n            handler(value) {\n                let valor = value;\n\n                if (!/^\\d*\\.?\\d*$/.test(valor)) {\n                    //========= PERMITIR ENTEROS Y DECIMALES ========\n                    valor   = valor.replace(/^0+/, \'0\');\n                    //======= ELIMINAR CARACTERES NO NUMÉRICOS, EXCEPTO EL PUNTO DECIMAL =======\n                     valor   = valor.replace(/[^\\d.]/g, \'\');\n                    //========= PERMITIR SOLO 1 PUNTO DECIMAL =====\n                    valor   = valor.replace(/(\\..*)\\./g, \'$1\');\n                    this.monto_embalaje = valor;\n                    return;\n                }\n\n                //======== RECALCULAR MONTOS =======\n                this.calcularMontos();\n\n                const monto_embalaje_aux    =   this.monto_embalaje.length>0?this.monto_embalaje:0;\n                const monto_envio_aux    =   this.monto_envio.length>0?this.monto_envio:0;\n                const montos = {\n                    monto_sub_total: parseFloat(this.monto_subtotal),\n                    monto_total_igv: parseFloat(this.monto_igv),\n                    monto_total: parseFloat(this.monto_total),\n                    monto_embalaje: parseFloat(monto_embalaje_aux),\n                    monto_envio: parseFloat(monto_envio_aux),\n                    monto_total_pagar: parseFloat(this.monto_total_pagar)\n                };\n\n                this.$emit(\'addProductoDetalle\', {\n                    detalles:   this.carrito,\n                    totales :   montos\n                });\n            },\n            deep: true\n        },\n        carrito:{\n            handler(value){\n\n                console.log(\'WATCH CARRITO\');\n\n                //======== si aún quedan items en el carrito , asegurar cierre será 1 =========\n                 if(this.carrito.length > 0){\n                    this.asegurarCierre = 1;\n                }\n                const montos = {\n                    monto_sub_total: parseFloat(this.monto_subtotal),\n                    monto_total_igv: parseFloat(this.monto_igv),\n                    monto_total: parseFloat(this.monto_total),\n                    monto_embalaje: parseFloat(this.monto_embalaje),\n                    monto_envio: parseFloat(this.monto_envio),\n                    monto_total_pagar: parseFloat(this.monto_total_pagar),\n                    monto_descuento:parseFloat(this.monto_descuento)\n                };\n\n                this.$emit(\'addProductoDetalle\', {\n                    detalles:   this.carrito,\n                    totales :   montos\n                });\n\n            },\n            deep: true,\n        },\n        buscarCodigoBarra:{\n            handler(value){\n\n                //======= VALIDAR QUE HAYA SELECCIONADO UN ALMACÉN PREVIAMENTE =======\n                if(!this.almacenSeleccionado){\n                    toastr.clear();\n                    toastr.error(\'DEBES SELECCIONAR UN ALMACÉN!!!\');\n                    //======= FOCUS AL VSELECT ALMACÉN ========\n                    this.$nextTick(() => {\n                        this.$parent.$refs.selectAlmacen.$el.querySelector("input").focus();\n                    });\n                    this.$parent.ocultarAnimacionVenta();\n                    return;\n                }\n\n                if(value.trim().length === 8){\n                    this.getProductoBarCode(value);\n                }\n            },\n            deep:true,\n        },\n        modeloSeleccionado: {\n            handler(value) {\n                console.log(\'modeloSeleccionado cambió:\', value);\n                this.getProductos();\n            },\n            deep: true,\n        },\n        categoriaSeleccionada: {\n            handler(value) {\n                console.log(\'categoriaSeleccionada cambió:\', value);\n                this.getProductos();\n            },\n            deep: true,\n        },\n        marcaSeleccionada: {\n            handler(value) {\n                console.log(\'marcaSeleccionada cambió:\', value);\n                this.getProductos();\n            },\n            deep: true,\n        },\n        productoSeleccionado: {\n            handler(value) {\n                const producto_id   =   value.producto_id;\n                console.log(\'producto seleccionado\');\n                if(producto_id){\n                    //====== OBTENER COLORES Y TALLAS DEL PRODUCTO ======\n                    this.getColoresTallas();\n                }\n\n            },\n            deep: true,\n        },\n\n        codigoPrecioMenor: {\n            handler(value) {\n                this.estadoPrecioMenor = value.estado_precio_menor;\n            },\n            deep: true,\n        },\n        searchInput(value) {\n            this.paramsLotes.search = value;\n            let timeout;\n            clearTimeout(timeout)\n            timeout = setTimeout(() => {\n                this.$nextTick(this.ObtenerLotes);\n                clearTimeout(timeout);\n            }, 1000);\n        },\n        formDetalles: {\n            handler(value) {\n\n                let cant = !isNaN(Number(value.cantidad)) ? Number(value.cantidad) : 0;\n                let stock = Number(this.productoJson.cantidad_logica);\n                if (cant > stock) {\n                    toastr.error("La cantidad ingresa supera el stock del producto. MAX(" + stock + ")")\n                    value.cantidad = stock;\n                }\n            },\n            deep: true\n        }\n    },\n    created() {\n\n    },\n    methods: {\n        async buscarProducto(query) {\n            console.log(\'OLA\');\n            if(!this.almacenSeleccionado){\n                toastr.clear();\n                toastr.error(\'DEBES SELECCIONAR UN ALMACÉN!!!\');\n                //======= FOCUS AL VSELECT ALMACÉN ========\n                //this.$parent.$refs.selectAlmacen.$el.querySelector("input").focus();\n                return;\n            }\n\n            if (query.length > 2) {\n\n                this.loadingProductos   = true;\n                this.buscando           = true;\n\n                try {\n                    toastr.clear();\n                    const url = route(\'ventas.documento.getProductosVenta\');\n\n                    const response = await axios.get(url, {\n                    params: {\n                        search: query,\n                        page: this.paginaActual,\n                        perPage: this.perPage,\n                        almacen_id: this.almacenSeleccionado,\n                    }\n                    });\n\n                    console.log(response);\n\n                    if(response.data.success){\n                        this.productos          = response.data.data.data;\n                        this.loadingProductos   = false;\n                        this.buscando           = false;\n                    }else{\n                        console.log(response.data.message)\n                        toastr.error(response.data.message,\'ERROR EN EL SERVIDOR\');\n                    }\n\n                } catch (error) {\n                    console.error("Error al buscar productos:", error);\n                    this.loadingProductos = false;\n                    this.buscando = false;\n                }\n            }\n\n        },\n        openModal(producto) {\n           this.$parent.openModal(producto);\n        },\n        closeModal(){\n            this.$parent.closeModal(producto);\n        },\n        closeModal() {\n            this.modalVisible = false;\n            this.selectedProducto = null;\n        },\n        addDataEnvio(value){\n            this.$emit(\'addDataEnvio\', value);\n        },\n        NuevoCliente() {\n            $("#modal_cliente").modal("show");\n        },\n        setDataEnvio() {\n            $("#modal_envio").modal("show");\n        },\n        validarDescuento(producto_id,color_id,event){\n\n            //==== CONTROLANDO DE QUE EL VALOR SEA UN NÚMERO ====\n            const valor = event.target.value;\n\n            //==== SI EL INPUT ESTA VACÍO ====\n            if(valor.trim().length === 0){\n                this.calcularDescuento(producto_id,color_id,0);\n                return;\n            }\n\n            //===== EXPRESION REGULAR PARA EVITAR CARACTERES NO NUMÉRICOS EN LA CADENA ====\n            const regex = /^[0-9]+(\\.[0-9]{0,2})?$/;\n            //==== BORRAR CARACTER NO NUMÉRICO ====\n            if (!regex.test(valor)) {\n                event.target.value = valor.slice(0, -1);\n                return;\n            }\n\n            //==== EN CASO SEA NUMÉRICO ====\n            let porcentaje_desc = parseFloat(event.target.value);\n\n            //==== EL MÁXIMO DESCUENTO ES 100% ====\n            if(porcentaje_desc>100){\n                event.target.value = 100;\n                porcentaje_desc = event.target.value;\n            }\n\n            //==== CALCULAR DESCUENTO ====\n            this.calcularDescuento(producto_id,color_id,porcentaje_desc)\n\n        },\n        calcularDescuento(producto_id,color_id,porcentaje_descuento){\n\n            //==== BUSCANDO PRODUCTO COLOR EN EL CARRITO ====\n            const indiceProductoColor   =   this.carrito.findIndex((producto)=>{\n                return producto.producto_id == producto_id && producto.color_id==color_id;\n            })\n\n            const producto_color_editar = this.carrito[indiceProductoColor];\n\n            //===== APLICANDO DESCUENTO ======\n            producto_color_editar.porcentaje_descuento =    porcentaje_descuento;\n            producto_color_editar.monto_descuento      =    porcentaje_descuento === 0?0:producto_color_editar.subtotal*(porcentaje_descuento/100);\n            producto_color_editar.precio_venta_nuevo   =    porcentaje_descuento === 0?0:(producto_color_editar.precio_venta*(1-porcentaje_descuento/100)).toFixed(2);\n            producto_color_editar.subtotal_nuevo        =   porcentaje_descuento === 0?0:(producto_color_editar.subtotal*(1-porcentaje_descuento/100)).toFixed(2);\n\n            this.carrito[indiceProductoColor] = producto_color_editar;\n\n            //==== RECALCULANDO MONTOS ====\n            this.calcularMontos();\n\n            console.log(this.carrito);\n\n        },\n       async eliminarCarrito(){\n            if(this.carrito.length !== 0){\n                this.$parent.mostrarAnimacionVenta();\n                try {\n                    await this.axios.post(route(\'ventas.documento.devolver.cantidades\'), {\n                        carrito: JSON.stringify(this.carrito)\n                    })\n                    this.carrito = [];\n                    this.monto_subtotal=0;\n                    this.monto_igv=0;\n                    this.monto_total=0;\n                    await this.getColoresTallas();\n                    this.$parent.ocultarAnimacionVenta();\n                    toastr.success(\'Detalle eliminado\',\'Completado\');\n                } catch (error) {\n                    toastr.error(\'Ocurrio un error al eliminar el detalle\',\'Error\');\n                } finally{\n                    this.$parent.ocultarAnimacionVenta();\n                }\n            }else{\n                toastr.warning(\'El detalle no tiene productos\',\'Advertencia\');\n            }\n\n        },\n        calcularMontos(){\n            let subtotal            =   0;\n            let totalSinIgv         =   0;\n            let igv                 =   0;\n            let totalConIgv         =   0;\n            let descuento           =   0;\n\n            //==== RECORRIENDO CARRITO ====\n            this.carrito.forEach((producto)=>{\n                if(producto.porcentaje_descuento === 0){\n                    subtotal    += producto.subtotal;\n                }else{\n                    subtotal    +=  parseFloat(producto.subtotal_nuevo);\n                }\n                descuento += parseFloat(producto.monto_descuento);\n            })\n\n            //========= PRECIO PRODUCTOS EN CARRITO + PRECIO EMBALAJE + PRECIO ENVÍO =============\n            //====== PERMITIR BORRAR EL 0 DEL INPUT EMBALAJE, EVITAR ERROR DE VALOR NAN =======\n            const   monto_embalaje_aux  =   this.monto_embalaje.length>0? parseFloat(this.monto_embalaje):0;\n            const   monto_envio_aux     =   this.monto_envio.length>0? parseFloat(this.monto_envio):0;\n\n            totalConIgv             =   subtotal + parseFloat(monto_embalaje_aux)+parseFloat(monto_envio_aux);\n            totalSinIgv             =   totalConIgv/1.18\n            igv                     =   totalConIgv-totalSinIgv;\n\n            this.monto_total_pagar  =   totalConIgv;\n            this.monto_igv          =   igv;\n            this.monto_total        =   totalSinIgv;\n            this.monto_subtotal     =   subtotal;\n            this.monto_descuento    =   descuento;\n        },\n        async getStockLogico(inputCantidad){\n            const almacen_id            =   inputCantidad.getAttribute(\'data-almacen-id\');\n            const producto_id           =   inputCantidad.getAttribute(\'data-producto-id\');\n            const color_id              =   inputCantidad.getAttribute(\'data-color-id\');\n            const talla_id              =   inputCantidad.getAttribute(\'data-talla-id\');\n\n            try {\n                const url = `/get-stocklogico/${almacen_id}/${producto_id}/${color_id}/${talla_id}`;\n                const response = await axios.get(url);\n                if(response.data.message==\'success\'){\n                    const stock_logico  =   response.data.data[0].stock_logico;\n                    return stock_logico;\n                }\n\n            } catch (error) {\n                toastr.error(`El producto no cuenta con registros en esa talla`,"Error");\n                event.target.value=\'\';\n                console.error(\'Error al obtener stock logico:\', error);\n                return null;\n            }\n        },\n        printTallaDetalle(talla_id,item){\n\n            const itemTalla =  item.tallas.find((t)=>  talla_id==t.talla_id);\n            // console.log(itemTalla);\n            const cantidad  =    itemTalla?itemTalla.cantidad:\'\';\n\n            return cantidad;\n        },\n        calcularSubTotal(){\n            //======= calculando el subtotal de cada producto color =========\n           this.carrito.forEach((item,index)=>{\n                const precio_venta = item.precio_venta;\n                //===== sumando las cantidades de todas las tallas que tiene el producto color ======\n                let subtotal=0;\n                item.tallas.forEach((talla)=>{\n                    subtotal += (precio_venta * talla.cantidad);\n                })\n                //======= actualizamos el subtotal de ese producto_color\n                this.carrito[index].subtotal=subtotal;\n           })\n        },\n        reordenarCarrito(){\n            this.carrito.sort(function(a, b) {\n                if (a.producto_id === b.producto_id) {\n                    return a.color_id - b.color_id;\n                } else {\n                    return a.producto_id - b.producto_id;\n                }\n            });\n        },\n        async validarCantidadCarrito(inputCantidad){\n            const stockLogico           =   await  this.getStockLogico(inputCantidad);\n            const cantidadSolicitada    =   inputCantidad.value;\n            return stockLogico >= cantidadSolicitada;\n        },\n        clearInputsCantidad(){\n            const inputsCantidad    =   document.querySelectorAll(\'.inputCantidad\');\n            inputsCantidad.forEach((ic)=>{\n                ic.value    =   \'\';\n            })\n        },\n        async agregarProducto() {\n\n            toastr.clear();\n\n            //====== VALIDACIONES =======\n            if(!this.precioVentaSeleccionado){\n                toastr.error(\'DEBE SELECCIONAR UN PRECIO DE VENTA!!!\');\n                return;\n            }\n\n            //======= DEBE SELECCIONARSE UN ALMACÉN =======\n            if(!this.almacenSeleccionado){\n                toastr.clear();\n                toastr.error(\'DEBES SELECCIONAR UN ALMACÉN!!!\');\n                //======= FOCUS AL VSELECT ALMACÉN ========\n                this.$nextTick(() => {\n                    this.$parent.$refs.selectAlmacen.$el.querySelector("input").focus();\n                });\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n            //======== ANIMACIÓN =======\n            this.$parent.mostrarAnimacionVenta();\n\n            //========= GET INPUTS TO PRODUCTS ARRAY ======\n            const resInputProducts  =   this.getInputProductos();\n\n            if(!resInputProducts.validacion){\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n            try {\n\n                const res_actualizar_stock    =   await this.actualizarStockLogicoVentas(this.almacenSeleccionado,resInputProducts.lstInputProducts);\n\n                if(!res_actualizar_stock.data.success){\n                    toastr.error(res_actualizar_stock.data.message,\'ERROR EN EL SERVIDOR\');\n                    this.$parent.ocultarAnimacionVenta();\n                    return;\n                }\n\n\n                //======== ACTIVAR LA DEVOLUCIÓN DE STOCK ======\n                this.asegurarCierre = 1;\n                toastr.success(res_actualizar_stock.data.message,\'OPERACIÓN COMPLETADA\');\n\n                //====== AGREGAR AL CARRITO =======\n                this.agregarCarrito(resInputProducts.lstInputProducts);\n\n                //======= LIMPIAR INPUTS CANTIDAD ======\n                this.clearInputsCantidad();\n\n                //======== ACTUALIZAR TABLERO STOCKS =======\n                this.getColoresTallas();\n\n                this.reordenarCarrito();\n                this.calcularSubTotal();\n                this.calcularMontos();\n\n                //===== RECALCULANDO DESCUENTOS =====\n                this.carrito.forEach((c)=>{\n                    this.calcularDescuento(c.producto_id,c.color_id,c.porcentaje_descuento);\n                })\n\n                console.log(\'CARRITO\',this.carrito);\n\n\n            } catch (error) {\n                toastr.error(error,\'ERROR AL AGREGAR PRODUCTO!!!\');\n            }\n\n            this.$parent.ocultarAnimacionVenta();\n\n            console.log(this.asegurarCierre);\n            console.log(this.carrito);\n        },\n        async validarStockVentas(almacenId,lstInputProducts){\n\n            const res   =   await axios.post(route(\'ventas.documento.validarStockVentas\'),\n                            {almacenId,lstInputProducts:JSON.stringify(lstInputProducts)});\n\n            return res;\n\n        },\n        async actualizarStockLogicoVentas(almacenId,lstInputProducts){\n\n            //===== RESTAR STOCK LÓGICO ======\n            const res  =   await axios.post(route(\'ventas.documento.actualizarStockAdd\')\n                            ,{almacenId,lstInputProducts:JSON.stringify(lstInputProducts)});\n\n            return res;\n        },\n        agregarCarrito(lstInputProducts){\n            lstInputProducts.forEach((producto)=>{\n\n                //========= REVIZAR SI EXISTE EL PRODUCTO COLOR EN EL CARRITO ======\n                const indiceExiste  = this.carrito.findIndex(p => p.producto_id == producto.producto_id && p.color_id == producto.color_id);\n                console.log(\'existe carrito\',indiceExiste);\n                //======= EN CASO EL PRODUCTO COLOR SEA NUEVO ======\n                if (indiceExiste == -1) {\n\n                    const objProduct = {\n                        almacen_id:  producto.almacen_id,\n                        producto_id: producto.producto_id,\n                        color_id: producto.color_id,\n                        producto_nombre: producto.producto_nombre,\n                        color_nombre: producto.color_nombre,\n                        precio_venta: producto.precio_venta,\n                        monto_descuento:0,\n                        porcentaje_descuento:0,\n                        precio_venta_nuevo:0,\n                        subtotal_nuevo:0,\n                        tallas: [{\n                            talla_id: producto.talla_id,\n                            talla_nombre: producto.talla_nombre,\n                            cantidad: producto.cantidad\n                        }]\n                    };\n\n                    this.carrito.push(objProduct);\n                }else{\n\n                    //======== PRODUCTO COLOR EXISTE =========\n                    const productoModificar         = this.carrito[indiceExiste];\n                    productoModificar.precio_venta  = producto.precio_venta;\n\n                    //===== PREGUNTANDO SI EXISTE LA TALLA EN EL CARRITO ======\n                    const indexTalla = productoModificar.tallas.findIndex(t => t.talla_id == producto.talla_id);\n\n                    //========== TALLA NUEVA ======\n                    if (indexTalla === -1) {\n\n                        const objTallaProduct = {\n                                                    talla_id: producto.talla_id,\n                                                    talla_nombre: producto.talla_nombre,\n                                                    cantidad: producto.cantidad\n                                                };\n\n                        console.log(`${productoModificar.producto_nombre} - ${productoModificar.color_nombre}`);\n                        this.carrito[indiceExiste].tallas.push(objTallaProduct);\n                        console.log(this.carrito);\n\n                    }\n                }\n\n            })\n        },\n        getInputProductos(){\n\n            //========= OBTENER TODOS LOS INPUT CANTIDAD =======\n            const inputsCantidad    =   document.querySelectorAll(\'.inputCantidad\');\n            const lstInputProducts  =   [];\n            let validacion          =   true;\n\n            for (let i = 0; i < inputsCantidad.length; i++) {\n                const ic = inputsCantidad[i];\n\n                if (ic.value) {\n                    const producto = this.formarProducto(ic);\n\n                    //========= VERIFICAR SI EL COLOR YA EXISTE EN EL CARRITO =====\n                    const indiceProductoColor = this.carrito.findIndex((c) => {\n                        return c.producto_id == producto.producto_id && c.color_id == producto.color_id;\n                    });\n\n                    if (indiceProductoColor !== -1) {\n                        //======== VERIFICAR SI LA TALLA YA EXISTE EN EL CARRITO ====\n                        const indiceTalla = this.carrito[indiceProductoColor].tallas.findIndex((t) => {\n                            return t.talla_id == producto.talla_id;\n                        });\n\n                        if (indiceTalla !== -1) {\n\n                            //======== ROMPER EL BUCLE EN CASO EXISTA LA TALLA EN EL CARRITO ======\n                            toastr.error(\n                                `YA FUE AGREGADO!! ${this.carrito[indiceProductoColor].producto_nombre}-${this.carrito[indiceProductoColor].color_nombre}-${this.carrito[indiceProductoColor].tallas[indiceTalla].talla_nombre}`\n                            );\n                            validacion = false;\n                            break;\n                        }\n                    }\n\n                    lstInputProducts.push(producto);\n                }\n            }\n\n            return {validacion,lstInputProducts};\n\n        },\n        async actualizarStockLogico(producto,modo,cantidadAnterior){\n\n            modo=="eliminar"?this.asegurarCierre=0:this.asegurarCierre=1;\n\n            try {\n                await this.axios.post(route(\'ventas.documento.cantidad\'), {\n                    \'producto_id\'   :   producto.producto_id,\n                    \'color_id\'      :   producto.color_id,\n                    \'talla_id\'      :   producto.talla_id,\n                    \'cantidad\'      :   producto.cantidad,\n                    \'condicion\'     :   this.asegurarCierre,\n                    \'modo\'          :   modo,\n                    \'cantidadAnterior\'    :   cantidadAnterior,\n                    \'tallas\'        :   producto.tallas,\n                });\n\n\n            } catch (ex) {\n\n            }\n        },\n        formarProducto(ic){\n            const almacen_id        = ic.getAttribute(\'data-almacen-id\');\n            const producto_id       = ic.getAttribute(\'data-producto-id\');\n            const producto_nombre   = ic.getAttribute(\'data-producto-nombre\');\n            const color_id          = ic.getAttribute(\'data-color-id\');\n            const color_nombre      = ic.getAttribute(\'data-color-nombre\');\n            const talla_id          = ic.getAttribute(\'data-talla-id\');\n            const talla_nombre      = ic.getAttribute(\'data-talla-nombre\');\n            const precio_venta      = this.precioVentaSeleccionado;\n            const cantidad          = ic.value?ic.value:0;\n\n            const monto_descuento           =   0.0;\n            const porcentaje_descuento      =   0.0;\n            const precio_venta_nuevo        =   0.0;\n            const subtotal_nuevo            =   0.0;\n\n            const producto  =   {almacen_id,producto_id,producto_nombre,color_id,color_nombre,\n                                talla_id,talla_nombre,cantidad,precio_venta,\n                                monto_descuento,porcentaje_descuento,precio_venta_nuevo,subtotal_nuevo};\n            return producto;\n        },\n        validarContenidoInput(e){\n            e.target.value = e.target.value.replace(/^0+|[^0-9]/g, \'\');\n            this.validarCantidadInstantanea(e);\n        },\n\n        async validarCantidadInstantanea(event) {\n            const cantidadSolicitada    =   event.target.value;\n            try {\n                if(cantidadSolicitada !== \'\'){\n                    const stock_logico  =  await this.getStockLogico(event.target);\n                    if(stock_logico < cantidadSolicitada){\n                            event.target.classList.add(\'inputCantidadIncorrecto\');\n                            event.target.classList.remove(\'inputCantidadValido\');\n                            event.target.focus();\n                            this.deshabilitarBtnAgregar =   true;\n                            toastr.error(`Cantidad solicitada: ${cantidadSolicitada}, debe ser menor o igual\n                            al stock lógico: ${stock_logico}`,"Error");\n                    }else{\n                            event.target.classList.add(\'inputCantidadValido\');\n                            event.target.classList.remove(\'inputCantidadIncorrecto\');\n                            this.deshabilitarBtnAgregar =   false;\n                    }\n                }else{\n                    this.deshabilitarBtnAgregar =   false;\n                    event.target.classList.remove(\'inputCantidadIncorrecto\');\n                    event.target.classList.remove(\'inputCantidadValido\');\n                }\n            } catch (error) {\n                toastr.error(`El producto no cuenta con registros en esa talla`,"Error");\n                event.target.value=\'\';\n                console.error(\'Error al obtener stock logico:\', error);\n            }\n        },\n        async  getProductos() {\n            toastr.clear();\n\n            const modelo_id                   =   this.modeloSeleccionado;\n            const marca_id                    =   this.marcaSeleccionada;\n            const categoria_id                =   this.categoriaSeleccionada;\n\n            if(modelo_id || marca_id || categoria_id){\n                try {\n                    const res = await axios.get(route(\'ventas.documento.getProductos\'), {\n                        params: {\n                            modelo_id: modelo_id,\n                            marca_id: marca_id,\n                            categoria_id: categoria_id\n                        }\n                    });\n\n                    if(res.data.success){\n                        this.productos                  =   res.data.productos;\n                        this.productoSeleccionado       = null;\n                        this.precioVentaSeleccionado    = null;\n\n                        toastr.info(\'PRODUCTOS CARGADOS\',\'OPERACIÓN COMPLETADA\');\n                    }else{\n                        //ocultarAnimacionCotizacion();\n                        toastr.error(res.data.message,\'ERROR EN EL SERVIDOR\');\n                    }\n                } catch (error) {\n                    //ocultarAnimacionCotizacion();\n                    toastr.error(error,\'ERROR EN LA PETICIÓN DE OBTENER PRODUCTOS\');\n                }\n\n            }else{\n                //ocultarAnimacionCotizacion();\n            }\n        },\n        //======= OBTENER COLORES Y TALLAS POR PRODUCTO =======\n        async  getColoresTallas(){\n\n            //======= MOSTRAR ANIMACIÓN =======\n            this.$parent.mostrarAnimacionVenta();\n            const producto_id   =   this.productoSeleccionado.producto_id;\n            const almacen_id    =   this.almacenSeleccionado;\n\n            if(!producto_id){\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n           //======= DEBE SELECCIONARSE UN ALMACÉN =======\n           if(!this.almacenSeleccionado){\n                toastr.clear();\n                toastr.error(\'DEBES SELECCIONAR UN ALMACÉN!!!\');\n                //======= FOCUS AL VSELECT ALMACÉN ========\n                this.$nextTick(() => {\n                    this.$parent.$refs.selectAlmacen.$el.querySelector("input").focus();\n                });\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n            if(producto_id){\n                try {\n                    const res   =   await   axios.get(route(\'ventas.documento.getColoresTallas\',{almacen_id,producto_id}));\n                    if(res.data.success){\n                        this.productosPorModelo =   res.data;\n                        this.preciosVenta       =   res.data.precios_venta;\n                    }else{\n                        toastr.error(res.data.message,\'ERROR EN EL SERVIDOR\');\n                    }\n                } catch (error) {\n                    toastr.error(error,\'ERROR EN LA PETICIÓN OBTENER COLORES Y TALLAS\');\n                }finally{\n                    //ocultarAnimacionCotizacion();\n                }\n            }\n            this.$parent.ocultarAnimacionVenta();\n        },\n        printStockLogico(productoId, colorId, tallaId) {\n            const stock = this.productosPorModelo.stocks.find(st => st.producto_id === productoId && st.color_id === colorId && st.talla_id === tallaId);\n            return stock ? stock.stock_logico : 0;\n        },\n        async devolverCantidades() {\n            console.log(\'ASEGURAR CIERRE\',this.asegurarCierre);\n            if(this.asegurarCierre == 1){\n                console.log(\'DEVOLVIENDO STOCK\');\n                await this.axios.post(route(\'ventas.documento.devolverCantidades\'), {\n                    carrito: JSON.stringify(this.carrito),\n                });\n                this.ChangeAsegurarCierre();\n            }\n\n        },\n        async ObtenerCodigoPrecioMenor() {\n\n            try {\n                const { data } = await this.axios.get(route("consulta.ajax.getCodigoPrecioMenor"));\n                this.dataEmpresa = data;\n            } catch (ex) {\n\n            }\n        },\n        AgregarDatos(item) {\n            this.tablaDetalles.push(item);\n            this.formDetalles.precio = "";\n            this.formDetalles.cantidad = "";\n            this.formDetalles.producto_id = "";\n            this.formDetalles.producto_unidad = "";\n            this.formDetalles.producto_lote = "";\n        },\n        buscarProductoAdded(id) {\n            let obj = this.tablaDetalles.find(item => Number(item.producto_id) == Number(id));\n            return obj ? true : false;\n        },\n        TransformarNumber(item) {\n            if (item && !isNaN(Number(item))) {\n\n                return parseFloat(item);\n            } else {\n                return item;\n            }\n        },\n        async actualizarStockDelete(producto){\n            const res   =   await   axios.post(route(\'ventas.documento.actualizarStockDelete\'),\n                            {\n                                almacen_id:producto.almacen_id,\n                                producto_id:producto.producto_id,\n                                color_id:producto.color_id,\n                                tallas:JSON.stringify(producto.tallas)\n                            });\n\n            return res;\n        },\n        async EliminarItem(item, index) {\n\n            try {\n                toastr.clear();\n                this.$parent.mostrarAnimacionVenta();\n\n                //==== devolvemos el stock logico separado ========\n                const res_delete    =   await this.actualizarStockDelete(item);\n\n                if(!res_delete.data.success){\n                    toastr.error(res.data.message,\'ERROR EN EL SERVIDOR AL DEVOLVER STOCK LÓGICO!!!\');\n                }\n\n                //this.actualizarStockLogico(item, "eliminar");\n                //======== renderizamos la tabla de stocks ==============\n                this.getColoresTallas();\n                //========== eliminar el item del carrito ========\n                //============ renderizamos la tabla detalle =======\n                this.carrito.splice(index, 1);\n                //========= recalcular subtotal,igv,total =========\n                this.calcularMontos();\n\n                //======= alerta ======================\n                this.$parent.ocultarAnimacionVenta();\n                toastr.info(\'ITEM ELIMINADO\',"CANTIDAD DEVUELTA");\n            } catch (error) {\n                toastr.error(error,\'ERROR EN LA PETICIÓN ELIMINAR ITEM!!!\');\n            }\n        },\n        ChangeAsegurarCierre() {\n            this.asegurarCierre = 5;\n            console.log(\'devuelto\',this.asegurarCierre);\n        },\n        async getProductoBarCode(barcode){\n            try {\n                toastr.clear();\n                this.$parent.mostrarAnimacionVenta();\n\n                const res   =   await axios.get(route(\'ventas.documento.getProductoBarCode\',{barcode}));\n\n                if(res.data.success){  //====== PRODUCTO EXISTE ====\n\n                    toastr.info(\'BUSCANDO PRODUCTO\');\n\n                    res.data.producto.cantidad  =   1;\n\n                    res.data.producto.almacen_id    =   this.almacenSeleccionado;  //======= AGREGAR ALMACEN ID ======\n                    const lstInputProducts          =   [res.data.producto];\n                    let indiceProductoColor         =   -1;\n                    let indiceTalla                 =   -1;\n\n                    //======= VALIDAR QUE EL PRODUCTO NO EXISTA EN EL DETALLE ======\n                    indiceProductoColor = this.carrito.findIndex((c) => {\n                                                    return c.producto_id == res.data.producto.producto_id && c.color_id == res.data.producto.color_id;\n                                                });\n\n                    if (indiceProductoColor !== -1) {\n                        indiceTalla = this.carrito[indiceProductoColor].tallas.findIndex((t) => {\n                                                return t.talla_id == res.data.producto.talla_id;\n                                            });\n                    }\n\n                    if(indiceTalla !== -1){\n                        toastr.error(`${res.data.producto.producto_nombre}-${res.data.producto.color_nombre}-${res.data.producto.talla_nombre}`,\'ERROR, YA EXISTE EN EL DETALLE!!!\');\n                        return;\n                    }\n\n                    //======= RESTAR STOCK LÓGICO ======\n                    const res_actualizar_stock  =   await this.actualizarStockLogicoVentas(this.almacenSeleccionado,lstInputProducts);\n\n                    if(!res_actualizar_stock.data.success){\n                        toastr.error(res_actualizar_stock.data.message,\'ERROR EN EL SERVIDOR\');\n                        return;\n                    }\n\n                    //======== ACTIVAR LA DEVOLUCIÓN DE STOCK ======\n                    this.asegurarCierre = 1;\n\n                    //====== AGREGAR AL CARRITO =======\n                    this.agregarCarrito(lstInputProducts);\n\n                    //======= LIMPIAR INPUTS CANTIDAD ======\n                    this.clearInputsCantidad();\n\n                    //======== ACTUALIZAR TABLERO STOCKS =======\n                    this.getColoresTallas();\n\n                    this.reordenarCarrito();\n                    this.calcularSubTotal();\n                    this.calcularMontos();\n\n                    //===== RECALCULANDO DESCUENTOS =====\n                    this.carrito.forEach((c)=>{\n                        this.calcularDescuento(c.producto_id,c.color_id,c.porcentaje_descuento);\n                    })\n\n\n                    toastr.info(\'AGREGADO AL DETALLE!!!\',`${res.data.producto.producto_nombre} - ${res.data.producto.color_nombre} - ${res.data.producto.talla_nombre}\n                                PRECIO: ${res.data.producto.precio_venta}`,{timeOut:0});\n\n                }else{\n                    toastr.error(res.data.message,\'ERROR EN EL SERVIDOR\');\n                }\n            } catch (error) {\n                toastr.error(error,\'ERROR EN LA PETICIÓN OBTENER PRODUCTO POR CÓDIGO DE BARRA\');\n            }finally{\n                this.$parent.ocultarAnimacionVenta();\n            }\n        },\n        async limpiarFormularioDetalle(){\n            this.$parent.mostrarAnimacionVenta();\n            await this.devolverCantidades();\n            this.carrito                    =   [];\n            this.productosPorModelo         =   [];\n            this.productos                  =   [];\n            this.productoSeleccionado       =   \'\';\n            this.precioVentaSeleccionado    =   \'\';\n            this.$parent.ocultarAnimacionVenta();\n        }\n\n    }\n}\n<\/script>\n'],sourceRoot:""}]);const c=i},2947:(t,n,e)=>{e.d(n,{A:()=>c});var o=e(4991),a=e.n(o),r=e(6314),i=e.n(r)()(a());i.push([t.id,"@media (min-width:992px){.modal-lg{max-width:1200px}}","",{version:3,sources:["webpack://./resources/js/views/Ventas/documentos/create.vue"],names:[],mappings:"AACA,yBACI,UACI,gBAAN,CACF",sourcesContent:["\n@media (min-width: 992px) {\n    .modal-lg {\n        max-width: 1200px;\n    }\n}\n"],sourceRoot:""}]);const c=i},4369:(t,n,e)=>{e.d(n,{A:()=>c});var o=e(4991),a=e.n(o),r=e(6314),i=e.n(r)()(a());i.push([t.id,'div.content_cliente{position:relative}div.content_cliente.sk__loading:after{background-color:hsla(0,0%,100%,.7);bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3000}.content_cliente.sk__loading>.sk-spinner.sk-spinner-wave{font-size:10px;height:30px;margin:0 auto;text-align:center;width:50px}.content_cliente.sk__loading>.sk-spinner{display:block;left:0;position:absolute;right:0;top:40%;z-index:3500}.content_cliente .sk-spinner.sk-spinner-wave.hide-cliente{display:none}',"",{version:3,sources:["webpack://./resources/js/components/ventas/ModalCliente.vue"],names:[],mappings:"AACA,oBACI,iBAAJ,CAGA,sCAEI,mCAAA,CAKA,QAAA,CANA,UAAA,CAIA,MAAA,CAFA,iBAAA,CAGA,OAAA,CAFA,KAAA,CAIA,YAAJ,CAGA,yDAKI,cAAA,CAFA,WAAA,CAFA,aAAA,CAGA,iBAAA,CAFA,UAGJ,CAGA,yCACI,aAAA,CAGA,MAAA,CAFA,iBAAA,CAGA,OAAA,CAFA,OAAA,CAGA,YAAJ,CAGA,0DACI,YAAJ",sourcesContent:["\r\ndiv.content_cliente {\r\n    position: relative;\r\n}\r\n\r\ndiv.content_cliente.sk__loading::after {\r\n    content: '';\r\n    background-color: rgba(255, 255, 255, 0.7);\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    z-index: 3000;\r\n}\r\n\r\n.content_cliente.sk__loading>.sk-spinner.sk-spinner-wave {\r\n    margin: 0 auto;\r\n    width: 50px;\r\n    height: 30px;\r\n    text-align: center;\r\n    font-size: 10px;\r\n}\r\n\r\n.content_cliente.sk__loading>.sk-spinner {\r\n    display: block;\r\n    position: absolute;\r\n    top: 40%;\r\n    left: 0;\r\n    right: 0;\r\n    z-index: 3500;\r\n}\r\n\r\n.content_cliente .sk-spinner.sk-spinner-wave.hide-cliente {\r\n    display: none;\r\n}\r\n"],sourceRoot:""}]);const c=i},7996:(t,n,e)=>{e.d(n,{A:()=>c});var o=e(4991),a=e.n(o),r=e(6314),i=e.n(r)()(a());i.push([t.id,".modal-overlay[data-v-21151dd8]{align-items:center;background:rgba(0,0,0,.5);display:flex;height:100%;justify-content:center;left:0;position:fixed;top:0;transition:opacity .3s ease;width:100%;z-index:1000}.modal-container[data-v-21151dd8]{background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.2);height:70vh;opacity:1;padding:20px;transform:scale(1);width:80vh}.modal-header[data-v-21151dd8]{align-items:center;display:flex;justify-content:space-between;margin-bottom:15px}.close-button[data-v-21151dd8]{background:none;border:none;cursor:pointer;font-size:20px}.modal-body[data-v-21151dd8]{margin-bottom:15px}.modal-footer[data-v-21151dd8]{display:flex;gap:10px;justify-content:flex-end}.btn[data-v-21151dd8]{border:none;border-radius:4px;cursor:pointer;padding:10px 15px}.btn-primary[data-v-21151dd8]{background:#007bff;color:#fff}.btn-secondary[data-v-21151dd8]{background:#6c757d;color:#fff}.fade-enter-active[data-v-21151dd8],.fade-leave-active[data-v-21151dd8]{transition:opacity .3s ease,transform .3s ease}.fade-enter[data-v-21151dd8],.fade-leave-to[data-v-21151dd8]{opacity:0;transform:scale(.8)}","",{version:3,sources:["webpack://./resources/js/components/ventas/EditarItem.vue"],names:[],mappings:"AAiOA,gCASA,kBAAA,CAHA,yBAAA,CACA,YAAA,CAFA,WAAA,CAGA,sBAAA,CALA,MAAA,CAFA,cAAA,CACA,KAAA,CASA,2BAAA,CAPA,UAAA,CAMA,YAEA,CAEA,kCACA,eAAA,CAEA,iBAAA,CAGA,oCAAA,CADA,WAAA,CAEA,SAAA,CALA,YAAA,CAMA,kBAAA,CAJA,UAKA,CAEA,+BAGA,kBAAA,CAFA,YAAA,CACA,6BAAA,CAEA,kBACA,CACA,+BACA,eAAA,CACA,WAAA,CAEA,cAAA,CADA,cAEA,CACA,6BACA,kBACA,CACA,+BACA,YAAA,CAEA,QAAA,CADA,wBAEA,CACA,sBAEA,WAAA,CACA,iBAAA,CACA,cAAA,CAHA,iBAIA,CACA,8BACA,kBAAA,CACA,UACA,CACA,gCACA,kBAAA,CACA,UACA,CAEA,wEACA,8CACA,CAEA,6DACA,SAAA,CACA,mBACA",sourcesContent:['<template>\n    <transition name="fade" @before-enter="beforeEnter" @enter="enter" @before-leave="beforeLeave" @leave="leave">\n        <div v-if="visible" class="modal-overlay">\n            <div class="modal-container d-flex flex-column">\n                <div class="modal-header">\n                    <h3>{{ title }}</h3>\n                    <button @click="closeModal" class="close-button">×</button>\n                </div>\n                <div class="modal-body">\n\n                    <div class="table-responsive">\n                        <table class="table table-striped">\n                            <thead>\n                            <tr>\n                                <th v-for="talla in tallas" :key="talla.id">{{ talla.descripcion }}</th>\n                            </tr>\n                            </thead>\n                            <tbody>\n                                <tr>\n                                    <td v-for="cantidad_talla in cantidadPorTalla">\n                                        <input min="0" type="text"\n                                        style="width: 60px;"\n                                        class="form-control"\n                                        v-model="cantidad_talla.cantidad"\n                                        @input="cantidad_talla.cantidad = (/^[0-9]+$/.test(cantidad_talla.cantidad)) ? parseInt(cantidad_talla.cantidad) : 0">\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n\n                </div>\n                <div class="modal-footer">\n                    <button class="btn btn-primary" @click="confirm">Guardar</button>\n                    <button class="btn btn-secondary" @click="closeModal">Cancelar</button>\n                </div>\n            </div>\n        </div>\n    </transition>\n</template>\n\n<script>\nexport default {\n    name: \'Modal\',\n    props: {\n        title: {\n            type: String,\n            default: \'Modal Title\',\n        },\n        visible: {\n            type: Boolean,\n            default: false,\n        },\n        tallas:{\n            type: Array,\n            default:[]\n        },\n        tallasProducto: {\n            type: Array,\n            default: () => [],\n        },\n        productoEditar:{\n            type: Object,\n            default: () => ({\n                producto_id: null,\n                color_id: null\n            }),\n        },\n        detalleVenta:{\n            type: Array,\n            default: () => [],\n        }\n    },\n    data(){\n        return{\n            cantidadPorTalla: []\n        }\n    },\n    emits: [\'close\'],\n    methods: {\n        getCantidadForTalla(tallaId) {\n            const tallaEncontrada = this.tallasProducto.find(talla => talla.talla_id == tallaId);\n            return tallaEncontrada ? tallaEncontrada.cantidad : \'\';\n        },\n        closeModal() {\n            this.setCantTallaOriginal();\n            this.$emit(\'close\');\n        },\n        async confirm() {\n\n            //====== EDITAR ITEM =======\n            console.log(\'PRODUCTO EDITAR\',this.productoEditar);\n            console.log(\'CANTIDAD POR TALLA\',this.cantidadPorTalla);\n            console.log(\'PRODUCTOS TABLA\',this.detalleVenta);\n\n            this.$parent.mostrarAnimacionVenta();\n\n            const almacen_id    =   this.$parent.almacenSeleccionado;\n\n            //======= DEBE SELECCIONARSE UN ALMACÉN =======\n            if(!almacen_id){\n                toastr.clear();\n                toastr.error(\'DEBES SELECCIONAR UN ALMACÉN!!!\');\n                //======= FOCUS AL VSELECT ALMACÉN ========\n                this.$nextTick(() => {\n                    this.$parent.$refs.selectAlmacen.$el.querySelector("input").focus();\n                });\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n            //======= CANTIDADES NUEVAS =====\n            const cantidadPorTallaSinCeros = this.cantidadPorTalla.filter(ct => ct.cantidad != \'0\' && ct.cantidad != \'\');\n\n            const indiceProductoColor   =   this.detalleVenta.findIndex((d)=>{\n                                                return d.producto_id == this.productoEditar.producto_id && d.color_id == this.productoEditar.color_id;\n                                            })\n\n            let lstCantidadesEdit   =   [];\n\n            this.cantidadPorTalla.forEach((dt)=>{\n\n                const indiceCantAnt  =   this.detalleVenta[indiceProductoColor].tallas.findIndex((ct)=>{\n                    return ct.talla_id == dt.talla_id;\n                })\n\n                let producto    =   {};\n\n                if(indiceCantAnt === -1){\n                    producto  =   {producto_id:this.productoEditar.producto_id,color_id:this.productoEditar.color_id,\n                                        talla_id:dt.talla_id,cantidad_actual:dt.cantidad,cantidad_anterior:0\n                    }\n                }else{\n                    producto  =   {producto_id:this.productoEditar.producto_id,color_id:this.productoEditar.color_id,\n                                        talla_id:dt.talla_id,cantidad_actual:dt.cantidad,cantidad_anterior:this.detalleVenta[indiceProductoColor].tallas[indiceCantAnt].cantidad\n                    }\n                }\n\n                lstCantidadesEdit.push(producto);\n\n            })\n\n            lstCantidadesEdit = lstCantidadesEdit.filter(ct =>\n                !(ct.cantidad_actual == \'0\' && ct.cantidad_anterior == \'0\') &&\n                !(ct.cantidad_actual == \'\' && ct.cantidad_anterior == \'\')\n            );\n\n            console.log(\'CANTIDADES EDIT\',lstCantidadesEdit);\n\n            //======== ACTUALIZANDO STOCK EDIT =======\n            const res   =   await axios.post(route(\'ventas.documento.actualizarStockEdit\'),\n                            {almacenId:almacen_id,lstProductos:JSON.stringify(lstCantidadesEdit)});\n\n            if(res.data.success){\n                toastr.success(res.data.message,\'OPERACIÓN COMPLETADA\');\n            }else{\n                toastr.error(res.data.message,\'ERROR EN EL SERVIDOR\');\n                this.$parent.ocultarAnimacionVenta();\n                return;\n            }\n\n            if(cantidadPorTallaSinCeros.length === 0){\n\n                if(indiceProductoColor !== -1){\n                    this.detalleVenta.splice(indiceProductoColor,1);\n                }\n\n             }else{\n                this.detalleVenta[indiceProductoColor].tallas   =   cantidadPorTallaSinCeros;\n            }\n\n            this.$parent.ocultarAnimacionVenta();\n            this.closeModal();\n            //this.$emit(\'confirm\');\n        },\n        beforeEnter(el) {\n            el.style.opacity = 0;\n            el.style.transform = \'scale(0.8)\';\n        },\n        enter(el, done) {\n            el.offsetHeight;\n            el.style.transition = \'opacity 0.3s ease, transform 0.3s ease\';\n            el.style.opacity = 1;\n            el.style.transform = \'scale(1)\';\n            done();\n\n            this.setCantTallaOriginal();\n\n            console.log(\'talla_Agregar\',this.cantidadPorTalla);\n\n        },\n        setCantTallaOriginal(){\n            this.cantidadPorTalla   =   [];\n\n            //========== PREPARANDO CANT POR TALLA =======\n            this.tallas.forEach((t)=>{\n\n                const talla_find    =   this.tallasProducto.find((p)=>{\n                    return p.talla_id == t.id;\n                })\n\n                const talla_agregar =   {\n                                            talla_id:t.id,\n                                            talla_nombre:t.descripcion,\n                                            cantidad:talla_find?talla_find.cantidad:0\n                                        };\n\n                this.cantidadPorTalla.push(talla_agregar);\n\n            })\n        },\n        beforeLeave(el) {\n            el.style.transition = \'opacity 0.3s ease, transform 0.3s ease\'; // Set transition for leave\n        },\n        leave(el, done) {\n            el.style.opacity = 0;\n            el.style.transform = \'scale(0.8)\';\n            done();\n        },\n\n    },\n};\n<\/script>\n\n<style scoped>\n.modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 1000;\n    transition: opacity 0.3s ease;\n}\n\n.modal-container {\n    background: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    width: 80vh;\n    height: 70vh;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n    opacity: 1;\n    transform: scale(1);\n}\n\n.modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n}\n.close-button {\n    background: none;\n    border: none;\n    font-size: 20px;\n    cursor: pointer;\n}\n.modal-body {\n    margin-bottom: 15px;\n}\n.modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n}\n.btn {\n    padding: 10px 15px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n.btn-primary {\n    background: #007bff;\n    color: #fff;\n}\n.btn-secondary {\n    background: #6c757d;\n    color: #fff;\n}\n\n.fade-enter-active, .fade-leave-active {\n    transition: opacity 0.3s ease, transform 0.3s ease;\n}\n\n.fade-enter, .fade-leave-to /* .fade-leave-active in <2.1.8 */ {\n    opacity: 0;\n    transform: scale(0.8);\n}\n</style>\n'],sourceRoot:""}]);const c=i},9060:(t,n,e)=>{e.d(n,{A:()=>c});var o=e(4991),a=e.n(o),r=e(6314),i=e.n(r)()(a());i.push([t.id,'.overlay_venta{align-items:center;background-color:rgba(0,0,0,.7);color:#fff;display:flex;font-size:24px;height:100%;justify-content:center;left:0;position:fixed;top:0;visibility:hidden;width:100%;z-index:99999999999!important}.loader_cotizacion_create{animation:pillerPushUp 4s linear infinite;background-image:linear-gradient(#ddd 50px,transparent 0),linear-gradient(#ddd 50px,transparent 0),linear-gradient(#ddd 50px,transparent 0),linear-gradient(#ddd 50px,transparent 0),linear-gradient(#ddd 50px,transparent 0);background-position:0 90px,15px 78px,30px 66px,45px 58px,60px 50px;background-repeat:no-repeat;background-size:8px 100%;height:100px;position:relative;width:75px}.loader_cotizacion_create:after{animation:ballStepUp 4s linear infinite;background:#de3500;border-radius:50%;bottom:10px;content:"";height:10px;left:0;position:absolute;width:10px}@keyframes pillerPushUp{0%,40%,to{background-position:0 90px,15px 78px,30px 66px,45px 58px,60px 50px}50%,90%{background-position:0 50px,15px 58px,30px 66px,45px 78px,60px 90px}}@keyframes ballStepUp{0%{transform:translate(0)}5%{transform:translate(8px,-14px)}10%{transform:translate(15px,-10px)}17%{transform:translate(23px,-24px)}20%{transform:translate(30px,-20px)}27%{transform:translate(38px,-34px)}30%{transform:translate(45px,-30px)}37%{transform:translate(53px,-44px)}40%{transform:translate(60px,-40px)}50%{transform:translate(60px)}57%{transform:translate(53px,-14px)}60%{transform:translate(45px,-10px)}67%{transform:translate(37px,-24px)}70%{transform:translate(30px,-20px)}77%{transform:translate(22px,-34px)}80%{transform:translate(15px,-30px)}87%{transform:translate(7px,-44px)}90%{transform:translateY(-40px)}to{transform:translate(0)}}',"",{version:3,sources:["webpack://./resources/js/views/Ventas/documentos/create.vue"],names:[],mappings:"AACA,eAaA,kBAAA,CANA,+BAAA,CAOA,UAAA,CAHA,YAAA,CAIA,cAAA,CATA,WAAA,CAMA,sBAAA,CARA,MAAA,CAHA,cAAA,CAEA,KAAA,CAaA,iBAAA,CAXA,UAAA,CAIA,6BAQA,CAGA,0BAYA,yCAAA,CAPA,6NAIA,CAEA,kEAAA,CAPA,2BAAA,CAMA,wBAAA,CAPA,YAAA,CAFA,iBAAA,CACA,UAWA,CAEA,gCASA,uCAAA,CAFA,kBAAA,CACA,iBAAA,CALA,WAAA,CAFA,UAAA,CAKA,WAAA,CAFA,MAAA,CAFA,iBAAA,CAGA,UAKA,CAEA,wBAEA,UAGA,kEACA,CAEA,QAEA,kEACA,CACA,CAEA,sBACA,GACA,sBACA,CAEA,GACA,8BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,yBACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,+BACA,CAEA,IACA,8BACA,CAEA,IACA,2BACA,CAEA,GACA,sBACA,CACA",sourcesContent:['<style>\n.overlay_venta {\n    position: fixed;\n    /* Fija el overlay para que cubra todo el viewport */\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    /* Color oscuro con opacidad */\n    z-index: 99999999999 !important;\n    /* Asegura que el overlay esté sobre todo */\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: white;\n    font-size: 24px;\n    visibility: hidden;\n}\n\n/*========== LOADER SPINNER =======*/\n.loader_cotizacion_create {\n    position: relative;\n    width: 75px;\n    height: 100px;\n    background-repeat: no-repeat;\n    background-image: linear-gradient(#DDD 50px, transparent 0),\n        linear-gradient(#DDD 50px, transparent 0),\n        linear-gradient(#DDD 50px, transparent 0),\n        linear-gradient(#DDD 50px, transparent 0),\n        linear-gradient(#DDD 50px, transparent 0);\n    background-size: 8px 100%;\n    background-position: 0px 90px, 15px 78px, 30px 66px, 45px 58px, 60px 50px;\n    animation: pillerPushUp 4s linear infinite;\n}\n\n.loader_cotizacion_create:after {\n    content: \'\';\n    position: absolute;\n    bottom: 10px;\n    left: 0;\n    width: 10px;\n    height: 10px;\n    background: #de3500;\n    border-radius: 50%;\n    animation: ballStepUp 4s linear infinite;\n}\n\n@keyframes pillerPushUp {\n\n    0%,\n    40%,\n    100% {\n        background-position: 0px 90px, 15px 78px, 30px 66px, 45px 58px, 60px 50px\n    }\n\n    50%,\n    90% {\n        background-position: 0px 50px, 15px 58px, 30px 66px, 45px 78px, 60px 90px\n    }\n}\n\n@keyframes ballStepUp {\n    0% {\n        transform: translate(0, 0)\n    }\n\n    5% {\n        transform: translate(8px, -14px)\n    }\n\n    10% {\n        transform: translate(15px, -10px)\n    }\n\n    17% {\n        transform: translate(23px, -24px)\n    }\n\n    20% {\n        transform: translate(30px, -20px)\n    }\n\n    27% {\n        transform: translate(38px, -34px)\n    }\n\n    30% {\n        transform: translate(45px, -30px)\n    }\n\n    37% {\n        transform: translate(53px, -44px)\n    }\n\n    40% {\n        transform: translate(60px, -40px)\n    }\n\n    50% {\n        transform: translate(60px, 0)\n    }\n\n    57% {\n        transform: translate(53px, -14px)\n    }\n\n    60% {\n        transform: translate(45px, -10px)\n    }\n\n    67% {\n        transform: translate(37px, -24px)\n    }\n\n    70% {\n        transform: translate(30px, -20px)\n    }\n\n    77% {\n        transform: translate(22px, -34px)\n    }\n\n    80% {\n        transform: translate(15px, -30px)\n    }\n\n    87% {\n        transform: translate(7px, -44px)\n    }\n\n    90% {\n        transform: translate(0, -40px)\n    }\n\n    100% {\n        transform: translate(0, 0);\n    }\n}\n</style>\n\n<template>\n\n    <div class="">\n\n        <EditarItemVue :visible="modalVisible" :title="modalTitle" :tallas="initData.tallas"\n            :tallasProducto="tallasProductoEdit" :productoEditar="productoEditar" :detalleVenta="productos_tabla"\n            @close="closeModal">\n        </EditarItemVue>\n\n        <div class="overlay_venta">\n            <span class="loader_cotizacion_create"></span>\n        </div>\n\n        <div class="wrapper wrapper-content animated fadeInRight content-create" :class="{ \'sk__loading\': loading }">\n            <div class="row">\n                <div class="col-lg-12">\n                    <div class="ibox">\n                        <div class="ibox-content">\n                            <form @submit.prevent="Grabar" class="formulario" id="EnviarVenta">\n                                <div class="row">\n\n                                    <div class="col-12 col-md-6 b-r">\n\n                                        <div class="row">\n\n                                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 mb-3"\n                                                id="fecha_documento">\n                                                <label style="font-weight: bold;">FECHA DOCUMENTO</label>\n                                                <div class="input-group">\n                                                    <span class="input-group-addon">\n                                                        <i class="fa fa-calendar"></i>\n                                                    </span>\n\n                                                    <input readonly type="date" id="fecha_documento_campo"\n                                                        name="fecha_documento_campo" class="form-control input-required"\n                                                        autocomplete="off" required\n                                                        v-model="formCreate.fecha_documento_campo">\n\n                                                    <span class="invalid-feedback" role="alert">\n                                                        <strong></strong>\n                                                    </span>\n\n                                                </div>\n                                            </div>\n\n                                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 mb-3" id="almacen">\n\n                                                <label style="font-weight: bold;">ALMACÉN</label>\n\n                                                <v-select v-model="almacenSeleccionado" :options="lst_almacenes"\n                                                    :reduce="a => a.id" label="descripcion" placeholder="Seleccionar"\n                                                    ref="selectAlmacen">\n                                                </v-select>\n\n                                            </div>\n\n\n                                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 select-required mb-3">\n                                                <div class="form-group">\n                                                    <label style="font-weight: bold;" class="required">COMPROBANTE\n                                                    </label>\n                                                    <v-select v-model="tipo_venta" :options="initData.tipoVentas"\n                                                        :reduce="tipo => tipo.id" label="nombre"\n                                                        placeholder="Seleccionar comprobante...">\n                                                    </v-select>\n                                                </div>\n                                            </div>\n\n                                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 select-required mb-3">\n                                                <div class="form-group">\n                                                    <label style="font-weight: bold;">MONEDA</label>\n                                                    <select id="moneda" name="moneda" class="select2_form form-control"\n                                                        disabled>\n                                                        <option selected>SOLES</option>\n                                                    </select>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n\n\n                                    <div class="col-12 col-md-6">\n                                        <div class="row">\n                                            <div class="col-12 col-md-6 select-required">\n                                                <div class="form-group">\n                                                    <label class="required">Condición</label>\n                                                    <v-select v-model="condicion_id" :options="initData.condiciones"\n                                                        :reduce="cn => `${cn.id}-${cn.descripcion}`" label="descripcion"\n                                                        placeholder="Seleccionar condición...">\n                                                        <template v-slot:option="option">\n                                                            {{ option.descripcion }}\n                                                            {{ option.dias > 0 ? option.dias + \'dias\' : \'\' }}\n                                                        </template>\n                                                    </v-select>\n                                                </div>\n                                            </div>\n                                            <div class="col-12 col-md-6" id="fecha_vencimiento">\n                                                <div class="form-group">\n                                                    <label class="required">Fecha de Vencimiento</label>\n                                                    <div class="input-group date">\n                                                        <span class="input-group-addon">\n                                                            <i class="fa fa-calendar"></i>\n                                                        </span>\n                                                        <input type="date" id="fecha_vencimiento_campo"\n                                                            name="fecha_vencimiento_campo"\n                                                            class="form-control input-required" autocomplete="off"\n                                                            v-model="formCreate.fecha_vencimiento_campo" required\n                                                            :disabled="estadoFechaVenc">\n                                                        <span class="invalid-feedback" role="alert">\n                                                            <strong></strong>\n                                                        </span>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class="row align-items-end">\n                                            <div class="col-12 col-md-8 select-required">\n                                                <div class="form-group">\n                                                    <label class="required">Cliente:\n                                                        <button type="button" class="btn btn-outline btn-primary"\n                                                            @click.prevent="NuevoCliente">\n                                                            Registrar\n                                                        </button>\n                                                    </label>\n                                                    <v-select v-model="cliente_id" :options="initData.clientes"\n                                                        :reduce="cl => cl" label="cliente"\n                                                        placeholder="Buscar clientes...">\n                                                        <template v-slot:option="option">\n                                                            {{ option.cliente }}\n                                                        </template>\n                                                    </v-select>\n\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </form>\n                            <hr>\n\n                            <TablaProductos @addProductoDetalle="addProductoDetalle" @addDataEnvio="addDataEnvio"\n                                :fullaccessTable="FullaccessTable" :idcotizacion="idcotizacion"\n                                :btnDisabled="disabledBtnProducto" :parametros="paramsLotes" :modelos="initData.modelos"\n                                :categorias="initData.categorias" :marcas="initData.marcas" :tallas="initData.tallas"\n                                :precio_envio="formCreate.precio_envio" :precio_despacho="formCreate.precio_despacho"\n                                :cliente="cliente_id" :almacenSeleccionado="almacenSeleccionado" ref="tablaProductos" />\n\n                            <div class="hr-line-dashed"></div>\n                            <div class="form-group row">\n                                <div class="col-md-6 text-left" style="color:#fcbc6c">\n                                    <small>Los campos marcados con asterisco\n                                        (<label class="required"></label>) son obligatorios.</small>\n                                </div>\n\n                                <div class="col-md-6 text-right">\n\n                                    <a href="javascript:void(0)" @click.prevent="VolverAIndex" id="btn_cancelar"\n                                        class="btn btn-w-m btn-default">\n                                        <i class="fa fa-arrow-left"></i> Regresar\n                                    </a>\n\n                                    <button type="submit" form="EnviarVenta" id="btn_grabar"\n                                        class="btn btn-w-m btn-primary">\n                                        <i class="fa fa-save"></i>\n                                        Grabar\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n        <ModalClienteVue @newCliente="formAddCliente" :lst_departamentos_base="this.lst_departamentos_base"\n            :lst_provincias_base="this.lst_provincias_base" :lst_distritos_base="this.lst_distritos_base"\n            :v_sede="this.v_sede" />\n\n    </div>\n</template>\n\n<script>\nimport ModalClienteVue from \'../../../components/ventas/ModalCliente.vue\';\nimport TablaProductos from \'../../../components/ventas/TablaProductos.vue\';\nimport EditarItemVue from \'../../../components/ventas/EditarItem.vue\';\n\nexport default {\n    name: "VentaCreate",\n    components: {\n        ModalClienteVue,\n        TablaProductos,\n        EditarItemVue\n    },\n    props: {\n        ruta: {\n            type: String,\n            required: true\n        },\n        idcotizacion: {\n            type: Number,\n            default: 0\n        },\n        v_sede: {\n            default: null\n        },\n        lst_departamentos_base: {\n            type: Array,\n            default: []\n        },\n        lst_provincias_base: {\n            type: Array,\n            default: []\n        },\n        lst_distritos_base: {\n            type: Array,\n            default: []\n        },\n        lst_almacenes: {\n            type: Array,\n            default: []\n        },\n        registrador: {\n            type: Object,\n            default: []\n        },\n    },\n    data() {\n        return {\n\n            //======= MODAL EDITAR ITEM ======\n            productoEditar: { producto_id: null, color_id: null },\n            tallasProductoEdit: [],\n            modalTitle: \'\',\n            modalVisible: false,\n\n            //====== ALMACÉN =====\n            almacenSeleccionado: null,\n            checkDespacho: false,\n            checkEnvio: false,\n            initData: {\n                clientes: [],\n                condiciones: [],\n                dolar: 0,\n                empresas: [],\n                fecha_hoy: "",\n                fullaccess: false,\n                vista: "",\n                tipoVentas: [],\n                modelos: [],\n                categorias: [],\n                marcas: [],\n                tallas: [],\n                sede_id: null\n            },\n            formCreate: {\n                fecha_documento_campo: "",\n                fecha_atencion_campo: "",\n                fecha_vencimiento_campo: "",\n                tipo_venta: "",\n                condicion_id: "",\n                cliente_id: "",\n                tipo_pago_id: null,\n                efectivo: 0,\n                importe: 0,\n                empresa_id: 0,\n                observacion: "",\n                igv: 18,\n                igv_check: true,\n                cotizacion_id: null,\n                productos_tabla: "",\n                envio_sunat: false,\n                igv: 18,\n                monto_sub_total: 0,\n                monto_total_igv: 0,\n                monto_total: 0,\n                tipo_cliente_documento: null,\n                moneda: "SOLES",\n                data_envio: JSON.stringify({})\n            },\n            tipo_venta: "",\n            condicion_id: "",\n            cliente_id: {\n                cliente: "",\n                documento: "",\n                id: 0,\n                nombre: "",\n                tabladetalles_id: 0,\n                tipo_documento: ""\n            },\n            loading: true,\n            loadingClienteNew: false,\n            paramsLotes: {\n                tipo_cliente: \'\',\n                tipocomprobante: \'\',\n            },\n            FullaccessTable: false,\n            productos_tabla: [],\n            estadoFechaVenc: true,\n            disabledBtnProducto: true\n        }\n    },\n    filters: {\n        truncate: function (data, num) {\n            const reqdString =\n                data.split("").slice(0, num).join("");\n            return reqdString;\n        }\n    },\n    watch: {\n        almacenSeleccionado: {\n            handler(value) {\n\n                //===== LIMPIAR FORMULARIO DETALLE ======\n                this.$refs.tablaProductos.limpiarFormularioDetalle();\n\n            }\n        },\n        productos_tabla: {\n            handler(value) {\n                this.formCreate.productos_tabla = JSON.stringify(value);\n            },\n            deep: true\n        },\n        initData: {\n            handler(value) {\n                const { tipoVentas, condiciones, clientes, empresas } = value;\n                this.FullaccessTable = value.fullaccess;\n                clientes.forEach(item => {\n                    item.cliente = `${item.tipo_documento}:${item.documento}-${item.nombre}`;\n                });\n\n                if (!this.loadingClienteNew) {\n                    this.cliente_id = clientes[0];\n                    this.formCreate.empresa_id = empresas.length > 0 ? empresas[0].id : 0;\n                    tipoVentas.forEach(item => {\n                        if (item.id == 129) {\n                            this.tipo_venta = item.id;\n                        }\n                    });\n\n                    condiciones.forEach(item => {\n                        if (item.descripcion == "CONTADO") {\n                            this.condicion_id = `${item.id}-${item.descripcion}`;\n                        }\n                    });\n\n                    this.loadingClienteNew = false;\n                }\n            },\n            deep: true\n        },\n        tipo_venta(value) {\n            this.formCreate.tipo_venta = value;\n            this.paramsLotes.tipocomprobante = value;\n            if (value != 129) {\n                this.formCreate.fecha_documento_campo = this.$fechaActual;\n            }\n\n            if (value) {\n                this.$nextTick(this.getTipoComprobante);\n            }\n\n        },\n        condicion_id(value) {\n            this.formCreate.condicion_id = value;\n            let cadena = value.split("-");\n            let id = cadena[0];\n            let descripcion = cadena[1];\n            let dias = 0;\n            if (descripcion == "CONTADO") {\n                this.estadoFechaVenc = true;\n                this.formCreate.fecha_vencimiento_campo = this.$fechaActual;\n            } else {\n                this.estadoFechaVenc = false;\n                this.initData.condiciones.forEach(item => {\n                    if (Number(item.id) == Number(id)) {\n                        dias = Number(item.dias) + 1;\n                    }\n                });\n                let fecha = new Date(this.$fechaActual);\n                fecha.setDate(fecha.getDate() + dias);\n                let month = (fecha.getMonth() + 1).toString().length > 1 ? (fecha.getMonth() + 1) : \'0\' + (fecha.getMonth() + 1)\n                let day = (fecha.getDate()).toString().length > 1 ? (fecha.getDate()) : \'0\' + (fecha.getDate())\n                let resultado = fecha.getFullYear() + \'-\' + month + \'-\' + day;\n                this.formCreate.fecha_vencimiento_campo = resultado;\n            }\n\n        },\n        cliente_id(value) {\n            if (value) {\n                this.formCreate.cliente_id = value.id;\n                this.paramsLotes.tipo_cliente = value.tabladetalles_id;\n                this.disabledBtnProducto = false;\n            } else {\n                this.formCreate.cliente_id = null;\n                this.disabledBtnProducto = true;\n            }\n        }\n    },\n    created() {\n        console.log(\'SEDE\', this.v_sede);\n\n        //======= SELECCIONAR ALMACÉN PRINCIPAL DE LA SEDE DEL USUARIO ======\n        this.lst_almacenes.forEach((a) => {\n            if (a.sede_id == this.registrador.sede_id) {\n                this.almacenSeleccionado = a.id;\n            }\n        })\n\n        window.addEventListener("beforeunload", this.handleBeforeUnload);\n\n\n        this.formCreate.fecha_documento_campo = this.$fechaActual;\n        this.formCreate.fecha_atencion_campo = this.$fechaActual;\n        this.formCreate.fecha_vencimiento_campo = this.$fechaActual;\n        this.ObtenerData();\n    },\n    mounted() {\n    },\n    beforeDestroy() {\n\n        this.$refs.tablaProductos.devolverCantidades();\n\n    },\n    methods: {\n        cambiarAlmacen() {\n            alert(\'ola\');\n        },\n        handleBeforeUnload(event) {\n            this.$refs.tablaProductos?.devolverCantidades();\n        },\n        openModal(producto) {\n            console.log(\'edit\', producto.producto_nombre);\n            this.modalVisible = true;\n            this.modalTitle = `EDITAR: ${producto.producto_nombre}-${producto.color_nombre}`;\n            this.tallasProductoEdit = producto.tallas;\n            this.productoEditar = { producto_id: producto.producto_id, color_id: producto.color_id };\n        },\n        closeModal() {\n            this.modalVisible = false;\n        },\n        addDataEnvio(value) {\n            // const { departamento,provincia,distrito,tipo_envio,empresa_envio,sede_envio,destinatario } = value;\n            this.formCreate.data_envio = value;\n            console.log(this.formCreate);\n        },\n        formatearDetalle(detalles) {\n            if (detalles.length > 0) {\n                let carritoFormateado = [];\n                detalles.forEach((d) => {\n                    d.tallas.forEach((t) => {\n                        const producto = {};\n                        producto.producto_id = d.producto_id;\n                        producto.color_id = d.color_id;\n                        producto.talla_id = t.talla_id;\n                        producto.cantidad = t.cantidad;\n                        producto.precio_unitario = d.precio_venta;\n                        producto.porcentaje_descuento = d.porcentaje_descuento;\n                        producto.precio_unitario_nuevo = d.precio_venta_nuevo;\n                        carritoFormateado.push(producto);\n                    })\n                })\n                return carritoFormateado;\n            }\n            return [];\n        },\n        async ObtenerData() {\n            try {\n                this.loading = true;\n                const { data } = await this.axios.post(route("ventas.documento.getCreate"));\n                const { success, initData } = data;\n                this.initData = initData;\n                this.loading = false;\n            } catch (ex) {\n\n            }\n        },\n        Volver() {\n            this.$emit("update:ruta", "index");\n        },\n        selectedCliente(value) {\n            console.log(value);\n        },\n\n        NuevoCliente() {\n            $("#modal_cliente").modal("show");\n        },\n        formAddCliente(clienteNuevo) {\n            this.loadingClienteNew = true;\n            this.initData.clientes.push(clienteNuevo);\n            this.cliente_id = clienteNuevo;\n        },\n        //======= OBTENIENDO CARRITO DEL COMPONENTE HIJO TablaProductos.vue ==========\n        addProductoDetalle(value) {\n            const { detalles, totales } = value;\n            //this.productos_tabla      =   this.formatearDetalle(detalles);\n            this.productos_tabla = detalles;\n            this.formCreate = Object.assign(this.formCreate, totales);\n            console.log(this.formCreate);\n        },\n        Grabar() {\n            try {\n                toastr.clear();\n                let correcto = this.validarCampos();\n\n                if (!correcto) {\n                    return;\n                }\n\n                const swalWithBootstrapButtons = Swal.mixin({\n                    customClass: {\n                        confirmButton: "btn btn-success",\n                        cancelButton: "btn btn-danger"\n                    },\n                    buttonsStyling: false\n                });\n                swalWithBootstrapButtons.fire({\n                    title: "Desea generar el documento de venta?",\n                    text: "OPERACIÓN NO REVERSIBLE!",\n                    icon: "warning",\n                    showCancelButton: true,\n                    confirmButtonText: "SÍ!",\n                    cancelButtonText: "NO, CANCELAR!",\n                    reverseButtons: true\n                }).then((result) => {\n                    if (result.isConfirmed) {\n\n                        this.EnviarVenta();\n\n                    } else if (\n                        /* Read more about handling dismissals below */\n                        result.dismiss === Swal.DismissReason.cancel\n                    ) {\n                        swalWithBootstrapButtons.fire({\n                            title: "OPERACIÓN CANCELADA",\n                            text: "NO SE REALIZARON ACCIONES",\n                            icon: "error"\n                        });\n                    }\n                });\n\n            } catch (ex) {\n                toastr.error(ex, \'ERROR EN LA PETICIÓN GENERAR DOCUMENTO DE VENTA\');\n            }\n        },\n        async EnviarVenta() {\n\n\n            Swal.fire({\n                title: \'Registrando venta...\',\n                text: \'Por favor, espera.\',\n                allowOutsideClick: false,\n                didOpen: () => {\n                    Swal.showLoading();\n                }\n            });\n\n            try {\n                this.formCreate.almacenSeleccionado = this.almacenSeleccionado;\n                this.formCreate.sede_id = this.initData.sede_id;\n\n                const res = await this.axios.post(route(\'ventas.documento.store\'), this.formCreate);\n                /*\n                const delay     =   new Promise(resolve => setTimeout(resolve, 10000));\n                const request   =   this.axios.post(route(\'ventas.documento.store\'), this.formCreate);\n                const [res]     =   await Promise.all([request, delay]);\n                */\n\n                if (res.data.success) {\n                    this.$refs.tablaProductos.ChangeAsegurarCierre();\n                    toastr.success(res.data.message, \'OPERACIÓN COMPLETADA\');\n                    const url_open_pdf = route("ventas.documento.comprobante", { id: res.data.documento_id, size: 80 });\n                    window.open(url_open_pdf, \'Comprobante SISCOM\', \'location=1, status=1, scrollbars=1,width=900, height=600\');\n                    //this.$emit("update:ruta", "index");\n                    window.location.href = route("ventas.documento.index");\n\n                } else {\n                    toastr.error(res.data.message, \'ERROR EN EL SERVIDOR\');\n                    Swal.close();\n                }\n            } catch (error) {\n                toastr.error(error, \'ERROR EN LA PETICIÓN REGISTRAR VENTA\');\n                Swal.close();\n            }\n\n        },\n        validarTipo() {\n\n            var enviar = true\n\n            if (this.formCreate.tipo_cliente_documento == \'0\' && this.formCreate.tipo_venta == 127) {\n                toastr.error(\'El tipo de documento del cliente es diferente a RUC.\', \'Error\');\n                enviar = false;\n            }\n            return enviar\n        },\n        validarCampos() {\n            try {\n                //====== variable para manejar la validación =========\n                let correcto = true;\n                //===== moneda por defecto soles ===========\n                let moneda = this.formCreate.moneda;\n                let observacion = this.formCreate.observacion;\n                //==== contado-credito ========\n                let condicion_id = this.formCreate.condicion_id;\n                let fecha_documento_campo = this.formCreate.fecha_documento_campo;\n                let fecha_atencion_campo = this.formCreate.fecha_atencion_campo;\n                let fecha_vencimiento_campo = this.formCreate.fecha_vencimiento_campo;\n                let empresa_id = this.formCreate.empresa_id;\n                let cliente_id = this.formCreate.cliente_id;\n                //===== 127:factura | 128:boleta | 129:nota_venta =========\n                let tipo_venta = this.formCreate.tipo_venta;\n\n                if (this.productos_tabla.length == 0) {\n                    toastr.error("El documento de venta debe tener almenos un producto vendido.");\n                    correcto = false;\n                }\n                if (moneda == null || moneda == \'\') {\n                    correcto = false;\n                    toastr.error(\'El campo moneda es requerido.\');\n                }\n                if (condicion_id == null || condicion_id == \'\') {\n                    correcto = false;\n                    toastr.error(\'El campo condicion de pago es requerido.\');\n                }\n                if (fecha_documento_campo == null || fecha_documento_campo == \'\') {\n                    correcto = false;\n                    toastr.error(\'El campo fecha de documento es requerido.\');\n                }\n                if (fecha_atencion_campo == null || fecha_atencion_campo == \'\') {\n                    correcto = false;\n                    toastr.error(\'El campo fecha de atención es requerido.\');\n                }\n                if (fecha_vencimiento_campo == null || fecha_vencimiento_campo == \'\') {\n                    correcto = false;\n                    toastr.error(\'El campo fecha de vencimiento es requerido.\');\n                }\n\n                if (this.initData.clientes.length > 0) {\n                    let index = this.initData.clientes.findIndex(cliente => Number(cliente.id) == Number(cliente_id));\n                    //======= si el cliente existe ==============\n                    if (index != undefined) {\n                        //========= obtenemos al cliente ===============\n                        let cliente = this.initData.clientes[index];\n                        //======== si el cliente existe =============\n                        //======== validación de tipo de comprobantes de venta ===========\n                        if (cliente != undefined) {\n                            if (convertFloat(tipo_venta) === 127 && cliente.tipo_documento != \'RUC\') {\n                                correcto = false;\n                                toastr.error(\'El tipo de comprobante seleccionado requiere que el cliente tenga RUC.\');\n                            }\n\n                            if (convertFloat(tipo_venta) === 128 && cliente.tipo_documento != \'DNI\') {\n                                correcto = false;\n                                toastr.error(\'El tipo de comprobante seleccionado requiere que el cliente tenga DNI.\');\n                            }\n                        }\n                        else {\n                            correcto = false;\n                            toastr.error(\'Ocurrió un error porfavor seleccionar nuevamente un cliente.\');\n                        }\n                    }\n                    else {\n                        correcto = false;\n                        toastr.error(\'Ocurrió un error porfavor seleccionar nuevamente un cliente.\');\n                    }\n                }\n                return correcto;\n            } catch (ex) {\n                alert("Validar campo" + ex);\n                return false;\n            }\n        },\n        async getTipoComprobante() {\n            try {\n                const { data } = await this.axios.post(route(\'ventas.vouchersAvaible\'), {\n                    \'empresa_id\': this.formCreate.empresa_id,\n                    \'tipo_id\': this.formCreate.tipo_venta\n                });\n                const { existe, empresa, comprobante } = data;\n\n                if (!existe) {\n                    toastr.error(\'La empresa \' + empresa +\n                        \' no tiene registrado el comprobante \' + comprobante, \'Error\');\n                } else {\n                    toastr.success(\'La empresa \' + empresa +\n                        \' tiene registrado el comprobante \' + comprobante,\n                        \'Accion Correcta\');\n                }\n\n            } catch (ex) {\n\n            }\n        },\n        VolverAIndex() {\n            this.$emit("update:ruta", "index");\n        },\n        mostrarAnimacionVenta() {\n            document.querySelector(\'.overlay_venta\').style.visibility = \'visible\';\n        },\n        ocultarAnimacionVenta() {\n            document.querySelector(\'.overlay_venta\').style.visibility = \'hidden\';\n        }\n    },\n}\n<\/script>\n<style lang="scss">\n@media (min-width: 992px) {\n    .modal-lg {\n        max-width: 1200px;\n    }\n}\n</style>\n'],sourceRoot:""}]);const c=i}}]);
//# sourceMappingURL=725.js.map